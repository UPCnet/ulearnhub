/*! max.ui.js - v4.1.18 - 2017-06-01 */
function MaxClient(){this.ROUTES={users:"/people",user:"/people/{0}",avatar:"/people/{0}/avatar",user_activities:"/people/{0}/activities",timeline:"/people/{0}/timeline",user_comments:"/people/{0}/comments",user_shares:"/people/{0}/shares",user_likes:"/people/{0}/likes",follows:"/people/{0}/follows",follow:"/people/{0}/follows/{1}",subscriptions:"/people/{0}/subscriptions",activities:"/contexts/{0}/activities",activity:"/activities/{0}",comments:"/activities/{0}/comments",comment:"/activities/{0}/comments/{1}",likes:"/activities/{0}/likes",like:"/activities/{0}/likes/{1}",flag:"/activities/{0}/flag",favorites:"/activities/{0}/favorites",favorite:"/activities/{0}/favorites/{1}",shares:"/activities/{0}/shares",share:"/activities/{0}/shares/{1}",conversations:"/conversations",conversation:"/conversations/{0}",conversation_owner:"/conversations/{0}/owner",user_conversation:"/people/{0}/conversations/{1}",messages:"/conversations/{0}/messages",context:"/contexts/{0}"}}var Hogan={};!function(e,t){function i(e){return String(null===e||void 0===e?"":e)}function n(e){return e=i(e),c.test(e)?e.replace(a,"&amp;").replace(s,"&lt;").replace(r,"&gt;").replace(o,"&#39;").replace(u,"&quot;"):e}e.Template=function(e,t,i,n){this.r=e||this.r,this.c=i,this.options=n,this.text=t||"",this.buf=""},e.Template.prototype={r:function(e,t,i){return""},v:n,t:i,render:function(e,t,i){return this.ri([e],t||{},i)},ri:function(e,t,i){return this.r(e,t,i)},rp:function(e,t,i,n){var a=i[e];return a?(this.c&&"string"==typeof a&&(a=this.c.compile(a,this.options)),a.ri(t,i,n)):""},rs:function(e,t,i){var n=e[e.length-1];if(!l(n))return void i(e,t,this);for(var a=0;a<n.length;a++)e.push(n[a]),i(e,t,this),e.pop()},s:function(e,t,i,n,a,s,r){var o;return(!l(e)||0!==e.length)&&("function"==typeof e&&(e=this.ls(e,t,i,n,a,s,r)),o=""===e||!!e,!n&&o&&t&&t.push("object"==typeof e?e:t[t.length-1]),o)},d:function(e,t,i,n){var a=e.split("."),s=this.f(a[0],t,i,n),r=null;if("."===e&&l(t[t.length-2]))return t[t.length-1];for(var o=1;o<a.length;o++)s&&"object"==typeof s&&a[o]in s?(r=s,s=s[a[o]]):s="";return!(n&&!s)&&(n||"function"!=typeof s||(t.push(r),s=this.lv(s,t,i),t.pop()),s)},f:function(e,t,i,n){for(var a=!1,s=null,r=!1,o=t.length-1;o>=0;o--)if((s=t[o])&&"object"==typeof s&&e in s){a=s[e],r=!0;break}return r?(n||"function"!=typeof a||(a=this.lv(a,t,i)),a):!n&&""},ho:function(e,t,i,n,a){var s=this.c,r=this.options;return r.delimiters=a,n=null==(n=e.call(t,n))?String(n):n.toString(),this.b(s.compile(n,r).render(t,i)),!1},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ls:function(e,t,i,n,a,s,r){var o=t[t.length-1],u=null;if(!n&&this.c&&e.length>0)return this.ho(e,o,i,this.text.substring(a,s),r);if("function"==typeof(u=e.call(o))){if(n)return!0;if(this.c)return this.ho(u,o,i,this.text.substring(a,s),r)}return u},lv:function(e,t,n){var a=t[t.length-1],s=e.call(a);return"function"==typeof s&&(s=i(s.call(a)),this.c&&~s.indexOf("{{"))?this.c.compile(s,this.options).render(a,n):i(s)}};var a=/&/g,s=/</g,r=/>/g,o=/\'/g,u=/\"/g,c=/[&<>\"\']/,l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}("undefined"!=typeof exports?exports:Hogan),function(e){function t(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function i(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function n(e,t,i){if(t.charAt(i)!=e.charAt(0))return!1;for(var n=1,a=e.length;n<a;n++)if(t.charAt(i+n)!=e.charAt(n))return!1;return!0}function a(e,t,i,n){for(var o=[],u=null,c=null;e.length>0;)if("#"==(c=e.shift()).tag||"^"==c.tag||s(c,n))i.push(c),c.nodes=a(e,c.tag,i,n),o.push(c);else{if("/"==c.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+c.n);if(u=i.pop(),c.n!=u.n&&!r(c.n,u.n,n))throw new Error("Nesting error: "+u.n+" vs. "+c.n);return u.end=c.i,o}o.push(c)}if(i.length>0)throw new Error("missing closing tag: "+i.pop().n);return o}function s(e,t){for(var i=0,n=t.length;i<n;i++)if(t[i].o==e.n)return e.tag="#",!0}function r(e,t,i){for(var n=0,a=i.length;n<a;n++)if(i[n].c==e&&i[n].o==t)return!0}function o(e){return e.replace(w,"\\\\").replace(g,'\\"').replace(x,"\\n").replace(y,"\\r")}function u(e){return~e.indexOf(".")?"d":"f"}function c(e){for(var t="",i=0,n=e.length;i<n;i++){var a=e[i].tag;"#"==a?t+=l(e[i].nodes,e[i].n,u(e[i].n),e[i].i,e[i].end,e[i].otag+" "+e[i].ctag):"^"==a?t+=d(e[i].nodes,e[i].n,u(e[i].n)):"<"==a||">"==a?t+=p(e[i]):"{"==a||"&"==a?t+=m(e[i].n,u(e[i].n)):"\n"==a?t+=v('"\\n"'+(e.length-1==i?"":" + i")):"_v"==a?t+=f(e[i].n,u(e[i].n)):void 0===a&&(t+=v('"'+o(e[i])+'"'))}return t}function l(e,t,i,n,a,s){return"if(_.s(_."+i+'("'+o(t)+'",c,p,1),c,p,0,'+n+","+a+',"'+s+'")){_.rs(c,p,function(c,p,_){'+c(e)+"});c.pop();}"}function d(e,t,i){return"if(!_.s(_."+i+'("'+o(t)+'",c,p,1),c,p,1,0,0,"")){'+c(e)+"};"}function p(e){return'_.b(_.rp("'+o(e.n)+'",c,p,"'+(e.indent||"")+'"));'}function m(e,t){return"_.b(_.t(_."+t+'("'+o(e)+'",c,p,0)));'}function f(e,t){return"_.b(_.v(_."+t+'("'+o(e)+'",c,p,0)));'}function v(e){return"_.b("+e+");"}var h=/\S/,g=/\"/g,x=/\n/g,y=/\r/g,w=/\\/g,b={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};e.scan=function(e,a){function s(){p.length>0&&(m.push(new String(p)),p="")}function r(){for(var e=!0,t=g;t<m.length;t++)if(!(e=m[t].tag&&b[m[t].tag]<b._v||!m[t].tag&&null===m[t].match(h)))return!1;return e}function o(e,t){if(s(),e&&r())for(var i,n=g;n<m.length;n++)m[n].tag||((i=m[n+1])&&">"==i.tag&&(i.indent=m[n].toString()),m.splice(n,1));else t||m.push({tag:"\n"});f=!1,g=m.length}var u=e.length,c=0,l=null,d=null,p="",m=[],f=!1,v=0,g=0,x="{{",y="}}";for(a&&(a=a.split(" "),x=a[0],y=a[1]),v=0;v<u;v++)0==c?n(x,e,v)?(--v,s(),c=1):"\n"==e.charAt(v)?o(f):p+=e.charAt(v):1==c?(v+=x.length-1,"="==(l=(d=b[e.charAt(v+1)])?e.charAt(v+1):"_v")?(v=function(e,t){var n="="+y,a=e.indexOf(n,t),s=i(e.substring(e.indexOf("=",t)+1,a)).split(" ");return x=s[0],y=s[1],a+n.length-1}(e,v),c=0):(d&&v++,c=2),f=v):n(y,e,v)?(m.push({tag:l,n:i(p),otag:x,ctag:y,i:"/"==l?f-y.length:v+x.length}),p="",v+=y.length-1,c=0,"{"==l&&("}}"==y?v++:t(m[m.length-1]))):p+=e.charAt(v);return o(f,!0),m},e.generate=function(t,i,n){var a='var _=this;_.b(i=i||"");'+c(t)+"return _.fl();";return n.asString?"function(c,p,i){"+a+";}":new e.Template(new Function("c","p","i",a),i,e,n)},e.parse=function(e,t,i){return i=i||{},a(e,"",[],i.sectionTags||[])},e.cache={},e.compile=function(e,t){var i=e+"||"+!!(t=t||{}).asString,n=this.cache[i];return n||(n=this.generate(this.parse(this.scan(e,t.delimiters),e,t),e,t),this.cache[i]=n)}}("undefined"!=typeof exports?exports:Hogan),function(e){function t(e,t,i){return isNaN(t)||1==t||(e+="s"),i.locale[e]||e}e.easydate={},e.easydate.locales={},e.easydate.locales.en={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago",in:"in"},e.easydate.locales.ca={future_format:"%s %t",past_format:"%s %t",second:"segon",seconds:"segons",minute:"minut",minutes:"minuts",hour:"hora",hours:"hores",day:"dia",days:"dies",week:"setmana",weeks:"setmanes",month:"mes",months:"mesos",year:"any",years:"anys",yesterday:"ahir",tomorrow:"demà",now:"fa un moment",ago:"fa",in:"en"},e.easydate.locales.es={future_format:"%s %t",past_format:"%s %t",second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"dia",days:"dias",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años",yesterday:"ayer",tomorrow:"mañana",now:"hace un instante",ago:"hace",in:"en"};var i={live:!0,set_title:!0,format_future:!0,format_past:!0,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:!0},{name:"tomorrow",limit:172800,future_only:!0},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:1/0,in_seconds:31556926}],uneasy_format:function(e){return e.toLocaleDateString()},locale:e.easydate.locales.en};e.easydate.format_date=function(n,a){var s=e.extend({},i);s.locale=e.easydate.locales[a];var r=((new Date).getTime()-n.getTime())/1e3,o=Math.abs(r);if(!isNaN(r)&&!(!s.format_future&&r<0||!s.format_past&&r>0)){for(var u in s.units){var c=s.units[u];if(!(c.past_only&&r<0||c.future_only&&r>0)&&o<c.limit){if(isNaN(c.in_seconds))return t(c.name,NaN,s);var l=o/c.in_seconds;l=Math.round(l);return(r<0?t("future_format",NaN,s).replace("%s",t("in",NaN,s)):t("past_format",NaN,s).replace("%s",t("ago",NaN,s))).replace("%t",l+" "+t(c.name,l,s))}}return s.uneasy_format(n)}}}(jQuery),function(e){e.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},function(t){e.extend(e.support,{iecors:!!t})}(e.ajaxSettings.xdr()),e.support.iecors&&e.ajaxTransport(function(e){var t=e.xdr();return{send:function(i,n){t.onload=function(){var e={"Content-Type":t.contentType};n(200,"OK",{text:t.responseText},e)},e.xhrFields&&(xhr.onerror=e.xhrFields.error,xhr.ontimeout=e.xhrFields.timeout),t.open(e.type,e.url),t.send(e.hasContent&&e.data||null)},abort:function(){t.abort()}}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var r=t||window.event,o=u.call(arguments,1),c=0,l=0,d=0,p=0;if(t=e.event.fix(r),t.type="mousewheel","detail"in r&&(d=-1*r.detail),"wheelDelta"in r&&(d=r.wheelDelta),"wheelDeltaY"in r&&(d=r.wheelDeltaY),"wheelDeltaX"in r&&(l=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(l=-1*d,d=0),c=0===d?l:d,"deltaY"in r&&(c=d=-1*r.deltaY),"deltaX"in r&&(l=r.deltaX,0===d&&(c=-1*l)),0!==d||0!==l){if(1===r.deltaMode){var m=e.data(this,"mousewheel-line-height");c*=m,d*=m,l*=m}else if(2===r.deltaMode){var f=e.data(this,"mousewheel-page-height");c*=f,d*=f,l*=f}return p=Math.max(Math.abs(d),Math.abs(l)),(!s||p<s)&&(s=p,n(r,p)&&(s/=40)),n(r,p)&&(c/=40,l/=40,d/=40),c=Math[c>=1?"floor":"ceil"](c/s),l=Math[l>=1?"floor":"ceil"](l/s),d=Math[d>=1?"floor":"ceil"](d/s),t.deltaX=l,t.deltaY=d,t.deltaFactor=s,t.deltaMode=0,o.unshift(t,c,l,d),a&&clearTimeout(a),a=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,o)}}function i(){s=null}function n(e,t){return l.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var a,s,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],u=Array.prototype.slice;if(e.event.fixHooks)for(var c=r.length;c;)e.event.fixHooks[r[--c]]=e.event.mouseHooks;var l=e.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var i=o.length;i;)this.addEventListener(o[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",l.getLineHeight(this)),e.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=o.length;e;)this.removeEventListener(o[--e],t,!1);else this.onmousewheel=null},getLineHeight:function(t){return parseInt(e(t)["offsetParent"in e.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,a,s,r,o=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(u)){for(s=u.length,i=0;i<s;i+=1)r[i]=str(i,u)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(a=str(n=rep[i],u))&&r.push(quote(n)+(gap?": ":":")+a);else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(a=str(n,u))&&r.push(quote(n)+(gap?": ":":")+a);return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var i,n,a=e[t];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(n=walk(a,i))?a[i]=n:delete a[i]);return reviver.call(e,t,a)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,i={},n=function(){};n.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===i.arrIndexOf(n,t)&&n.push(t)},n.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var n=this._listeners[e],a=i.arrIndexOf(n,t);return-1!==a?void(n.length>1?this._listeners[e]=n.slice(0,a).concat(n.slice(a+1)):delete this._listeners[e]):void 0}},n.prototype.dispatchEvent=function(e){var t=e.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,i),this._listeners&&t in this._listeners)for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].apply(this,i)};var a=function(e,t){if(this.type=e,void 0!==t)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};a.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var i=this[t];"function"==typeof i&&(i="[function]"),e.push(t+"="+i)}return"SimpleEvent("+e.join(", ")+")"};var s=function(e){var t=this;t._events=e||[],t._listeners={}};s.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var i=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,i),e in t._listeners)for(var n=0;n<t._listeners[e].length;n++)t._listeners[e][n].apply(t,i)}},s.prototype.on=function(e,t){var i=this;i._verifyType(e),i._nuked||(e in i._listeners||(i._listeners[e]=[]),i._listeners[e].push(t))},s.prototype._verifyType=function(e){var t=this;-1===i.arrIndexOf(t._events,e)&&i.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},s.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};i.random_string=function(e,t){t=t||"abcdefghijklmnopqrstuvwxyz0123456789_".length;var i,n=[];for(i=0;i<e;i++)n.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*t),1));return n.join("")},i.random_number=function(e){return Math.floor(Math.random()*e)},i.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+i.random_number(e)).slice(-t)},i.getOrigin=function(e){return(e+="/").split("/").slice(0,3).join("/")},i.isSameOriginUrl=function(e,i){return i||(i=t.location.href),e.split("/").slice(0,3).join("/")===i.split("/").slice(0,3).join("/")},i.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},i.objectExtend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e};i.polluteGlobalNamespace=function(){"_jp"in t||(t._jp={})},i.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},i.userSetCode=function(e){return 1e3===e||e>=3e3&&e<=4999},i.countRTO=function(e){return e>100?3*e:e+200},i.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},i.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},i.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},i.amendUrl=function(t){var n=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!i.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=n.protocol+t),0===t.indexOf("/")&&(t=n.protocol+"//"+n.host+t),t=t.replace(/[/]+$/,"")},i.arrIndexOf=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},i.arrSkip=function(e,t){var n=i.arrIndexOf(e,t);return-1===n?e.slice():e.slice(0,n).concat(e.slice(n+1))},i.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},i.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var r,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,l=JSON&&JSON.stringify||function(e){return o.lastIndex=0,o.test(e)&&(e=e.replace(o,function(e){return u[e]})),'"'+e+'"'},d=function(e){var t,i={},n=[];for(t=0;t<65536;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return i[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,i};i.quote=function(e){var t=l(e);return c.lastIndex=0,c.test(t)?(r||(r=d(c)),t.replace(c,function(e){return r[e]})):t};var p=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];i.probeProtocols=function(){for(var e={},t=0;t<p.length;t++){var i=p[t];e[i]=w[i]&&w[i].enabled()}return e},i.detectProtocols=function(e,t,i){var n={},a=[];t||(t=p);for(var s=0;s<t.length;s++){var r=t[s];n[r]=e[r]}var o=function(e){var t=e.shift();n[t]?a.push(t):e.length>0&&o(e)};return!1!==i.websocket&&o(["websocket"]),n["xhr-streaming"]&&!i.null_origin?a.push("xhr-streaming"):!n["xdr-streaming"]||i.cookie_needed||i.null_origin?o(["iframe-eventsource","iframe-htmlfile"]):a.push("xdr-streaming"),n["xhr-polling"]&&!i.null_origin?a.push("xhr-polling"):!n["xdr-polling"]||i.cookie_needed||i.null_origin?o(["iframe-xhr-polling","jsonp-polling"]):a.push("xdr-polling"),a};var m="_sockjs_global";i.createHook=function(){var e="a"+i.random_string(8);if(!(m in t)){var n={};t[m]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return t[m](e)},i.attachMessage=function(e){i.attachEvent("message",e)},i.attachEvent=function(i,n){void 0!==t.addEventListener?t.addEventListener(i,n,!1):(e.attachEvent("on"+i,n),t.attachEvent("on"+i,n))},i.detachMessage=function(e){i.detachEvent("message",e)},i.detachEvent=function(i,n){void 0!==t.addEventListener?t.removeEventListener(i,n,!1):(e.detachEvent("on"+i,n),t.detachEvent("on"+i,n))};var f={},v=!1,h=function(){for(var e in f)f[e](),delete f[e]},g=function(){v||(v=!0,h())};i.attachEvent("unload",g),i.unload_add=function(e){var t=i.random_string(8);return f[t]=e,v&&i.delay(h),t},i.unload_del=function(e){e in f&&delete f[e]},i.createIframe=function(t,n){var a,s,r=e.createElement("iframe"),o=function(){clearTimeout(a);try{r.onload=null}catch(e){}r.onerror=null},u=function(){r&&(o(),setTimeout(function(){r&&r.parentNode.removeChild(r),r=null},0),i.unload_del(s))},c=function(e){r&&(u(),n(e))},l=function(e,t){try{r&&r.contentWindow&&r.contentWindow.postMessage(e,t)}catch(e){}};return r.src=t,r.style.display="none",r.style.position="absolute",r.onerror=function(){c("onerror")},r.onload=function(){clearTimeout(a),a=setTimeout(function(){c("onload timeout")},2e3)},e.body.appendChild(r),a=setTimeout(function(){c("timeout")},15e3),s=i.unload_add(u),{post:l,cleanup:u,loaded:o}},i.createHtmlfile=function(e,n){var a,s,r,o=new ActiveXObject("htmlfile"),u=function(){clearTimeout(a)},c=function(){o&&(u(),i.unload_del(s),r.parentNode.removeChild(r),r=o=null,CollectGarbage())},l=function(e){o&&(c(),n(e))},d=function(e,t){try{r&&r.contentWindow&&r.contentWindow.postMessage(e,t)}catch(e){}};o.open(),o.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),o.close(),o.parentWindow._jp=t._jp;var p=o.createElement("div");return o.body.appendChild(p),r=o.createElement("iframe"),p.appendChild(r),r.src=e,a=setTimeout(function(){l("timeout")},15e3),s=i.unload_add(c),{post:d,cleanup:c,loaded:u}};var x=function(){};(x.prototype=new s(["chunk","finish"]))._start=function(e,n,a,s){var r=this;try{r.xhr=new XMLHttpRequest}catch(e){}if(!r.xhr)try{r.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(t.ActiveXObject||t.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),r.unload_ref=i.unload_add(function(){r._cleanup(!0)});try{r.xhr.open(e,n,!0)}catch(e){return r.emit("finish",0,""),void r._cleanup()}if(s&&s.no_credentials||(r.xhr.withCredentials="true"),s&&s.headers)for(var o in s.headers)r.xhr.setRequestHeader(o,s.headers[o]);r.xhr.onreadystatechange=function(){if(r.xhr){var e=r.xhr;switch(e.readyState){case 3:try{var t=e.status,i=e.responseText}catch(e){}1223===t&&(t=204),i&&i.length>0&&r.emit("chunk",t,i);break;case 4:1223===(t=e.status)&&(t=204),r.emit("finish",t,e.responseText),r._cleanup(!1)}}},r.xhr.send(a)},x.prototype._cleanup=function(e){var t=this;if(t.xhr){if(i.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},x.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},(i.XHRCorsObject=function(){var e=this,t=arguments;i.delay(function(){e._start.apply(e,t)})}).prototype=new x,(i.XHRLocalObject=function(e,t,n){var a=this;i.delay(function(){a._start(e,t,n,{no_credentials:!0})})}).prototype=new x;var y=i.XDRObject=function(e,t,n){var a=this;i.delay(function(){a._start(e,t,n)})};y.prototype=new s(["chunk","finish"]),y.prototype._start=function(e,t,n){var a=this,s=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var r=s.ontimeout=s.onerror=function(){a.emit("finish",0,""),a._cleanup(!1)};s.onprogress=function(){a.emit("chunk",200,s.responseText)},s.onload=function(){a.emit("finish",200,s.responseText),a._cleanup(!1)},a.xdr=s,a.unload_ref=i.unload_add(function(){a._cleanup(!0)});try{a.xdr.open(e,t),a.xdr.send(n)}catch(e){r()}},y.prototype._cleanup=function(e){var t=this;if(t.xdr){if(i.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},i.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:U.enabled()?3:4};var w=function(e,n,a){if(this===t)return new w(e,n,a);var s,r=this;r._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},a&&i.objectExtend(r._options,a),r._base_url=i.amendUrl(e),r._server=r._options.server||i.random_number_string(1e3),r._options.protocols_whitelist&&r._options.protocols_whitelist.length?s=r._options.protocols_whitelist:(s="string"==typeof n&&n.length>0?[n]:i.isArray(n)?n:null)&&r._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),r._protocols=[],r.protocol=null,r.readyState=w.CONNECTING,r._ir=F(r._base_url),r._ir.onfinish=function(e,t){r._ir=null,e?(r._options.info&&(e=i.objectExtend(e,r._options.info)),r._options.rtt&&(t=r._options.rtt),r._applyInfo(e,t,s),r._didClose()):r._didClose(1002,"Can't connect to server",!0)}};w.prototype=new n,w.version="0.3.4",w.CONNECTING=0,w.OPEN=1,w.CLOSING=2,w.CLOSED=3,w.prototype._debug=function(){this._options.debug&&i.log.apply(i,arguments)},w.prototype._dispatchOpen=function(){var e=this;e.readyState===w.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=w.OPEN,e.dispatchEvent(new a("open"))):e._didClose(1006,"Server lost session")},w.prototype._dispatchMessage=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new a("message",{data:e}))},w.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===w.OPEN&&t.dispatchEvent(new a("heartbeat",{}))},w.prototype._didClose=function(e,t,n){var s=this;if(s.readyState!==w.CONNECTING&&s.readyState!==w.OPEN&&s.readyState!==w.CLOSING)throw new Error("INVALID_STATE_ERR");s._ir&&(s._ir.nuke(),s._ir=null),s._transport&&(s._transport.doCleanup(),s._transport=null);var r=new a("close",{code:e,reason:t,wasClean:i.userSetCode(e)});if(!i.userSetCode(e)&&s.readyState===w.CONNECTING&&!n){if(s._try_next_protocol(r))return;r=new a("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:r})}s.readyState=w.CLOSED,i.delay(function(){s.dispatchEvent(r)})},w.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var i=JSON.parse(e.slice(1)||"[]"),n=0;n<i.length;n++)t._dispatchMessage(i[n]);break;case"m":i=JSON.parse(e.slice(1)||"null");t._dispatchMessage(i);break;case"c":i=JSON.parse(e.slice(1)||"[]");t._didClose(i[0],i[1]);break;case"h":t._dispatchHeartbeat()}},w.prototype._try_next_protocol=function(t){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+t),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var a=n.protocol=n._protocols.shift();if(!a)return!1;if(w[a]&&!0===w[a].need_body&&(!e.body||void 0!==e.readyState&&"complete"!==e.readyState))return n._protocols.unshift(a),n.protocol="waiting-for-load",i.attachEvent("load",function(){n._try_next_protocol()}),!0;if(w[a]&&w[a].enabled(n._options)){var s=w[a].roundTrips||1,r=(n._options.rto||0)*s||5e3;n._transport_tref=i.delay(r,function(){n.readyState===w.CONNECTING&&n._didClose(2007,"Transport timeouted")});var o=i.random_string(8),u=n._base_url+"/"+n._server+"/"+o;return n._debug("Opening transport:",a," url:"+u," RTO:"+n._options.rto),n._transport=new w[a](n,u,n._base_url),!0}n._debug("Skipping transport:",a)}},w.prototype.close=function(e,t){var n=this;if(e&&!i.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(n.readyState===w.CONNECTING||n.readyState===w.OPEN)&&(n.readyState=w.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},w.prototype.send=function(e){var t=this;if(t.readyState===w.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===w.OPEN&&t._transport.doSend(i.quote(""+e)),!0},w.prototype._applyInfo=function(t,n,a){var s=this;s._options.info=t,s._options.rtt=n,s._options.rto=i.countRTO(n),s._options.info.null_origin=!e.domain;var r=i.probeProtocols();s._protocols=i.detectProtocols(r,a,t)};var b=w.websocket=function(e,n){var a=this,s=n+"/websocket";s="https"===s.slice(0,5)?"wss"+s.slice(5):"ws"+s.slice(4),a.ri=e,a.url=s;var r=t.WebSocket||t.MozWebSocket;a.ws=new r(a.url),a.ws.onmessage=function(e){a.ri._didMessage(e.data)},a.unload_ref=i.unload_add(function(){a.ws.close()}),a.ws.onclose=function(){a.ri._didMessage(i.closeFrame(1006,"WebSocket connection broken"))}};b.prototype.doSend=function(e){this.ws.send("["+e+"]")},b.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),i.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},b.enabled=function(){return!(!t.WebSocket&&!t.MozWebSocket)},b.roundTrips=2;var _=function(){};_.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},_.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},_.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=i.delay(25,function(){t.send_stop=null,t.send_schedule()})},_.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,i){e.send_stop=null,!1===t?e.ri._didClose(1006,"Sending error "+i):e.send_schedule_wait()}),e.send_buffer=[]}},_.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var C=function(t,n,a){var s=this;if(!("_send_form"in s)){r=s._send_form=e.createElement("form");(o=s._send_area=e.createElement("textarea")).name="d",r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",r.appendChild(o),e.body.appendChild(r)}var r=s._send_form,o=s._send_area,u="a"+i.random_string(8);r.target=u,r.action=t+"/jsonp_send?i="+u;var c;try{c=e.createElement('<iframe name="'+u+'">')}catch(t){(c=e.createElement("iframe")).name=u}c.id=u,r.appendChild(c),c.style.display="none";try{o.value=n}catch(e){i.log("Your browser is seriously broken. Go home! "+e.message)}r.submit();var l=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,i.delay(500,function(){c.parentNode.removeChild(c),c=null}),o.value="",a(!0))};return c.onerror=c.onload=l,c.onreadystatechange=function(e){"complete"==c.readyState&&l()},l},S=function(e){return function(t,i,n){return new e("POST",t+"/xhr_send",i).onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},k=function(t,n){var a,s,r=e.createElement("script"),o=function(e){s&&(s.parentNode.removeChild(s),s=null),r&&(clearTimeout(a),r.parentNode.removeChild(r),r.onreadystatechange=r.onerror=r.onload=r.onclick=null,r=null,n(e),n=null)},u=!1,c=null;if(r.id="a"+i.random_string(8),r.src=t,r.type="text/javascript",r.charset="UTF-8",r.onerror=function(e){c||(c=setTimeout(function(){u||o(i.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},r.onload=function(e){o(i.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},r.onreadystatechange=function(e){if(/loaded|closed/.test(r.readyState)){if(r&&r.htmlFor&&r.onclick){u=!0;try{r.onclick()}catch(e){}}r&&o(i.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===r.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))(s=e.createElement("script")).text="try{var a = document.getElementById('"+r.id+"'); if(a)a.onerror();}catch(x){};",r.async=s.async=!1;else{try{r.htmlFor=r.id,r.event="onclick"}catch(e){}r.async=!0}void 0!==r.async&&(r.async=!0),a=setTimeout(function(){o(i.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=e.getElementsByTagName("head")[0];return l.insertBefore(r,l.firstChild),s&&l.insertBefore(s,l.firstChild),o},T=w["jsonp-polling"]=function(e,t){i.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(C),n._schedule_recv()};T.prototype=new _,T.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=O(e.trans_url+"/jsonp",k,t)},T.enabled=function(){return!0},T.need_body=!0,T.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var O=function(e,n,a){var s="a"+i.random_string(6),r=0,o=n(e+"?c="+escape("_jp."+s),function(e){switch(r){case 0:delete t._jp[s],a(e);break;case 1:a(e),r=2;break;case 2:delete t._jp[s]}});return t._jp[s]=o,function(){t._jp[s]&&(r=1,t._jp[s](i.closeFrame(1e3,"JSONP user aborted read")))}},E=function(){};(E.prototype=new _).run=function(e,t,i,n,a){var s=this;s.ri=e,s.trans_url=t,s.send_constructor(S(a)),s.poll=new z(e,n,t+i,a)},E.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var j=w["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",V,i.XHRCorsObject)};j.prototype=new E,j.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},j.roundTrips=2,j.need_body=!0;var A=w["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",V,i.XDRObject)};A.prototype=new E,A.enabled=function(){return!!t.XDomainRequest},A.roundTrips=2;var N=w["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",V,i.XHRCorsObject)};N.prototype=new E,N.enabled=j.enabled,N.roundTrips=2;var R=w["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",V,i.XDRObject)};R.prototype=new E,R.enabled=A.enabled,R.roundTrips=2;var U=function(){};U.prototype.i_constructor=function(e,t,n){var a=this;a.ri=e,a.origin=i.getOrigin(n),a.base_url=n,a.trans_url=t;var s=n+"/iframe.html";a.ri._options.devel&&(s+="?t="+ +new Date),a.window_id=i.random_string(8),s+="#"+a.window_id,a.iframeObj=i.createIframe(s,function(e){a.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),a.onmessage_cb=i.bind(a.onmessage,a),i.attachMessage(a.onmessage_cb)},U.prototype.doCleanup=function(){var e=this;if(e.iframeObj){i.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},U.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var i=e.data.slice(0,8),n=e.data.slice(8,9),a=e.data.slice(9);if(i===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([w.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(a)}}},U.prototype.postMessage=function(e,t){var i=this;i.iframeObj.post(i.window_id+e+(t||""),i.origin)},U.prototype.doSend=function(e){this.postMessage("m",e)},U.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var M,L=function(e,n){parent!==t?parent.postMessage(M+e+(n||""),"*"):i.log("Can't postMessage, no parent window.",e,n)},D=function(){};D.prototype._didClose=function(e,t){L("t",i.closeFrame(e,t))},D.prototype._didMessage=function(e){L("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},i.parent_origin=void 0,w.bootstrap_iframe=function(){var n;M=e.location.hash.slice(1);var a=function(e){if(e.source===parent&&(void 0===i.parent_origin&&(i.parent_origin=e.origin),e.origin===i.parent_origin)){var a=e.data.slice(0,8),s=e.data.slice(8,9),r=e.data.slice(9);if(a===M)switch(s){case"s":var o=JSON.parse(r),u=o[0],c=o[1],l=o[2],d=o[3];if(u!==w.version&&i.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+w.version+'".'),!i.flatUrl(l)||!i.flatUrl(d))return void i.log("Only basic urls are supported in SockJS");if(!i.isSameOriginUrl(l)||!i.isSameOriginUrl(d))return void i.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,l,d])+")");(n=new D)._transport=new D[c](n,l,d);break;case"m":n._doSend(r);break;case"c":n&&n._doCleanup(),n=null}}};i.attachMessage(a),L("s")};var I=function(e,t){var n=this;i.delay(function(){n.doXhr(e,t)})};(I.prototype=new s(["finish"])).doXhr=function(e,t){var n=this,a=(new Date).getTime(),s=new t("GET",e+"/info"),r=i.delay(8e3,function(){s.ontimeout()});s.onfinish=function(e,t){if(clearTimeout(r),r=null,200===e){var i=(new Date).getTime()-a,s=JSON.parse(t);"object"!=typeof s&&(s={}),n.emit("finish",s,i)}else n.emit("finish")},s.ontimeout=function(){s.close(),n.emit("finish")}};var P=function(t){var n=this,a=function(){var e=new U;e.protocol="w-iframe-info-receiver";var i=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var i=JSON.parse(t.substr(1)),a=i[0],s=i[1];n.emit("finish",a,s)}else n.emit("finish");e.doCleanup(),e=null},a={_options:{},_didClose:i,_didMessage:i};e.i_constructor(a,t,t)};e.body?a():i.attachEvent("load",a)};P.prototype=new s(["finish"]);var $=function(){var e=this;i.delay(function(){e.emit("finish",{},2e3)})};$.prototype=new s(["finish"]);var F=function(e){if(i.isSameOriginUrl(e))return new I(e,i.XHRLocalObject);switch(i.isXHRCorsCapable()){case 1:return new I(e,i.XHRLocalObject);case 2:return new I(e,i.XDRObject);case 3:return new P(e);default:return new $}};(D["w-iframe-info-receiver"]=function(e,t,n){new I(n,i.XHRLocalObject).onfinish=function(t,i){e._didMessage("m"+JSON.stringify([t,i])),e._didClose()}}).prototype.doCleanup=function(){};var H=w["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};H.prototype=new U,H.enabled=function(){return"EventSource"in t&&U.enabled()},H.need_body=!0,H.roundTrips=3,(D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",W,i.XHRLocalObject)}).prototype=new E;var X=w["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};X.prototype=new U,X.enabled=function(){return t.XMLHttpRequest&&U.enabled()},X.need_body=!0,X.roundTrips=3,(D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",V,i.XHRLocalObject)}).prototype=new E;var q=w["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};q.prototype=new U,q.enabled=function(){return U.enabled()},q.need_body=!0,q.roundTrips=3,(D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",G,i.XHRLocalObject)}).prototype=new E;var z=function(e,t,i,n){var a=this;a.ri=e,a.Receiver=t,a.recv_url=i,a.AjaxObject=n,a._scheduleRecv()};z.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),i=0;t.onmessage=function(t){i+=1,e.ri._didMessage(t.data)},t.onclose=function(i){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===i.reason?e.ri._didClose(1006,"Polling error ("+i.reason+")"):e._scheduleRecv())}},z.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var W=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new a("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,s){var r=s?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,i.delay(200,function(){t.dispatchEvent(new a("close",{reason:r}))})}};W.prototype=new n,W.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var B,J=function(){if(void 0===B)if("ActiveXObject"in t)try{B=!!new ActiveXObject("htmlfile")}catch(e){}else B=!1;return B},G=function(e){var n=this;i.polluteGlobalNamespace(),n.id="a"+i.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+n.id);var s,r=J()?i.createHtmlfile:i.createIframe;t._jp[n.id]={start:function(){s.loaded()},message:function(e){n.dispatchEvent(new a("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(e,i){s.cleanup(),n.iframe_close=s=null,delete t._jp[n.id],n.dispatchEvent(new a("close",{reason:i}))},s=r(e,function(e){n.iframe_close({},"permanent")})};G.prototype=new n,G.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var V=function(e,t){var i=this,n=0;i.xo=new t("POST",e,null),i.xo.onchunk=function(e,t){if(200===e)for(;;){var s=t.slice(n),r=s.indexOf("\n");if(-1===r)break;n+=r+1;var o=s.slice(0,r);i.dispatchEvent(new a("message",{data:o}))}},i.xo.onfinish=function(e,t){i.xo.onchunk(e,t),i.xo=null;var n=200===e?"network":"permanent";i.dispatchEvent(new a("close",{reason:n}))}};return V.prototype=new n,V.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new a("close",{reason:"user"})),e.xo=null)},w.getUtils=function(){return i},w.getIframeTransport=function(){return U},w}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var e,t,i,n,a={}.hasOwnProperty,s=[].slice;e={LF:"\n",NULL:"\0"},i=function(){function t(e,t,i){this.command=e,this.headers=null!=t?t:{},this.body=null!=i?i:""}var i;return t.prototype.toString=function(){var i,n,s,r;i=[this.command],r=this.headers;for(n in r)a.call(r,n)&&(s=r[n],i.push(n+":"+s));return this.body&&i.push("content-length:"+t.sizeOfUTF8(this.body)),i.push(e.LF+this.body),i.join(e.LF)},t.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},i=function(i){var n,a,s,r,o,u,c,l,d,p,m,f,v,h,g,x,y;for(r=i.search(RegExp(""+e.LF+e.LF)),s=(o=i.substring(0,r).split(e.LF)).shift(),u={},f=function(e){return e.replace(/^\s+|\s+$/g,"")},v=0,g=(x=o.reverse()).length;v<g;v++)l=(p=x[v]).indexOf(":"),u[f(p.substring(0,l))]=f(p.substring(l+1));if(n="",m=r+2,u["content-length"])d=parseInt(u["content-length"]),n=(""+i).substring(m,m+d);else for(a=null,c=h=m,y=i.length;(m<=y?h<y:h>y)&&(a=i.charAt(c))!==e.NULL;c=m<=y?++h:--h)n+=a;return new t(s,u,n)},t.unmarshall=function(t){var n;return function(){var a,s,r,o;for(o=[],a=0,s=(r=t.split(RegExp(""+e.NULL+e.LF+"*"))).length;a<s;a++)(null!=(n=r[a])?n.length:void 0)>0&&o.push(i(n));return o}()},t.marshall=function(i,n,a){return new t(i,n,a).toString()+e.NULL},t}(),t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var a;return t.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},a=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(e,t,n){var a;for(a=i.marshall(e,t,n),"function"==typeof this.debug&&this.debug(">>> "+a);;){if(!(a.length>this.maxWebSocketFrameSize))return this.ws.send(a);this.ws.send(a.substring(0,this.maxWebSocketFrameSize)),a=a.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+a.length)}},t.prototype._setupHeartbeat=function(t){var i,s,r,o,u,c,l=this;if((u=t.version)===n.VERSIONS.V1_1||u===n.VERSIONS.V1_2)return c=function(){var e,i,n,a;for(a=[],e=0,i=(n=t["heart-beat"].split(",")).length;e<i;e++)o=n[e],a.push(parseInt(o));return a}(),s=c[0],i=c[1],0!==this.heartbeat.outgoing&&0!==i&&(r=Math.max(this.heartbeat.outgoing,i),"function"==typeof this.debug&&this.debug("send PING every "+r+"ms"),this.pinger=n.setInterval(r,function(){return l.ws.send(e.LF),"function"==typeof l.debug?l.debug(">>> PING"):void 0})),0!==this.heartbeat.incoming&&0!==s?(r=Math.max(this.heartbeat.incoming,s),"function"==typeof this.debug&&this.debug("check PONG every "+r+"ms"),this.ponger=n.setInterval(r,function(){var e;if((e=a()-l.serverActivity)>2*r)return"function"==typeof l.debug&&l.debug("did not receive server activity for the last "+e+"ms"),l.ws.close()})):void 0},t.prototype._parseConnect=function(){var e,t,i,n;switch(e=1<=arguments.length?s.call(arguments,0):[],n={},e.length){case 2:n=e[0],t=e[1];break;case 3:e[1]instanceof Function?(n=e[0],t=e[1],i=e[2]):(n.login=e[0],n.passcode=e[1],t=e[2]);break;case 4:n.login=e[0],n.passcode=e[1],t=e[2],i=e[3];break;default:n.login=e[0],n.passcode=e[1],t=e[2],i=e[3],n.host=e[4]}return[n,t,i]},t.prototype.connect=function(){var t,r,o,u,c=this;return t=1<=arguments.length?s.call(arguments,0):[],u=this._parseConnect.apply(this,t),o=u[0],this.connectCallback=u[1],r=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){var n,s,o,u,l,d,p,m,f,v,h,g;if(u="undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(n=new Uint8Array(t.data),"function"==typeof c.debug&&c.debug("--- got data length: "+n.length),function(){var e,t,i;for(i=[],e=0,t=n.length;e<t;e++)s=n[e],i.push(String.fromCharCode(s));return i}().join("")):t.data,c.serverActivity=a(),u===e.LF)return void("function"==typeof c.debug&&c.debug("<<< PONG"));for("function"==typeof c.debug&&c.debug("<<< "+u),g=[],f=0,v=(h=i.unmarshall(u)).length;f<v;f++)switch((l=h[f]).command){case"CONNECTED":"function"==typeof c.debug&&c.debug("connected to server "+l.headers.server),c.connected=!0,c._setupHeartbeat(l.headers),g.push("function"==typeof c.connectCallback?c.connectCallback(l):void 0);break;case"MESSAGE":m=l.headers.subscription,(p=c.subscriptions[m]||c.onreceive)?(o=c,d=l.headers["message-id"],l.ack=function(e){return null==e&&(e={}),o.ack(d,m,e)},l.nack=function(e){return null==e&&(e={}),o.nack(d,m,e)},g.push(p(l))):g.push("function"==typeof c.debug?c.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":g.push("function"==typeof c.onreceipt?c.onreceipt(l):void 0);break;case"ERROR":g.push("function"==typeof r?r(l):void 0);break;default:g.push("function"==typeof c.debug?c.debug("Unhandled frame: "+l):void 0)}return g},this.ws.onclose=function(){var e;return e="Whoops! Lost connection to "+c.ws.url,"function"==typeof c.debug&&c.debug(e),c._cleanUp(),"function"==typeof r?r(e):void 0},this.ws.onopen=function(){return"function"==typeof c.debug&&c.debug("Web Socket Opened..."),o["accept-version"]=n.VERSIONS.supportedVersions(),o["heart-beat"]=[c.heartbeat.outgoing,c.heartbeat.incoming].join(","),c._transmit("CONNECT",o)}},t.prototype.disconnect=function(e){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&n.clearInterval(this.pinger),this.ponger)return n.clearInterval(this.ponger)},t.prototype.send=function(e,t,i){return null==t&&(t={}),null==i&&(i=""),t.destination=e,this._transmit("SEND",t,i)},t.prototype.subscribe=function(e,t,i){var n;return null==i&&(i={}),i.id||(i.id="sub-"+this.counter++),i.destination=e,this.subscriptions[i.id]=t,this._transmit("SUBSCRIBE",i),n=this,{id:i.id,unsubscribe:function(){return n.unsubscribe(i.id)}}},t.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},t.prototype.begin=function(e){var t,i;return i=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:i}),t=this,{id:i,commit:function(){return t.commit(i)},abort:function(){return t.abort(i)}}},t.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},t.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},t.prototype.ack=function(e,t,i){return null==i&&(i={}),i["message-id"]=e,i.subscription=t,this._transmit("ACK",i)},t.prototype.nack=function(e,t,i){return null==i&&(i={}),i["message-id"]=e,i.subscription=t,this._transmit("NACK",i)},t}(),n={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,i){var a,s;return null==i&&(i=["v10.stomp","v11.stomp"]),a=n.WebSocketClass||WebSocket,s=new a(e,i),new t(s)},over:function(e){return new t(e)},Frame:i},"undefined"!=typeof window&&null!==window?(n.setInterval=function(e,t){return window.setInterval(t,e)},n.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=n):"undefined"!=typeof exports&&null!==exports?exports.Stomp=n:self.Stomp=n}.call(this),function(){var e=this,t=e._,i={},n=Array.prototype,a=Object.prototype,s=Function.prototype,r=n.push,o=n.slice,u=n.concat,c=a.toString,l=a.hasOwnProperty,d=n.forEach,p=n.map,m=n.reduce,f=n.reduceRight,v=n.filter,h=n.every,g=n.some,x=n.indexOf,y=n.lastIndexOf,w=Array.isArray,b=Object.keys,_=s.bind,C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):e._=C,C.VERSION="1.6.0";var S=C.each=C.forEach=function(e,t,n){if(null==e)return e;if(d&&e.forEach===d)e.forEach(t,n);else if(e.length===+e.length){for(var a=0,s=e.length;a<s;a++)if(t.call(n,e[a],a,e)===i)return}else for(var r=C.keys(e),a=0,s=r.length;a<s;a++)if(t.call(n,e[r[a]],r[a],e)===i)return;return e};C.map=C.collect=function(e,t,i){var n=[];return null==e?n:p&&e.map===p?e.map(t,i):(S(e,function(e,a,s){n.push(t.call(i,e,a,s))}),n)};var k="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return n&&(t=C.bind(t,n)),a?e.reduce(t,i):e.reduce(t);if(S(e,function(e,s,r){a?i=t.call(n,i,e,s,r):(i=e,a=!0)}),!a)throw new TypeError(k);return i},C.reduceRight=C.foldr=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return n&&(t=C.bind(t,n)),a?e.reduceRight(t,i):e.reduceRight(t);var s=e.length;if(s!==+s){var r=C.keys(e);s=r.length}if(S(e,function(o,u,c){u=r?r[--s]:--s,a?i=t.call(n,i,e[u],u,c):(i=e[u],a=!0)}),!a)throw new TypeError(k);return i},C.find=C.detect=function(e,t,i){var n;return T(e,function(e,a,s){if(t.call(i,e,a,s))return n=e,!0}),n},C.filter=C.select=function(e,t,i){var n=[];return null==e?n:v&&e.filter===v?e.filter(t,i):(S(e,function(e,a,s){t.call(i,e,a,s)&&n.push(e)}),n)},C.reject=function(e,t,i){return C.filter(e,function(e,n,a){return!t.call(i,e,n,a)},i)},C.every=C.all=function(e,t,n){t||(t=C.identity);var a=!0;return null==e?a:h&&e.every===h?e.every(t,n):(S(e,function(e,s,r){if(!(a=a&&t.call(n,e,s,r)))return i}),!!a)};var T=C.some=C.any=function(e,t,n){t||(t=C.identity);var a=!1;return null==e?a:g&&e.some===g?e.some(t,n):(S(e,function(e,s,r){if(a||(a=t.call(n,e,s,r)))return i}),!!a)};C.contains=C.include=function(e,t){return null!=e&&(x&&e.indexOf===x?-1!=e.indexOf(t):T(e,function(e){return e===t}))},C.invoke=function(e,t){var i=o.call(arguments,2),n=C.isFunction(t);return C.map(e,function(e){return(n?t:e[t]).apply(e,i)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matches(t))},C.findWhere=function(e,t){return C.find(e,C.matches(t))},C.max=function(e,t,i){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var n=-1/0,a=-1/0;return S(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o>a&&(n=e,a=o)}),n},C.min=function(e,t,i){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var n=1/0,a=1/0;return S(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o<a&&(n=e,a=o)}),n},C.shuffle=function(e){var t,i=0,n=[];return S(e,function(e){t=C.random(i++),n[i-1]=n[t],n[t]=e}),n},C.sample=function(e,t,i){return null==t||i?(e.length!==+e.length&&(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,Math.max(0,t))};var O=function(e){return null==e?C.identity:C.isFunction(e)?e:C.property(e)};C.sortBy=function(e,t,i){return t=O(t),C.pluck(C.map(e,function(e,n,a){return{value:e,index:n,criteria:t.call(i,e,n,a)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,i,n){var a={};return i=O(i),S(t,function(s,r){var o=i.call(n,s,r,t);e(a,o,s)}),a}};C.groupBy=E(function(e,t,i){C.has(e,t)?e[t].push(i):e[t]=[i]}),C.indexBy=E(function(e,t,i){e[t]=i}),C.countBy=E(function(e,t){C.has(e,t)?e[t]++:e[t]=1}),C.sortedIndex=function(e,t,i,n){for(var a=(i=O(i)).call(n,t),s=0,r=e.length;s<r;){var o=s+r>>>1;i.call(n,e[o])<a?s=o+1:r=o}return s},C.toArray=function(e){return e?C.isArray(e)?o.call(e):e.length===+e.length?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:e.length===+e.length?e.length:C.keys(e).length},C.first=C.head=C.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:t<0?[]:o.call(e,0,t)},C.initial=function(e,t,i){return o.call(e,0,e.length-(null==t||i?1:t))},C.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},C.rest=C.tail=C.drop=function(e,t,i){return o.call(e,null==t||i?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var j=function(e,t,i){return t&&C.every(e,C.isArray)?u.apply(i,e):(S(e,function(e){C.isArray(e)||C.isArguments(e)?t?r.apply(i,e):j(e,t,i):i.push(e)}),i)};C.flatten=function(e,t){return j(e,t,[])},C.without=function(e){return C.difference(e,o.call(arguments,1))},C.partition=function(e,t,i){t=O(t);var n=[],a=[];return S(e,function(e){(t.call(i,e)?n:a).push(e)}),[n,a]},C.uniq=C.unique=function(e,t,i,n){C.isFunction(t)&&(n=i,i=t,t=!1);var a=i?C.map(e,i,n):e,s=[],r=[];return S(a,function(i,n){(t?n&&r[r.length-1]===i:C.contains(r,i))||(r.push(i),s.push(e[n]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(e){var t=o.call(arguments,1);return C.filter(C.uniq(e),function(e){return C.every(t,function(t){return C.contains(t,e)})})},C.difference=function(e){var t=u.apply(n,o.call(arguments,1));return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){for(var e=C.max(C.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=C.pluck(arguments,""+i);return t},C.object=function(e,t){if(null==e)return{};for(var i={},n=0,a=e.length;n<a;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},C.indexOf=function(e,t,i){if(null==e)return-1;var n=0,a=e.length;if(i){if("number"!=typeof i)return n=C.sortedIndex(e,t),e[n]===t?n:-1;n=i<0?Math.max(0,a+i):i}if(x&&e.indexOf===x)return e.indexOf(t,i);for(;n<a;n++)if(e[n]===t)return n;return-1},C.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(y&&e.lastIndexOf===y)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var a=n?i:e.length;a--;)if(e[a]===t)return a;return-1},C.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),a=0,s=new Array(n);a<n;)s[a++]=e,e+=i;return s};var A=function(){};C.bind=function(e,t){var i,n;if(_&&e.bind===_)return _.apply(e,o.call(arguments,1));if(!C.isFunction(e))throw new TypeError;return i=o.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(o.call(arguments)));A.prototype=e.prototype;var a=new A;A.prototype=null;var s=e.apply(a,i.concat(o.call(arguments)));return Object(s)===s?s:a}},C.partial=function(e){var t=o.call(arguments,1);return function(){for(var i=0,n=t.slice(),a=0,s=n.length;a<s;a++)n[a]===C&&(n[a]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return e.apply(this,n)}},C.bindAll=function(e){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return S(t,function(t){e[t]=C.bind(e[t],e)}),e},C.memoize=function(e,t){var i={};return t||(t=C.identity),function(){var n=t.apply(this,arguments);return C.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},C.delay=function(e,t){var i=o.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},C.defer=function(e){return C.delay.apply(C,[e,1].concat(o.call(arguments,1)))},C.throttle=function(e,t,i){var n,a,s,r=null,o=0;i||(i={});var u=function(){o=!1===i.leading?0:C.now(),r=null,s=e.apply(n,a),n=a=null};return function(){var c=C.now();o||!1!==i.leading||(o=c);var l=t-(c-o);return n=this,a=arguments,l<=0?(clearTimeout(r),r=null,o=c,s=e.apply(n,a),n=a=null):r||!1===i.trailing||(r=setTimeout(u,l)),s}},C.debounce=function(e,t,i){var n,a,s,r,o,u=function(){var c=C.now()-r;c<t?n=setTimeout(u,t-c):(n=null,i||(o=e.apply(s,a),s=a=null))};return function(){s=this,a=arguments,r=C.now();var c=i&&!n;return n||(n=setTimeout(u,t)),c&&(o=e.apply(s,a),s=a=null),o}},C.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},C.wrap=function(e,t){return C.partial(t,e)},C.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},C.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},C.keys=function(e){if(!C.isObject(e))return[];if(b)return b(e);var t=[];for(var i in e)C.has(e,i)&&t.push(i);return t},C.values=function(e){for(var t=C.keys(e),i=t.length,n=new Array(i),a=0;a<i;a++)n[a]=e[t[a]];return n},C.pairs=function(e){for(var t=C.keys(e),i=t.length,n=new Array(i),a=0;a<i;a++)n[a]=[t[a],e[t[a]]];return n},C.invert=function(e){for(var t={},i=C.keys(e),n=0,a=i.length;n<a;n++)t[e[i[n]]]=i[n];return t},C.functions=C.methods=function(e){var t=[];for(var i in e)C.isFunction(e[i])&&t.push(i);return t.sort()},C.extend=function(e){return S(o.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},C.pick=function(e){var t={},i=u.apply(n,o.call(arguments,1));return S(i,function(i){i in e&&(t[i]=e[i])}),t},C.omit=function(e){var t={},i=u.apply(n,o.call(arguments,1));for(var a in e)C.contains(i,a)||(t[a]=e[a]);return t},C.defaults=function(e){return S(o.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e};var N=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var a=c.call(e);if(a!=c.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=i.length;s--;)if(i[s]==e)return n[s]==t;var r=e.constructor,o=t.constructor;if(r!==o&&!(C.isFunction(r)&&r instanceof r&&C.isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1;i.push(e),n.push(t);var u=0,l=!0;if("[object Array]"==a){if(u=e.length,l=u==t.length)for(;u--&&(l=N(e[u],t[u],i,n)););}else{for(var d in e)if(C.has(e,d)&&(u++,!(l=C.has(t,d)&&N(e[d],t[d],i,n))))break;if(l){for(d in t)if(C.has(t,d)&&!u--)break;l=!u}}return i.pop(),n.pop(),l};C.isEqual=function(e,t){return N(e,t,[],[])},C.isEmpty=function(e){if(null==e)return!0;if(C.isArray(e)||C.isString(e))return 0===e.length;for(var t in e)if(C.has(e,t))return!1;return!0},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=w||function(e){return"[object Array]"==c.call(e)},C.isObject=function(e){return e===Object(e)},S(["Arguments","Function","String","Number","Date","RegExp"],function(e){C["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return!(!e||!C.has(e,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(e){return"function"==typeof e}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!=+e},C.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==c.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return l.call(e,t)},C.noConflict=function(){return e._=t,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.property=function(e){return function(t){return t[e]}},C.matches=function(e){return function(t){if(t===e)return!0;for(var i in e)if(e[i]!==t[i])return!1;return!0}},C.times=function(e,t,i){for(var n=Array(Math.max(0,e)),a=0;a<e;a++)n[a]=t.call(i,a);return n},C.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},C.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=C.invert(R.escape);var U={escape:new RegExp("["+C.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(R.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(e){C[e]=function(t){return null==t?"":(""+t).replace(U[e],function(t){return R[e][t]})}}),C.result=function(e,t){if(null!=e){var i=e[t];return C.isFunction(i)?i.call(e):i}},C.mixin=function(e){S(C.functions(e),function(t){var i=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),D.call(this,i.apply(C,e))}})};var M=0;C.uniqueId=function(e){var t=++M+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};C.template=function(e,t,i){var n;i=C.defaults({},i,C.templateSettings);var a=new RegExp([(i.escape||/(.)^/).source,(i.interpolate||/(.)^/).source,(i.evaluate||/(.)^/).source].join("|")+"|$","g"),s=0,r="__p+='";e.replace(a,function(t,i,n,a,o){return r+=e.slice(s,o).replace(/\\|'|\r|\n|\t|\u2028|\u2029/g,function(e){return"\\"+L[e]}),i&&(r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(r+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(r+="';\n"+a+"\n__p+='"),s=o+t.length,t}),r+="';\n",i.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{n=new Function(i.variable||"obj","_",r)}catch(e){throw e.source=r,e}if(t)return n(t,C);var o=function(e){return n.call(this,e,C)};return o.source="function("+(i.variable||"obj")+"){\n"+r+"}",o},C.chain=function(e){return C(e).chain()};var D=function(e){return this._chain?C(e).chain():e};C.mixin(C),S(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];C.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],D.call(this,i)}}),S(["concat","join","slice"],function(e){var t=n[e];C.prototype[e]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}.call(this);var uuid;(function(){function e(e,t,i){var n=t&&i||0,a=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){a<16&&(t[n+a++]=d[e])});a<16;)t[n+a++]=0;return t}function t(e,t){var i=t||0,n=l;return n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]}function i(e,i,n){var a=i&&n||0,s=i||[],r=null!=(e=e||{}).clockseq?e.clockseq:v,o=null!=e.msecs?e.msecs:(new Date).getTime(),u=null!=e.nsecs?e.nsecs:g+1,c=o-h+(u-g)/1e4;if(c<0&&null==e.clockseq&&(r=r+1&16383),(c<0||o>h)&&null==e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=o,g=u,v=r;var l=(1e4*(268435455&(o+=122192928e5))+u)%4294967296;s[a++]=l>>>24&255,s[a++]=l>>>16&255,s[a++]=l>>>8&255,s[a++]=255&l;var d=o/4294967296*1e4&268435455;s[a++]=d>>>8&255,s[a++]=255&d,s[a++]=d>>>24&15|16,s[a++]=d>>>16&255,s[a++]=r>>>8|128,s[a++]=255&r;for(var p=e.node||f,m=0;m<6;m++)s[a+m]=p[m];return i||t(s)}function n(e,i,n){var s=i&&n||0;"string"==typeof e&&(i="binary"==e?new c(16):null,e=null);var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i)for(var o=0;o<16;o++)i[s+o]=r[o];return i||t(r)}var a,s=this;if("function"==typeof s.require)try{var r=s.require("crypto").randomBytes;a=r&&function(){return r(16)}}catch(e){}if(!a&&s.crypto&&crypto.getRandomValues){var o=new Uint8Array(16);a=function(){return crypto.getRandomValues(o),o}}if(!a){var u=new Array(16);a=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),u[t]=e>>>((3&t)<<3)&255;return u}}for(var c="function"==typeof s.Buffer?s.Buffer:Array,l=[],d={},p=0;p<256;p++)l[p]=(p+256).toString(16).substr(1),d[l[p]]=p;var m=a(),f=[1|m[0],m[1],m[2],m[3],m[4],m[5]],v=16383&(m[6]<<8|m[7]),h=0,g=0;if(uuid=n,uuid.v1=i,uuid.v4=n,uuid.parse=e,uuid.unparse=t,uuid.BufferClass=c,"function"==typeof define&&define.amd)define("uuid",[],function(){return uuid});else if("undefined"!=typeof module&&module.exports)module.exports=uuid;else{var x=s.uuid;uuid.noConflict=function(){return s.uuid=x,uuid},s.uuid=uuid}}).call(this),function(e,t){"use strict";var i="major",n="model",a="name",s="type",r="vendor",o="version",u="mobile",c="tablet",l={extend:function(e,t){for(var i in t)-1!=="browser cpu device engine os".indexOf(i)&&t[i].length%2==0&&(e[i]=t[i].concat(e[i]));return e},has:function(e,t){if("string"==typeof e)return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},d={rgx:function(){for(var e,t,i,n,a,s,r,o=0,u=arguments;o<u.length;o+=2){var c=u[o],l=u[o+1];if(void 0===e){e={};for(n in l)"object"==typeof(a=l[n])?e[a[0]]=void 0:e[a]=void 0}for(t=i=0;t<c.length;t++)if(s=c[t].exec(this.getUA())){for(n=0;n<l.length;n++)r=s[++i],"object"==typeof(a=l[n])&&a.length>0?2==a.length?"function"==typeof a[1]?e[a[0]]=a[1].call(this,r):e[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?e[a[0]]=r?r.replace(a[1],a[2]):void 0:e[a[0]]=r?a[1].call(this,r,a[2]):void 0:4==a.length&&(e[a[0]]=r?a[3].call(this,r.replace(a[1],a[2])):void 0):e[a]=r||void 0;break}if(s)break}return e},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(l.has(t[i][n],e))return"?"===i?void 0:i}else if(l.has(t[i],e))return"?"===i?void 0:i;return e}},p={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},m={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[a,o,i],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[a,"Opera"],o,i],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[a,o,i],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[a,"IE"],o,i],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[a,"Yandex"],o,i],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[a,/_/g," "],o,i],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[a,o,i],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[a,"Dolphin"],o,i],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[a,"Chrome"],o,i],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[o,i,[a,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[o,i,a],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[a,[i,d.str,p.browser.oldsafari.major],[o,d.str,p.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[a,o,i],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[a,"Netscape"],o,i],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[a,o,i]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",l.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",l.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",l.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[n,r,[s,c]],[/applecoremedia\/[\w\.]+ \((ipad)/],[n,[r,"Apple"],[s,c]],[/(apple\s{0,1}tv)/i],[[n,"Apple TV"],[r,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[r,n,[s,c]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[n,[r,"Amazon"],[s,c]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[n,d.str,p.device.amazon.model],[r,"Amazon"],[s,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[n,r,[s,u]],[/\((ip[honed|\s\w*]+);/i],[n,[r,"Apple"],[s,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[r,n,[s,u]],[/\((bb10);\s(\w+)/i],[[r,"BlackBerry"],n,[s,u]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[r,"Asus"],n,[s,c]],[/(sony)\s(tablet\s[ps])/i],[r,n,[s,c]],[/(nintendo)\s([wids3u]+)/i],[r,n,[s,"console"]],[/((playstation)\s[3portablevi]+)/i],[[r,"Sony"],n,[s,"console"]],[/(sprint\s(\w+))/i],[[r,d.str,p.device.sprint.vendor],[n,d.str,p.device.sprint.model],[s,u]],[/(Lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[[r,"Lenovo"],n,[s,c]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[r,[n,/_/g," "],[s,u]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[r,"Motorola"],n,[s,u]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[r,"Motorola"],n,[s,c]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[r,"Samsung"],n,[s,c]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[r,"Samsung"],n,[s,u]],[/(sie)-(\w+)*/i],[[r,"Siemens"],n,[s,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[r,"Nokia"],n,[s,u]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[r,"Acer"],n,[s,c]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[r,"LG"],n,[s,c]],[/(lg) netcast\.tv/i],[r,[s,"smarttv"]],[/((nexus\s[45]))/i,/(lg)[e;\s\/-]+(\w+)*/i],[[r,"LG"],n,[s,u]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[r,"Lenovo"],n,[s,c]],[/linux;.+((jolla));/i],[r,n,[s,u]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[s,l.lowerize],r,n]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,o],[/rv\:([\w\.]+).*(gecko)/i],[o,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,o],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[o,d.str,p.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[o,d.str,p.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],o],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[a,o],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],o],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],o],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,o],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],o],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],o],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,o],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[a,"iOS"],[o,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[a,[o,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[a,o]]},f=function(t,i){if(!(this instanceof f))return new f(t,i).getResult();var n=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),a=i?l.extend(m,i):m;this.getBrowser=function(){return d.rgx.apply(this,a.browser)},this.getCPU=function(){return d.rgx.apply(this,a.cpu)},this.getDevice=function(){return d.rgx.apply(this,a.device)},this.getEngine=function(){return d.rgx.apply(this,a.engine)},this.getOS=function(){return d.rgx.apply(this,a.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this.setUA(n)};if(f.VERSION="0.7.1",f.BROWSER={NAME:a,MAJOR:i,VERSION:o},f.CPU={ARCHITECTURE:"architecture"},f.DEVICE={MODEL:n,VENDOR:r,TYPE:s,CONSOLE:"console",MOBILE:u,SMARTTV:"smarttv",TABLET:c},f.ENGINE={NAME:a,VERSION:o},f.OS={NAME:a,VERSION:o},"undefined"!=typeof exports)"undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.UAParser=f;else{e.UAParser=f,"function"==typeof define&&define.amd&&define("UAParser",[],function(){return f});var v=e.jQuery||e.Zepto;if(void 0!==v){var h=new f;v.ua=h.getResult(),v.ua.get=function(){return h.getUA()},v.ua.set=function(e){h.setUA(e);var t=h.getResult();for(var i in t)v.ua[i]=t[i]}}}}(this);var max=max||{};!function(e){max.views=max.views||{},e.extend(max.views,function(){function t(t){var i=this;i.minchars=t.minchars,i.maxui=t.maxui,i.source=t.source,i.action=t.action,i.filter=t.filter,i.requests={},i.$el=e(t.list),i.$list=i.$el.find("ul"),i.$el.on("click",".maxui-prediction",function(t){var n=e(t.currentTarget);i.select(n),i.choose(t)})}function i(t){var i=this;i.input=t.input,i.$input=e(i.input),i.placeholder=t.placeholder,i.$delegate=e(t.delegate),i.setBindings(),i.bindings=t.bindings,i.$input.val(i.placeholder)}return t.prototype.select=function(e){this.$list.find(".maxui-prediction.selected").removeClass("selected"),e.addClass("selected")},t.prototype.choose=function(e){var t=this,i=t.$list.find(".maxui-prediction.selected");this.action.apply(t,[i]),t.hide()},t.prototype.moveup=function(e){var t=this,i=t.$list.find(".maxui-prediction.selected"),n=i.prev();n.length>0?t.select(n):t.select(i.siblings(":last"))},t.prototype.movedown=function(e){var t=this,i=t.$list.find(".maxui-prediction.selected"),n=i.next();i.removeClass("selected"),n.length>0?t.select(n):t.select(i.siblings(":first"))},t.prototype.matchingRequest=function(t){var i,n=this,a=t.substr(0,t.length-1);if(e.each(n.requests,function(e,t){a===e&&(i=t)}),i&&!i.remaining)return i.text},t.prototype.normalizeWhiteSpace=function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},t.prototype.show=function(t){var i=this,n=e(t.target),a=i.normalizeWhiteSpace(n.val(),!1);if(a.length>=this.minchars){var s=i.matchingRequest(a);i.requests.hasOwnProperty(a)?i.render(a,a):s?i.render(a,s):this.source.apply(this,[t,a,function(e){i.requests[a]={text:a,data:e,remaining:this.getResponseHeader("X-Has-Remaining-Items")},i.render(a,a)}])}else i.hide()},t.prototype.render=function(e,t){for(var i=this,n="",a=i.requests[t].data,s=i.filter(),r=!1,o=0;o<a.length;o++){var u=a[o],c=u.username.search(new RegExp(e,"i"))>=0,l=u.displayName.search(new RegExp(e,"i"))>=0||c;if(-1===s.indexOf(u.username)&&l){var d=i.maxui.settings.avatarURLpattern.format(u.username),p={username:u.username,displayName:u.displayName,avatarURL:d,cssclass:"maxui-prediction"+(!r&&" selected"||"")};n+=i.maxui.templates.predictive.render(p),r=!0}}""===n&&(n="<li>"+i.maxui.settings.literals.no_match_found+"</li>"),i.$list.html(n),i.$el.show()},t.prototype.hide=function(e){this.$el.hide()},i.prototype.normalizeWhiteSpace=function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},i.prototype.bind=function(e,t){var i=this;i.$delegate.on(e,i.input,t)},i.prototype.execExtraBinding=function(e,t){var i=this;i.bindings.hasOwnProperty(t.type)&&i.bindings[t.type].apply(e,[t])},i.prototype.getInputValue=function(){var e=this,t=this.$input.val();return e.normalizeWhiteSpace(t,!1)},i.prototype.setBindings=function(){var t=this;t.bind("focusin",function(i){i.preventDefault(),i.stopPropagation(),t.getInputValue()===t.placeholder&&e(this).val(""),t.execExtraBinding(this,i)}),t.bind("focusout",function(i){i.preventDefault(),i.stopPropagation(),""===t.getInputValue()&&(e(this).val(t.placeholder),t.$input.toggleClass("maxui-empty",!0)),t.execExtraBinding(this,i)});t.bind("maxui-input-submit maxui-input-cancel maxui-input-up maxui-input-down maxui-input-keypress",function(e){e.preventDefault(),e.stopPropagation(),t.execExtraBinding(this,e)}),t.bind("maxui-input-clear",function(e){t.$input.val(t.placeholder)}),t.bind("keydown",function(e){38===e.which?t.$input.trigger("maxui-input-up",[e]):40===e.which&&t.$input.trigger("maxui-input-down",[e]),t.$input.toggleClass("maxui-empty",!1)}),t.bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),13!==e.which||e.shiftKey?27===e.which?t.$input.trigger("maxui-input-cancel",[e]):38!==e.which&&40!==e.which&&t.$input.trigger("maxui-input-keypress",[e]):t.$input.trigger("maxui-input-submit",[e]),t.execExtraBinding(this,e)})},{MaxInput:i,MaxPredictive:t}}())}(jQuery);var max=max||{};!function(e){max.views=max.views||{},e.extend(max.views,function(){function t(t){var i=this;i.maxui=t,i.title="Overlay Title",i.content="",i.el="#maxui-overlay-panel",i.overlay_show_class=".maxui-overlay",e(i.el+" .maxui-close").click(function(e){e.preventDefault(),e.stopPropagation(),i.maxui.overlay.hide()})}return t.prototype.$el=function(){return e(this.el)},t.prototype.setTitle=function(e){this.$el().find("#maxui-overlay-title").text(e)},t.prototype.setContent=function(e){this.$el().find("#maxui-overlay-content").html(e)},t.prototype.configure=function(e){this.setTitle(e.title),this.setContent(e.content),e.bind(this)},t.prototype.show=function(t){var i=this;t.load(function(e){i.configure(e)}),e(i.overlay_show_class).show(),i.$el().animate({opacity:1},200)},t.prototype.hide=function(){var t=this;t.$el().trigger("maxui-overlay-close",[]),t.$el().animate({opacity:0},200,function(i){e(t.overlay_show_class).hide()})},{MaxOverlay:t}}())}(jQuery);var max=max||{};!function(e){max.views=max.views||{},e.extend(max.views,function(){function t(t){var i=this;i.maxui=t,i.title=t.settings.literals.conversations_info_title,i.content="<div>Hello world</div>",i.panelID="conversation-settings-panel",i.displayNameSlot={show:function(){var t=e(i.getOwnerSelector("")),n=e(i.getOwnerSelector("> #maxui-conversation-displayname-edit")),a=e(i.getOwnerSelector("> .maxui-displayname"));e(i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname")).width(t.width()-82),a.hide(),n.show().val(a.text()).focus()},hide:function(){var t=e(i.getOwnerSelector("> #maxui-conversation-displayname-edit"));e(i.getOwnerSelector("> .maxui-displayname")).show(),t.hide().val("")},save:function(){var n=e(i.getOwnerSelector("> .maxui-displayname")),a=e(i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"));t.maxClient.modifyConversation(i.data.id,a.val(),function(e){i.displayNameSlot.hide(),n.text(this.displayName),t.conversations.messagesview.setTitle(this.displayName)})}}}return t.prototype.getOwnerSelector=function(e){return"#maxui-"+this.panelID+".maxui-owner "+e},t.prototype.getSelector=function(e){return"#maxui-"+this.panelID+" "+e},t.prototype.bind=function(t){var i=this;t.$el().unbind(),t.$el().on("maxui-overlay-close",function(e){var t=_.where(i.maxui.conversations.listview.conversations,{id:i.maxui.conversations.active});_.isEmpty(t)||i.maxui.conversations.listview.loadConversation(i.maxui.conversations.active)}),t.$el().on("click",i.getOwnerSelector("> .maxui-displayname"),function(e){i.displayNameSlot.show()}),t.$el().on("keyup",i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"),function(e){27===e.which?i.displayNameSlot.hide():13===e.which&&i.displayNameSlot.save()}),t.$el().on("click",i.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-ok-circled"),function(e){i.displayNameSlot.save()}),t.$el().on("click",i.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-cancel-circled"),function(e){i.displayNameSlot.hide()}),t.$el().on("click",i.getOwnerSelector(".maxui-conversation-user-action"),function(t){var i=e(t.currentTarget),n=i.closest(".maxui-participant");n.find(".maxui-conversation-confirmation:visible").hide(),n.find(".maxui-conversation-user-action.active").removeClass("active"),i.addClass("active"),i.hasClass("maxui-icon-crown-plus")?n.find(".maxui-conversation-transfer-to").show():i.hasClass("maxui-icon-trash")&&n.find(".maxui-conversation-kick-user").show()}),t.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-transfer-to .maxui-icon-ok-circled"),function(n){var a=e(n.currentTarget).closest(".maxui-participant"),s=a.attr("data-username"),r=e(i.getSelector(".maxui-participant.maxui-owner")),o=r.find(".maxui-icon-crown"),u=a.find(".maxui-icon-crown-plus");i.maxui.maxClient.transferConversationOwnership(i.data.id,s,function(e){a.find(".maxui-conversation-transfer-to").hide(),o.removeClass("maxui-icon-crown").addClass("maxui-icon-crown-plus"),u.removeClass("maxui-icon-crown-plus").addClass("maxui-icon-crown"),r.removeClass("maxui-owner"),a.addClass("maxui-owner"),t.$el().find(i.getSelector("")).toggleClass("maxui-owner",!1),t.$el().find(i.getSelector("#maxui-new-participant")).remove(),u.removeClass("active")})}),t.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-kick-user .maxui-icon-ok-circled"),function(t){var n=e(t.currentTarget).closest(".maxui-participant"),a=n.attr("data-username");i.maxui.maxClient.kickUserFromConversation(i.data.id,a,function(e){n.remove()})}),t.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-confirmation .maxui-icon-cancel-circled"),function(t){var i=e(t.currentTarget).closest(".maxui-participant");i.find(".maxui-conversation-confirmation:visible").hide(),i.find(".maxui-conversation-user-action.active").removeClass("active")}),i.predictive=new max.views.MaxPredictive({maxui:i.maxui,minchars:3,filter:function(t){return e.map(i.data.participants,function(e,t){return e.username})},source:function(e,t,n){i.maxui.maxClient.getUsersList(t,n)},action:function(t){var n=t.attr("data-username"),a={style:"opacity:0; height:0px;",username:n,displayName:t.attr("data-username"),literals:i.maxui.settings.literals,avatarURL:i.maxui.settings.avatarURLpattern.format(n)},s=i.maxui.templates.participant.render(a);e(i.getSelector(".maxui-participants > ul")).append(s);var r=e(i.getSelector(".maxui-participant:last"));r.animate({height:36},100,function(e){r.animate({opacity:1},200)}),r.find(".maxui-conversation-add-user").show().focus(),e(i.getSelector("#maxui-new-participant .maxui-text-input")).trigger("maxui-input-clear")},list:"#maxui-new-participant #maxui-conversation-predictive"}),i.newparticipant=new max.views.MaxInput({input:"#maxui-new-participant .maxui-text-input",delegate:t.el,placeholder:i.maxui.settings.literals.conversations_info_add,bindings:{"maxui-input-keypress":function(e){i.predictive.show(e)},"maxui-input-submit":function(e){i.predictive.choose(e)},"maxui-input-cancel":function(e){i.predictive.hide(e)},"maxui-input-up":function(e){i.predictive.moveup(e)},"maxui-input-down":function(e){i.predictive.movedown(e)}}}),t.$el().on("click",i.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-ok-circled"),function(t){var n=e(t.target).closest(".maxui-participant"),a=n.attr("data-username");i.maxui.maxClient.addUserToConversation(i.data.id,a,function(e){n.animate({opacity:0},200,function(e){n.find(".maxui-conversation-add-user").remove(),n.animate({opacity:1},200),n.find(".maxui-conversation-user-action").show()})})}),t.$el().on("click",i.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-cancel-circled"),function(t){var i=e(t.currentTarget).closest(".maxui-participant");i.animate({opacity:0},200,function(e){i.animate({height:0},200,function(e){i.remove()})})}),t.$el().on("click",i.getSelector("#maxui-conversation-leave .maxui-button"),function(n){var a=i.maxui.settings.username;i.maxui.maxClient.kickUserFromConversation(i.data.id,a,function(n){i.maxui.conversations.listview.remove(i.data.id),t.hide(),e("#maxui-back-conversations a").trigger("click")})}),t.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-button"),function(t){e(i.getSelector("#maxui-conversation-delete .maxui-help")).show()}),t.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-ok"),function(n){i.maxui.maxClient.deleteConversation(i.data.id,function(n){i.maxui.conversations.listview.remove(i.data.id),t.hide(),e("#maxui-back-conversations a").trigger("click")})}),t.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-cancel"),function(t){e(i.getSelector("#maxui-conversation-delete .maxui-help")).hide()})},t.prototype.load=function(e){var t=this;t.maxui.maxClient.getConversation(t.maxui.conversations.active,function(i){t.maxui.maxClient.getConversationSubscription(t.maxui.conversations.active,t.maxui.settings.username,function(n){t.data=i;for(var a=[],s=0;s<t.data.participants.length;s++){var r=t.data.participants[s];r.avatarURL=t.maxui.settings.avatarURLpattern.format(r.username),r.owner=r.username===t.data.owner,a.push(r)}var o=t.maxui.settings.conversationAvatarURLpattern.format(t.data.id),u=t.data.displayName;if(t.data.participants.length<=2){var c=t.data.participants[0];1===t.data.participants.length?u="[Archive] "+c.displayName:t.data.participants[0].username===t.maxui.settings.username&&t.data.participants.length>1&&(c=t.data.participants[1]),o=t.maxui.settings.avatarURLpattern.format(c.username)}var l={displayName:u,conversationAvatarURL:o,participants:a,literals:t.maxui.settings.literals,panelID:t.panelID,published:t.maxui.utils.formatDate(t.data.published,t.maxui.language),canManage:t.maxui.settings.username===t.data.owner,canAdd:_.contains(n.permissions,"invite")};t.content=t.maxui.templates.conversationSettings.render(l),e(t)})})},{MaxChatInfo:t}}())}(jQuery);var max=max||{};!function(e){max.views=max.views||{},e.extend(max.views,function(){function t(t){var i=this;i.maxui=t.maxui,i.width=t.width,i.handle=t.handle,i.dragging=!1,i.scrollbar_selector=t.scrollbar,i.$bar=e(i.scrollbar_selector),i.$dragger=i.$bar.find(".maxui-dragger"),i.target_selector=t.target,i.$target=e(i.target_selector),i.bind()}return t.prototype.bind=function(){var t=this;t.$target.on("mousewheel",function(e,i,n,a){if(e.preventDefault(),e.stopPropagation(),t.enabled()){var s=t.$target.height()-t.maxtop-t.handle.height,r=parseInt(t.$target.css("margin-top"),10)+1*a*10;r>0&&(r=0),r<-1*s&&(r=-1*s),t.$target.css({"margin-top":r});var o=100*(r*=-1)/s;t.setDraggerPosition(o)}}),e(document).on("mousemove",function(e){if(t.dragging&&(e.stopPropagation(),e.preventDefault(),t.enabled())){var i=e.clientY-t.$bar.offset().top;i<0&&(i=0),i>=t.maxtop&&(i=t.maxtop);var n=100*i/t.maxtop;t.setContentPosition(n)}}),e(document.body).on("mousedown",".maxui-dragger",function(e){e.stopPropagation(),e.preventDefault(),t.dragging=!0}),e(document).on("mouseup",function(e){t.dragging=!1})},t.prototype.setHeight=function(t){var i=this,n=e("#maxui-conversations .maxui-wrapper").offset().top-i.maxui.offset().top-1;i.$bar.css({height:t,top:n}),i.maxtop=t-i.handle.height-2},t.prototype.setTarget=function(t){this.$target=e(t)},t.prototype.setDraggerPosition=function(e){var t=this,i=t.maxtop*e/100;t.$dragger.css({"margin-top":i})},t.prototype.setContentPosition=function(e){var t=this;if(t.enabled()){var i=(t.$target.height()-t.maxtop-t.handle.height)*e/100;t.$target.css({"margin-top":-1*i}),t.setDraggerPosition(e)}else t.$target.css({"margin-top":""}),t.setDraggerPosition(0)},t.prototype.enabled=function(){var e=this;return e.$target.height()>e.maxtop},{MaxScrollbar:t}}())}(jQuery);var max=max||{};!function(e){max.views=max.views||{},e.extend(max.views,function(){function t(e,t){var i=this;i.conversations=[],i.mainview=e,i.maxui=i.mainview.maxui}function i(e,t){var i=this;i.messages={},i.mainview=e,i.maxui=i.mainview.maxui,i.remaining=!0}function n(n,a){var s=this;s.logtag="CONVERSATIONS",s.el="#maxui-conversations",s.$el=e(s.el),s.maxui=n,s.height=320,s.listview=new t(s,{}),s.messagesview=new i(s,{}),s.conversationSettings=new max.views.MaxChatInfo(s.maxui),s.active=""}return t.prototype.load=function(e){var t=this;_.isArray(e)?(t.conversations=e,t.render(!1)):_.isFunction(e)&&t.maxui.maxClient.getConversationsForUser.apply(t.maxui.maxClient,[t.maxui.settings.username,function(i){t.maxui.logger.info("Loaded {0} conversations from max".format(t.maxui.settings.username),t.mainview.logtag),t.conversations=i,t.render(),e()}])},t.prototype.loadConversation=function(e){var t,i=this;arguments.length>1&&(t=arguments[1]),i.maxui.maxClient.getConversationSubscription(e,i.maxui.settings.username,function(e){_.findWhere(i.conversations,{id:e.id})?i.conversations=_.map(i.conversations,function(t){return t.id===e.id?e:t}):(e.unread_messages=1,i.conversations.push(e)),i.sort(),i.render(),_.isUndefined(t)||t.call(i.mainview)})},t.prototype.updateLastMessage=function(e,t){var i=this;i.conversations=_.map(i.conversations,function(n){return n.id===e&&(n.lastMessage=t,_.defaults(n,{unread_messages:0}),i.maxui.settings.username!==t.user&&(n.unread_messages+=1)),n},i),i.sort()},t.prototype.resetUnread=function(e){var t=this;t.conversations=_.map(t.conversations,function(t){return t.id===e&&(t.unread_messages=0),t},t),t.mainview.updateUnreadConversations()},t.prototype.sort=function(){var e=this;e.conversations=_.sortBy(e.conversations,function(e){return e.lastMessage.published}),e.conversations.reverse()},t.prototype.remove=function(e){var t=this;t.conversations=_.filter(t.conversations,function(t){return t.id!==e}),t.sort(),t.render()},t.prototype.insert=function(e){var t=this;t.conversations.push(e),t.sort(),t.render()},t.prototype.show=function(){var e=this;e.mainview.loadWrappers(),e.mainview.$newparticipants.show(),0===e.conversations.length?(e.load(),e.toggle()):(e.render(),e.toggle())},t.prototype.toggle=function(){var e=this;e.mainview.loadWrappers();var t="";if(!e.mainview.visible()){e.mainview.$addpeople.css({"border-color":"#ccc"}),e.mainview.$common_header.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),e.mainview.scrollbar.setHeight(e.mainview.height-45),e.mainview.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),e.mainview.scrollbar.setContentPosition(0),e.mainview.$addpeople.animate({height:19,"padding-top":6,"padding-bottom":6},400,function(t){e.mainview.$addpeople.removeAttr("style")});var i=e.mainview.$conversations_list.width()+11;e.mainview.$conversations_list.animate({"margin-left":0},400),e.mainview.$messages.animate({left:i+20},400),e.maxui.settings.conversationsSection="conversations",t=e.maxui.settings.literals.new_conversation_text,e.mainview.$postbox.val(t).attr("data-literal",t)}},t.prototype.render=function(){var t=!0;arguments.length>0&&(t=arguments[0]);var i=this,n='<span id="maxui-info">'+i.maxui.settings.literals.no_chats+"<span>",a="conversations"===i.maxui.settings.UISection,s=!1===i.maxui.settings.disableConversations&&!a,r={avatar:i.maxui.settings.avatarURLpattern.format(i.maxui.settings.username),allowPosting:!0,buttonLiteral:i.maxui.settings.literals.new_message_post,textLiteral:i.maxui.settings.literals.new_conversation_text,literals:i.maxui.settings.literals,showConversationsToggle:s?"display:block;":"display:none;",showSubscriptionList:!1},o=i.maxui.templates.postBox.render(r),u=e("#maxui-newactivity");t&&u.html(o),i.conversations.length>0&&(n="");for(var c=0;c<i.conversations.length;c++){var l=i.conversations[c],d=l.participants[0],p=i.maxui.settings.conversationAvatarURLpattern.format(l.id),m="";l.participants.length<=2&&(1===l.participants.length?(d=l.participants[0],m+="[Archive] "):l.participants[0].username===i.maxui.settings.username&&(d=l.participants[1]),p=i.maxui.settings.avatarURLpattern.format(d.username)),m+=l.displayName;var f={id:l.id,displayName:m,text:i.maxui.utils.formatText(l.lastMessage.content),messages:l.unread_messages,literals:i.maxui.settings.literals,date:i.maxui.utils.formatDate(l.lastMessage.published,i.maxui.language),avatarURL:p,hasUnread:l.unread_messages>0};n+=i.maxui.templates.conversation.render(f)}e("#maxui-conversations-list").html(n)},i.prototype.load=function(){var e=this,t=e.mainview.active;arguments.length>0&&(t=arguments[0]),e.messages[t]=[],e.maxui.maxClient.getMessagesForConversation(t,{limit:10},function(i){e.maxui.logger.info("Loaded conversation {0} messages from max".format(t),e.mainview.logtag),e.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(i,function(t,i,n){t.ack=!0,e.append(t)});var n=_.last(e.messages[t]);e.mainview.listview.updateLastMessage(t,{content:n.data.text,published:n.published,user:n.user.username}),e.mainview.listview.resetUnread(t),e.mainview.listview.render(!1),e.mainview.updateUnreadConversations(),e.render()})},i.prototype.ack=function(t){var i=this;i.maxui.logger.info("Acknowledged Message {0} --\x3e {1}".format(t.uuid,t.data.id),i.mainview.logtag);var n=e("#"+t.uuid),a=n.hasClass("maxui-user-me"),s=n.find(".maxui-icon-check");s&&a&&(s.addClass("maxui-ack"),i.messages[i.mainview.active]=_.map(i.messages[i.mainview.active],function(e){return t.uuid===e.uuid&&(e.ack=!0),e}),n.attr("id",t.data.id))},i.prototype.exists=function(e){var t=this,i=_.findWhere(t.messages[e.destination],{uuid:e.uuid});return _.isUndefined(i)},i.prototype.setTitle=function(e){this.mainview.$common_header.find("#maxui-back-conversations .maxui-title").text(e)},i.prototype.loadNew=function(){var e=this,t=_.last(e.messages[e.mainview.active]);e.maxui.maxClient.getMessagesForConversation(e.mainview.active,{limit:10,after:t.uuid},function(t){e.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(t,function(t,i,n){t.ack=!0,e.prepend(t,i)}),e.render()})},i.prototype.loadOlder=function(){var e=this,t=_.first(e.messages[e.mainview.active]);e.maxui.maxClient.getMessagesForConversation(e.mainview.active,{limit:10,before:t.uuid},function(t){e.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(t,function(t,i,n){t.ack=!0,e.prepend(t,i)}),e.render()})},i.prototype.append=function(e){var t,i=this;_.has(e,"data")?(t=e,i.mainview.listview.updateLastMessage(t.destination,{content:t.data.text,published:t.published,user:t.user.username})):(t={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(t.data.fullURL=e.object.fullURL,t.data.thumbURL=e.object.thumbURL),i.mainview.listview.updateLastMessage(t.destination,{content:t.data.text,published:t.published,user:t.user.username})),i.messages[t.destination]=i.messages[t.destination]||[],i.messages[t.destination].push(t)},i.prototype.prepend=function(e,t){var i,n=this;_.has(e,"data")||(i={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(i.data.fullURL=e.object.fullURL,i.data.thumbURL=e.object.thumbURL)),n.messages[n.mainview.active]=n.messages[n.mainview.active]||[],n.messages[n.mainview.active].splice(t,0,i)},i.prototype.render=function(){var t=this,i="",n=[];if(t.messages[t.mainview.active]){t.setTitle(t.mainview.getActive().displayName);for(var a=0;a<t.messages[t.mainview.active].length;a++){var s=t.messages[t.mainview.active][a],r=t.maxui.settings.avatarURLpattern.format(s.user.username),o="maxui-user-notme",u=!0;s.user.username===t.maxui.settings.username&&(o="maxui-user-me",u=!1),_.defaults(s.data,{filename:s.uuid});var c=_.contains(_.findWhere(t.mainview.listview.conversations,{id:t.mainview.active}).tags,"group"),l={id:s.uuid,text:t.maxui.utils.formatText(s.data.text),date:t.maxui.utils.formatDate(s.published,t.maxui.language),othersMessage:u,literals:t.maxui.settings.literals,avatarURL:r,displayName:s.user.displayname,showDisplayName:u&&c,ack:!!s.ack&&"maxui-user-me"===o,fileDownload:"file"===s.data.objectType,filename:s.data.filename,auth:{token:t.maxui.settings.oAuthToken,username:t.maxui.settings.username}};i+=t.maxui.templates.message.render(l),"image"===s.data.objectType&&n.push(s)}e("#maxui-messages #maxui-message-list").html(i),_.each(n,function(i,n,a){t.maxui.maxClient.getMessageImage("/messages/{0}/image/thumb".format(i.uuid),function(n){var a='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(n);e(".maxui-message#{0} .maxui-body".format(i.uuid)).after(a),t.mainview.scrollbar.setContentPosition(100)})});var d=e("#maxui-messages #maxui-more-messages");"1"===t.remaining?d.show():d.hide()}},i.prototype.show=function(t){var i=this;i.mainview.loadWrappers();var n=e("#maxui-newactivity").find("input.maxui-button");n.removeAttr("disabled"),n.attr("class","maxui-button"),i.mainview.$newmessagebox.find("textarea").attr("class","maxui-text-input"),i.mainview.$newmessagebox.find(".maxui-error-box").animate({"margin-top":-26},200),i.mainview.$newparticipants.hide(),i.mainview.active=t,i.mainview.listview.resetUnread(t),_.has(i.messages,t)?(i.render(),i.toggle()):(i.load(),i.toggle())},i.prototype.toggle=function(){var e=this;e.mainview.loadWrappers();var t="";"messages"!==e.maxui.settings.conversationsSection&&(e.mainview.$addpeople.animate({height:0,"padding-top":0,"padding-bottom":0},400,function(t){e.mainview.$addpeople.css({"border-color":"transparent"})}),e.setTitle(e.mainview.getActive().displayName),e.mainview.$common_header.removeClass("maxui-showing-conversations").addClass("maxui-showing-messages"),e.mainview.$conversations_list.animate({"margin-left":-1*e.maxui.settings.sectionsWidth},400),e.mainview.$messages.animate({left:0,"margin-left":0},400,function(t){e.mainview.scrollbar.setHeight(e.mainview.height-45),e.mainview.scrollbar.setTarget("#maxui-conversations #maxui-messages"),e.mainview.scrollbar.setContentPosition(100)}),e.mainview.$messages.width(e.maxui.settings.sectionsWidth),e.maxui.settings.conversationsSection="messages",t=e.maxui.settings.literals.new_activity_text,e.mainview.$postbox.val(t).attr("data-literal",t))},n.prototype.visible=function(){var e=this;return e.$conversations.is(":visible")&&e.$conversations.height>0},n.prototype.loadScrollbar=function(){var e=this;e.scrollbar=new max.views.MaxScrollbar({maxui:e.maxui,width:e.maxui.settings.scrollbarWidth,handle:{height:20},scrollbar:e.el+" #maxui-scrollbar",target:e.el})},n.prototype.getActive=function(){var e=this;return _.findWhere(e.listview.conversations,{id:e.active})},n.prototype.loadWrappers=function(){var t=this;t.$conversations=e("#maxui-conversations"),t.$conversations_list=e("#maxui-conversations-list"),t.$conversations_wrapper=t.$conversations.find(".maxui-wrapper"),t.$messages=e("#maxui-messages"),t.$message_list=e("#maxui-message-list"),t.$postbox=e("#maxui-newactivity-box textarea"),t.$common_header=t.$conversations.find("#maxui-common-header"),t.$addpeople=e("#maxui-add-people-box"),t.$newparticipants=e("#maxui-new-participants"),t.$newmessagebox=e("#maxui-newactivity")},n.prototype.render=function(){var e=this;e.loadScrollbar(),e.bindEvents()},n.prototype.bindEvents=function(){var t=this;e("#maxui-conversation-info").click(function(e){e.preventDefault(),e.stopPropagation(),t.maxui.overlay.show(t.conversationSettings)}),e("#maxui-back-conversations").on("click",function(e){e.preventDefault(),e.stopPropagation(),window.status="",t.listview.show()}),e("#maxui-conversations").on("click",".maxui-conversation",function(i){i.preventDefault(),i.stopPropagation(),window.status="";var n=e(i.target).closest(".maxui-conversation").attr("id");t.messagesview.show(n)}),e("#maxui-conversations").on("click","#maxui-more-messages .maxui-button",function(e){e.preventDefault(),e.stopPropagation(),window.status="",t.messagesview.loadOlder()})},n.prototype.send=function(t){var i=this,n={data:{text:t},action:"add",object:"message"},a=i.maxui.messaging.send(n,"{0}.messages".format(i.active));e("#maxui-newactivity textarea").val(""),e("#maxui-newactivity .maxui-button").attr("disabled","disabled"),a.ack=!1,a.destination=i.active,i.messagesview.append(a),i.messagesview.show(i.active),i.scrollbar.setContentPosition(100),i.listview.updateLastMessage(i.active,{content:a.data.text,published:a.published,user:a.user.username})},n.prototype.create=function(e){var t=this;e.participants.push(t.maxui.settings.username),t.maxui.maxClient.addMessageAndConversation(e,function(i){var n=this,a=n.contexts[0].id,s={id:a,displayName:n.contexts[0].displayName,lastMessage:{content:n.object.content,published:n.published},participants:e.participants,tags:n.contexts[0].tags};t.active=a,t.listview.insert(s),t.messagesview.remaining=0,n.ack=!0,t.messagesview.append(n),t.messagesview.render(),t.messagesview.show(a),t.loadWrappers(),t.$newparticipants[0].people=[],t.maxui.reloadPersons()})},n.prototype.updateUnreadConversations=function(t){var i=this,n=e("#maxui-show-conversations .maxui-unread-conversations"),a=_.filter(i.listview.conversations,function(e){if(e.unread_messages>0)return e});a.length>0?(n.text(a.length),n.removeClass("maxui-hidden")):n.addClass("maxui-hidden")},n.prototype.ReceiveMessage=function(e){var t=this,i=e.user.username!==t.maxui.settings.username,n=t.messagesview.exists(e);(i||n)&&(i?t.maxui.logger.log("New message from user {0} on {1}".format(e.user.username,e.destination),t.logtag):t.maxui.logger.log("Updating {1} messages sent from other {0} instances".format(e.user.username,e.destination),t.logtag),t.messagesview.append(e),t.updateUnreadConversations(),"conversations"===t.maxui.settings.UISection&&"messages"===t.maxui.settings.conversationsSection?(t.messagesview.render(!1),t.scrollbar.setContentPosition(100)):"conversations"===t.maxui.settings.UISection&&"conversations"===t.maxui.settings.conversationsSection?t.listview.render(!1):"timeline"===t.maxui.settings.UISection&&t.listview.render(!1))},n.prototype.ReceiveConversation=function(e){var t=this,i=e.user.username!==t.maxui.settings.username,n=t.messagesview.exists(e);(i||n)&&("conversations"===t.maxui.settings.UISection&&"conversations"===t.maxui.settings.conversationsSection?(t.active=e.destination,t.listview.loadConversation(e.destination,function(t){this.messagesview.show(e.destination)})):"conversations"===t.maxui.settings.UISection&&"messages"===t.maxui.settings.conversationsSection?(t.active=e.destination,t.listview.loadConversation(e.destination,function(t){this.messagesview.load(),this.listview.resetUnread(e.destination)})):"timeline"===t.maxui.settings.UISection&&t.listview.loadConversation(e.destination,function(e){t.updateUnreadConversations(),t.listview.render()}))},{MaxConversations:n}}())}(jQuery);var max=max||{};max.templates=function(){return{activity:Hogan.compile('<div class="maxui-activity {{#flagged}}maxui-flagged{{/flagged}}" id="{{id}}" userid="{{actor.id}}" username="{{actor.username}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                    {{^showLikesCount}}<span class="maxui-publisheddate">{{date}}</span>{{/showLikesCount}}                    {{#showLikesCount}}<span class="maxui-likescount"><strong>{{likes}}</strong><i class="maxui-icon-thumbs-up"></i></span>{{/showLikesCount}}                </div>                <div class="maxui-actor">                      <a href="#"><span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                          <span class="maxui-displayname">{{actor.displayName}}</span></a>                  <span class="maxui-username">{{actor.username}}&nbsp;</span>                </div>                <div class="maxui-activity-message">                    {{#fileDownload}}                    <form action="/activities/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="{{filename}}">                    </form>                    {{/fileDownload}}                    <p class="maxui-body">{{&text}}</p>                        </div>            </div>            <div class="maxui-footer">                {{#publishedIn}}                <div class="maxui-origin maxui-icon-">                       {{literals.context_published_in}}                       <a href="{{publishedIn.url}}">{{publishedIn.displayName}}</a>                       {{#via}}                           {{literals.generator_via}}                           <span class="maxui-via">                           {{via}}                           </span>                       {{/via}}                </div>                {{/publishedIn}}                <div class="maxui-actions">                    <a href="" class="maxui-action maxui-commentaction maxui-icon- {{#replies}}maxui-has-comments{{/replies}}"><strong>{{replies.length}}</strong> {{literals.toggle_comments}}</a>                    <a href="" class="maxui-action maxui-favorites {{#favorited}}maxui-favorited{{/favorited}} maxui-icon-">{{literals.favorite}}</a>                    <a href="" class="maxui-action maxui-likes {{#liked}}maxui-liked{{/liked}} maxui-icon-">{{literals.like}}</a>                    {{#canFlagActivity}}                    <a href="" class="maxui-action maxui-flag {{#flagged}}maxui-flagged{{/flagged}} maxui-icon-">{{literals.flag_activity_icon}}</a>                    {{/canFlagActivity}}                    {{#canDeleteActivity}}                    <a href="" class="maxui-action maxui-delete maxui-icon-">{{literals.delete_activity_icon}}</a>                    <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                    </div>                    {{/canDeleteActivity}}                        </div>            </div>                    <div class="maxui-comments" style="display: none">                <div class="maxui-commentsbox">                    {{#replies}}                        {{> comment}}                    {{/replies}}                </div>                <div class="maxui-newcommentbox">                        <textarea class="maxui-empty maxui-text-input" id="maxui-commentBox" data-literal="{{literals.new_comment_text}}">{{literals.new_comment_text}}</textarea>                        <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{literals.new_comment_post}}"/>                </div>            </div>                    <div class="maxui-clear"></div>        </div>            '),comment:Hogan.compile('<div class="maxui-comment" id="{{id}}" userid="{{actor.id}}" displayname="{{actor.username}}">            <div class="maxui-activity-content">               <span class="maxui-publisheddate">{{date}}</span>               <div class="maxui-actor">                   <a href="#">                       <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                       <span class="maxui-displayname">{{actor.displayName}}</span></a>                     <span class="maxui-username">{{actor.username}}</span>               </div>               <div>                   <p class="maxui-body">{{&text}}</p>                   {{#canDeleteComment}}                   <span class="maxui-delete-comment maxui-icon-"></span>                   <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                   </div>                   {{/canDeleteComment}}               </div>            </div>        </div>            '),conversation:Hogan.compile('<div class="maxui-conversation" id="{{id}}" data-displayname="{{displayName}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                            <div class="maxui-publisheddate">{{date}}</div>                    <div class="maxui-enterconversation">                        <a class="maxui-enterconversation maxui-icon-" href="#"></a>                        {{#hasUnread}}<span class="maxui-unread-messages">{{messages}}</span>{{/hasUnread}}                    </div>                </div>                <div class="maxui-actor">                      <a href="#"><span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                      <span class="maxui-displayname">{{displayName}}</span></a>                </div>                <div>                    <p class="maxui-body">{{&text}}</p>                </div>            </div>                    <div class="maxui-clear"></div>        </div>            '),conversationSettings:Hogan.compile('<div id="maxui-{{panelID}}" {{#canManage}}class="maxui-owner"{{/canManage}}>          <span class="maxui-avatar maxui-big"><img src="{{conversationAvatarURL}}"></span>          <div id="maxui-conversation-displayname-edit">              <input type="text" class="maxui-displayname" value="{{displayName}}"/>              <i class="maxui-icon-cancel-circled"></i>              <i class="maxui-icon-ok-circled"></i>          </div>          <span class="maxui-displayname">{{displayName}}</span>          <span class="maxui-published">{{literals.conversations_info_created}} {{published}}</span>          <div class="maxui-participants">            <h4>{{literals.conversations_info_participants}}</h4>            <ul>              {{#participants}}              <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}">                  <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                  <span class="maxui-displayname">{{displayName}}                      <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="{{literals.conversations_info_kick_message_1}} {{displayName}} {{literals.conversations_info_kick_message_2}}"{{/owner}}></i>                      <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="{{literals.conversations_info_transfer_message_1}} {{displayName}} {{literals.conversations_info_transfer_message_2}}"{{/owner}}></i>                      <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                      <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                  </span>                  <span class="maxui-username">{{username}}</span>              </li>              {{/participants}}            </ul>            {{#canAdd}}            <div id="maxui-new-participant">                <i class="maxui-icon-user-add"/>                <input type="text" class="maxui-text-input maxui-empty"/>                <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            </div>            {{/canAdd}}            </div>            <div id="maxui-conversation-leave">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_leave}}">          </div>          <div id="maxui-conversation-delete">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_delete}}">              <div class="maxui-help">                  <p><b>{{literals.conversations_info_delete_warning}}</b> {{literals.conversations_info_delete_help}}</p>                  <button class="maxui-button maxui-button-red maxui-confirmation-cancel">{{literals.cancel}}</button>                  <button class="maxui-button maxui-button-green maxui-confirmation-ok">{{literals.delete}}</button>              </div>          </div>        </div>            '),filters:Hogan.compile('{{#filters}}            {{#visible}}            <div class="maxui-filter maxui-{{type}}" type="{{type}}" value="{{value}}"><span>{{prepend}}{{value}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>            {{/visible}}        {{/filters}}            '),mainUI:Hogan.compile('<div id="maxui-container">        {{#username}}         <div id="maxui-mainpanel">           <div id="maxui-conversations" style="height:0px; {{showConversations}}">               <div id="maxui-common-header">                  <div id="maxui-conversations-header" class="maxui-togglebar">                      <h3 class="maxui-title">{{literals.conversations}}</h3></a>                  </div>                  <div id="maxui-back-conversations" class="maxui-togglebar">                      <a class="maxui-icon-" href="#"> {{literals.conversations_list}}                      <h3 class="maxui-title">displayName</h3></a>                      <i id="maxui-conversation-info" class="maxui-icon-cog"/>                  </div>               </div>               <div class="maxui-wrapper">                   <div id="maxui-conversations-list" class="maxui-activities">                       <span id="maxui-info">{{literals.no_chats}}<span>                   </div>                           <div id="maxui-messages" style="{{messagesStyle}}">                       <div id="maxui-more-messages">                           <input type="button" class="maxui-button maxui-button-grey" value="{{literals.chats_load_older}}">                       </div>                       <div id="maxui-message-list">                       </div>                   </div>                </div>                   <div id="maxui-scrollbar">                          <div class="maxui-dragger handle"/>                   </div>           </div>                    <div id="maxui-show-conversations" class="maxui-togglebar maxui-icon-" style="{{showConversationsToggle}}">                <span class="maxui-unread-conversations maxui-hidden"></span> <a href="#">{{literals.conversations_lower}}</a>            </div>                    <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            <div id="maxui-add-people-box" style="display:none;">                <div>                  <label class="maxui-label">{{literals.participants}}: <span class="maxui-count">(1/20)</span></label>                  <input tabindex="20" type="text" data-literal="{{literals.conversations_info_add}}" value="{{literals.conversations_info_add}}" class="maxui-text-input" id="add-user-input">                </div>                <div id="maxui-new-participants" style="display:none;"></div>                <div id="maxui-new-displayName" style="display:none;">                    <label class="maxui-label">{{literals.conversation_name}}: </label>                    <input tabindex="21" type="text" class="maxui-simple-text-input"/>                </div>            </div>                   <div id="maxui-newactivity" {{#hidePostbox}}style="display:none;"{{/hidePostbox}}>           </div>                   <div id="maxui-search" class="folded">               <a id="maxui-search-toggle" class="maxui-disabled maxui-icon-" href="#" alt="obre-tanca"></a>               <a href="#" id="maxui-favorites-filter" title="{{literals.favorites_filter_hint}}"><i class="maxui-icon-star"/></a>               <div id="maxui-search-box">                  <input id="maxui-search-text" type="search" data-literal="{{literals.search_text}}" class="maxui-empty maxui-text-input" value="{{literals.search_text}}" />               </div>               <div id="maxui-search-filters"></div>           </div>                   <div id="maxui-show-timeline" class="maxui-togglebar maxui-icon-" style="{{showTimelineToggle}}"><a href="#">{{literals.activity}}</a></div>                      <div id="maxui-activity-sort">                <a class="maxui-sort-action maxui-most-recent {{orderViewRecent}}" href="#">{{literals.recent_activity}}</a>                /                <a class="maxui-sort-action maxui-most-valued {{orderViewLikes}}" href="#">{{literals.valued_activity}}</a>                /                <a class="maxui-sort-action maxui-flagged {{orderViewFlagged}}" href="#">{{literals.flagged_activity}}</a>              </div>              <div id="maxui-news-activities" hidden>                  <input type="button" class="maxui-button" value="Carrega noves entrades">              </div>           <div id="maxui-timeline" style="{{showTimeline}}">              <div class="maxui-wrapper">                  <div id="maxui-preload" class="maxui-activities" style="height:0px;overflow:hidden">                      <div class="maxui-wrapper">                      </div>                  </div>                  <div id="maxui-activities" class="maxui-activities">                  </div>                  <div id="maxui-more-activities">                      <input type="button" class="maxui-button" value="{{literals.load_more}}">                  </div>              </div>           </div>           <div id="maxui-overlay-background" class="maxui-overlay">           </div>           <div id="maxui-overlay-wrapper" class="maxui-overlay">               <div id="maxui-overlay-panel">                   <div id="maxui-overlay-header">                        <h3 id="maxui-overlay-title">I\'m a overlay</h3>                        <i class="maxui-close maxui-icon-cancel"/>                   </div>                   <div id="maxui-overlay-content">                   </div>               </div>           </div>          </div>         </div>        {{/username}}        {{^username}}          No s\'ha definit cap usuari        {{/username}}        </div>            '),message:Hogan.compile('<div class="maxui-message maxui-user-{{#othersMessage}}not{{/othersMessage}}me" id="{{id}}">            <div class="maxui-activity-content">                <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                <div class="maxui-balloon">                    {{#fileDownload}}                    <form action="/messages/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="File download">                    </form>                    {{/fileDownload}}                    {{#showDisplayName}}<span class="maxui-displayname">{{displayName}}</span>{{/showDisplayName}}                    <p class="maxui-body">{{&text}}</p>                    <span class="maxui-publisheddate">{{date}}</span>                    <i class="maxui-icon-check{{#ack}} maxui-ack{{/ack}}"></i>                </div>            </div>            <div class="maxui-clear"></div>        </div>            '),participant:Hogan.compile('  <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}" style="{{style}}">              <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>              <span class="maxui-displayname">{{displayName}}                  <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="Click to kick {{displayName}} out of this conversation"{{/owner}} style="display:none;"></i>                  <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="Click to make {{displayName}} the owner of this conversation"{{/owner}} style="display:none;"></i>                  <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-add-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>              </span>              <span class="maxui-username">{{username}}</span>          </li>            '),participants:Hogan.compile('{{#persons}}        <div class="maxui-filter maxui-participant" type="participant" username="{{username}}"><span>{{prepend}}{{displayName}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>        {{/persons}}            '),postBox:Hogan.compile('      <span class="maxui-avatar maxui-big">                  <img src="{{avatar}}">              </span>              <div id="maxui-newactivity-box">                   <div class="maxui-wrapper">                       <textarea class="maxui-empty maxui-text-input" data-literal="{{textLiteral}}">{{textLiteral}}</textarea>                       <div class="maxui-error-box"></div>                   </div>                            {{#showSubscriptionList}}                    <select id="maxui-subscriptions">                      {{#subscriptionList}}                        <option value="{{hash}}">{{displayname}}</option>                      {{/subscriptionList}}                    </select>                    {{/showSubscriptionList}}                   <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{buttonLiteral}}">              </div>            '),predictive:Hogan.compile('<li data-username="{{username}}" data-displayname="{{displayName}}" class="{{cssclass}}">        <img src="{{avatarURL}}"/><span>{{displayName}}</span>        </li>            ')}};var max=max||{};!function(e){function t(e){var t=this;t.logtag="MESSAGING",t.maxui=e,t.active=!1,t.vhost="/",t.max_retries=3,t.retry_interval=3e3,t.debug=t.maxui.settings.enableAlerts,t.token=t.maxui.settings.oAuthToken,t.stompServer=t.maxui.settings.maxTalkURL,e.settings.domain?t.domain=e.settings.domain:t.domain=t.domainFromMaxServer(t.maxui.settings.maxServerURL),t.login="",t.domain&&(t.login+=t.domain+":"),t.login+=t.maxui.settings.username,t.ws=new SockJS(t.stompServer),t.bindings=[],t.specification={uuid:{id:"g",type:"string"},user:{id:"u",type:"object",fields:{username:{id:"u"},displayname:{id:"d"}}},action:{id:"a",type:"char",values:{add:{id:"a"},delete:{id:"d"},modify:{id:"m"},refresh:{id:"r"},ack:{id:"k"}}},object:{id:"o",type:"char",values:{message:{id:"m"},conversation:{id:"c"},tweet:{id:"t"},activity:{id:"a"},context:{id:"x"},comment:{id:"t"}}},data:{id:"d",type:"object"},source:{id:"s",type:"char",values:{max:{id:"m"},widget:{id:"w"},ios:{id:"i"},android:{id:"a"},tweety:{id:"t"},maxbunny:{id:"b"}}},domain:{id:"i",type:"string"},version:{id:"v",type:"string"},published:{id:"p",type:"date"}},t._specification={},_.each(t.specification,function(e,i,n){var a=_.clone(e);_.has(a,"values")&&(a.values={},_.each(e.values,function(e,t,i){a.values[e.id]=_.clone(e),a.values[e.id].name=t,delete a.values[e.id].id})),_.has(a,"fields")&&"object"===a.type&&(a.fields={},_.each(e.fields,function(e,t,i){a.fields[e.id]=_.clone(e),a.fields[e.id].name=t,delete a.fields[e.id].id})),a.name=i,delete a.id,t._specification[e.id]=a})}t.prototype.domainFromMaxServer=function(e){var t=e.replace(/\/$/,""),i=document.createElement("a");return i.href=t,_.last(i.pathname.split("/"))},t.prototype.start=function(){var e=this;e.maxui.logger.info("Connecting ...",e.logtag),e.connect();var t=1,i=setInterval(function(n){!e.active&&t<=e.max_retries?(e.maxui.logger.debug("Connection retry #{0}".format(t),e.logtag),e.ws.close(),e.ws=new SockJS(e.maxui.settings.maxTalkURL),e.connect()):(e.active||e.maxui.logger.error("Connection failure after {0} reconnect attempts".format(e.max_retries),e.logtag),clearInterval(i)),t+=1},e.retry_interval)},t.prototype.bind=function(e,t){var i=this;i.bindings.push({key:i.pack(e),callback:t})},t.prototype.on_message=function(e,t){var i=this,n=_.filter(i.bindings,function(t){var i=_.pick(e,_.keys(t.key));if(_.isEqual(t.key,i))return t});_.isEmpty(n)?i.maxui.logger.warning("Ignoring received message\n{0}\n No binding found for this message".format(e),i.logtag):_.each(n,function(n,a,s){i.maxui.logger.debug('Matched binding "{1}"'.format(e,n.key),i.logtag);var r=i.unpack(e),o=t.replace(/(\w+)\.(.*)/g,"$1");r.destination=o,n.callback(r)})},t.prototype.disconnect=function(){this.stomp.disconnect()},t.prototype.connect=function(){var t=this;t.stomp=Stomp.over(t.ws),t.stomp.heartbeat.outgoing=0,t.stomp.heartbeat.incoming=0,t.stomp.debug=function(e){t.maxui.logger.debug(e,t.logtag)};var i="maxui";t.maxui.settings.generator&&(i+="[{0}]".format(t.maxui.settings.generator));var n={login:t.login,passcode:t.token,host:t.vhost,product:i,"product-version":t.maxui.version,platform:"{0} {1} / {2} {3}".format(e.ua.browser.name,e.ua.browser.version,e.ua.os.name,e.ua.os.version)},a=function(e){t.stomp.subscribe("/exchange/{0}.subscribe".format(t.maxui.settings.username),function(e){var i=JSON.parse(e.body),n=/([^/])+$/.exec(e.headers.destination)[0];t.on_message(i,n)}),t.active=!0,t.maxui.logger.info("Succesfully connected to {0}".format(t.stompServer),t.logtag)},s=function(e){t.maxui.logger.error(e.body)};t.stomp.connect(n,a,s)},t.prototype.pack=function(e){var t,i=this,n={};return _.each(e,function(a,s,r){var o=i.specification[s];if(_.isUndefined(o));else{var u;if(_.has(o,"values"))_.has(o.values,a)&&(u=o.values[a].id);else if(u=a,_.has(o,"fields")&&"object"===o.type&&_.isObject(u)){var c={};_.each(e[s],function(e,i,n){t=_.has(o.fields,i)?o.fields[i].id:i,c[t]=e}),u=c}_.isUndefined(u)||(n[o.id]=u)}}),n},t.prototype.unpack=function(e){var t,i=this,n={};return _.each(e,function(a,s,r){var o=i._specification[s];if(_.isUndefined(o));else{var u;if(_.has(o,"values"))_.has(o.values,a)&&(u=o.values[a].name);else if(u=a,_.has(o,"fields")&&"object"===o.type&&_.isObject(u)){var c={};_.each(e[s],function(e,i,n){t=_.has(o.fields,i)?o.fields[i].name:i,c[t]=e}),u=c}_.isUndefined(u)||(n[o.name]=u)}}),n},t.prototype.prepare=function(e){var t=this,i={source:"widget",version:t.maxui.version,user:{username:t.maxui.settings.username,displayname:t.maxui.settings.displayName},published:t.maxui.utils.rfc3339(t.maxui.utils.now()),uuid:uuid.v1()};return t.domain&&(i.domain=t.domain),_.extend(_.pick(e,_.keys(t.specification)),i)},t.prototype.send=function(e,t){var i=this,n=i.prepare(e);return i.stomp.send("/exchange/{0}.publish/{1}".format(i.maxui.settings.username,t),{},JSON.stringify(i.pack(n))),n},max.MaxMessaging=t}(jQuery);var max=max||{};!function(e){function t(e){this.level=0}var i={debug:0,info:1,warn:2,error:3};t.prototype.setLevel=function(e){this.level=i[e]},t.prototype.log=function(e,t){try{window.console.log("{0}: {1}".format(t,e))}catch(e){}},t.prototype.debug=function(e){var t="MAXUI";arguments.length>1&&(t=arguments[1]);var n=this;n.level<=i.debug&&n.log(e,t)},t.prototype.info=function(e){var t="MAXUI";arguments.length>1&&(t=arguments[1]);var n=this;n.level<=i.info&&n.log(e,t)},t.prototype.warn=function(e){var t="MAXUI";arguments.length>1&&(t=arguments[1]);var n=this;n.level<=i.warn&&n.log(e,t)},t.prototype.error=function(e){var t="MAXUI";arguments.length>1&&(t=arguments[1]);var n=this;n.level<=i.error&&n.log(e,t)},max.MaxLogging=t}(jQuery);var max=max||{};max.literals=function(e){var t={};return t.en={cancel:"Cancel",delete:"Delete",months:["January","February","March","April","May","June","July","August","September","October","November","December"],new_activity_text:"Write something...",activity:"activity",conversations_lower:"chats",conversations:"Chats",conversations_list:"chats list",conversations_info_title:"Chat information",conversations_info_participants:"Participants",conversations_info_owner:"owner",conversations_info_add:"Add participant...",conversations_info_created:"Created",conversations_info_leave:"Leave chat",conversations_info_delete:"Delete chat",conversations_info_delete_warning:"Warning!",conversations_info_delete_help:"If you delete the chat, the participants will not be able to see the messages anymore. To avoid this, cancel and transfer the ownership to someone else.",conversations_info_kick_message_1:"Click to kick",conversations_info_kick_message_2:"out of this chat",conversations_info_transfer_message_1:"Click to make",conversations_info_transfer_message_2:"the owner of this chat",participants:"Talk to",chats_load_older:"Load older",conversation_name:"Chat name",message:"Message",no_chats:"No chats already",no_match_found:"No match found",new_conversation_text:"Add participants and send a message to start a chat",new_activity_post:"Post activity",toggle_comments:"comments",new_comment_text:"Comment something...",new_comment_post:"Post comment",load_more:"Load more",context_published_in:"Published in",generator_via:"via",search_text:"Search in posts...",and_more:"and more...",new_message_post:"Send message",post_permission_unauthorized:"You''re not authorized to post on this context",post_permission_not_here:"You're not mentioning @anyone",post_permission_not_enough_participants:"You have to add participants",post_permission_missing_displayName:"You have to name the chat",delete_activity_confirmation:"Are you sure?",delete_activity_delete:"Delete",delete_activity_cancel:"Cancel",delete_activity_icon:"delete",flag_activity_icon:"flagged",favorites_filter_hint:"Filter by favorited activity",favorites:"Favorites",favorite:"favorite",unfavorite:"unfavorite",like:"like",unlike:"unlike",recent_activity:"Latest activity",valued_activity:"Most valued activity",flagged_activity:"Flagged activity",recent_favorited_activity:"Latest favorites",valued_favorited_activity:"Most valued favorites"},t.es={cancel:"Cancelar",delete:"Eliminar",months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],new_activity_text:"Escribe algo...",activity:"actividad",conversations_lower:"chats",conversations:"Chats",conversations_list:"lista de chats",conversations_info_title:"Información del chat",conversations_info_participants:"Participantes",conversations_info_owner:"propietario",conversations_info_add:"Añade participante...",conversations_info_created:"Creada",conversations_info_leave:"Abandonar chat",conversations_info_delete:"Borra el chat",conversations_info_delete_warning:"Atención!",conversations_info_delete_help:"Si eliminas el chat, los participantes dejarán de ver los mensajes. Para evitar esto, cancela y luego traspasa el chat a otra persona.",conversations_info_kick_message_1:"Clica para echar a",conversations_info_kick_message_2:"de este chat",conversations_info_transfer_message_1:"Clica para dar a ",conversations_info_transfer_message_2:"la administración del chat",participants:"Chatear con",chats_load_older:"Cargar antiguos",conversation_name:"Nombre del chat",message:"Mensaje",no_chats:"No hay chats",no_match_found:"No hay coincidencias",new_conversation_text:"Añade participantes y envia el mensaje para iniciar un chat",new_activity_post:"Publica",toggle_comments:"comentarios",new_comment_text:"Comenta algo...",new_comment_post:"Comenta",load_more:"Cargar más",context_published_in:"Publicado en",generator_via:"via",search_text:"Busca en las entradas...",and_more:"i más...",new_message_post:"Envia el mensaje",post_permission_unauthorized:"No estas autorizado a publicar en este contexto",post_permission_not_here:"No estas citando a @nadie",post_permission_not_enough_participants:"Tienes que añadir participantes",post_permission_missing_displayName:"Tienes que dar un nombre al chat",delete_activity_confirmation:"Estás seguro?",delete_activity_delete:"Borrar",delete_activity_cancel:"Cancelar",delete_activity_icon:"borrar",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra por actividad favorita",favorites:"Favoritos",favorite:"favorito",unfavorite:"quitar favorito",like:"me gusta",unlike:"ya no me gusta",recent_activity:"Últimas actividades",valued_activity:"Actividades más valoradas",flagged_activity:"Actividades destacadas",recent_favorited_activity:"Últimas favoritas",valued_favorited_activity:"Favoritas más valoradas"},t.ca={cancel:"Cancelar",delete:"Elimina",months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],new_activity_text:"Escriu alguna cosa...",activity:"activitat",conversations_lower:"xats",conversations:"Xats",conversations_list:"llista de xats",conversations_info_title:"Informació del xat",conversations_info_participants:"Participants",conversations_info_owner:"propietari",conversations_info_add:"Afegeix participant...",conversations_info_created:"Creada",conversations_info_leave:"Marxar del xat",conversations_info_delete:"Esborra el xat",conversations_info_delete_warning:"Alerta!",conversations_info_delete_help:"Si elimines el xat, la resta de participants deixaran de veure els missatges. Per evitar-ho, cancela i traspassa el xat a algú altre.",conversations_info_kick_message_1:"Clica per fer fora a ",conversations_info_kick_message_2:"d'aquest xat",conversations_info_transfer_message_1:"Clica per fer a",conversations_info_transfer_message_2:"l'administrador d'aquest xat",participants:"Xateja amb",chats_load_older:"Carregar antics",conversation_name:"Nom del xat",message:"Missatge",no_chats:"No hi ha xats",no_match_found:"No s'han trobat coincidències",new_conversation_text:"Afegeix participants i envia el missatge per iniciar un xat",new_activity_post:"Publica",toggle_comments:"comentaris",new_comment_text:"Comenta alguna cosa...",new_comment_post:"Comenta",load_more:"Carrega'n més",context_published_in:"Publicat a",generator_via:"via",search_text:"Cerca a les entrades...",and_more:"i més...",new_message_post:"Envia el missatge",post_permission_unauthorized:"No estàs autoritzat a publicar en aquest contexte",post_permission_not_here:"No estas citant a @ningú",post_permission_not_enough_participants:"Has d'afegir participants",post_permission_missing_displayName:"Tens que posar nom al xat",delete_activity_confirmation:"Estàs segur?",delete_activity_delete:"Esborra",delete_activity_cancel:"No ho toquis!",delete_activity_icon:"esborra",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra per activitat favorita",favorites:"Favorits",favorite:"favorit",unfavorite:"treure favorit",like:"m'agrada",unlike:"ja no m'agrada",recent_activity:"Darreres activitats",valued_activity:"Activitats més valorades",flagged_activity:"Activitats destacades",recent_favorited_activity:"Darreres favorites",valued_favorited_activity:"Favorites més valorades"},t[e]};var max=max||{};max.utils=function(){var e={};return{setSettings:function(t){e=t},freezeEvent:function(e){return e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},normalizeWhiteSpace:function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},formatText:function(e){return e&&(e=(e=(e=e.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(e){var t=e;return t.match("^https?://")||(t="http://"+t),'<a href="'+t+'">'+e+"</a>"})).replace(/(\s|^)#{1}(\w+)/gi,function(){var e=arguments[1],t=arguments[2];return'<a class="maxui-hashtag" href="#" value="'+t+'">'+e+"#"+t+"</a>"})).replace(/\r?\n/gi,"<br/>")),e},isCORSCapable:function(){return void 0!==(new XMLHttpRequest).withCredentials},removeValueFrom:function(e){for(var t,i,n=arguments,a=n.length;a>1&&e.length;)for(t=n[--a];-1!==(i=e.indexOf(t));)e.splice(i,1);return e},timestamp:function(){return new Date/1},now:function(){return new Date},rfc3339:function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},formatDate:function(t,i){var n=new Date,a="",s="",r=new Date,o=t.match("^([-+]?)(\\d{4,})(?:-?(\\d{2})(?:-?(\\d{2})(?:[Tt ](\\d{2})(?::?(\\d{2})(?::?(\\d{2})(?:\\.(\\d{1,3})(?:\\d+)?)?)?)?(?:[Zz]|(?:([-+])(\\d{2})(?::?(\\d{2}))?)?)?)?)?)?$");if(o){for(var u=[2,3,4,5,6,7,8,10,11],c=u.length-1;c>=0;--c)o[u[c]]=void 0!==o[u[c]]&&o[u[c]].length>0?parseInt(o[u[c]],10):0;"-"===o[1]&&(o[2]*=-1);var l=Date.UTC(o[2],o[3]-1,o[4],o[5],o[6],o[7],o[8]);void 0!==o[9]&&o[9].length>0&&(l+=("+"===o[9]?-1:1)*(3600*o[10]*1e3+60*o[11]*1e3)),o[2]>=0&&o[2]<=99&&(l-=59958144e6);return r.setTime(l),n.getTime()-l<2592e5?a=jQuery.easydate.format_date(r,i):("en"===i?a="{0} {1}".format(o[4],e.literals.months[o[3]-1]):"es"===i?a="{0} de {1}".format(o[4],e.literals.months[o[3]-1]):"ca"===i&&(s="de ",4!==o[3]&&8!==o[3]&&10!==o[3]||(s="d'"),a="{0} {2}{1}".format(o[4],e.literals.months[o[3]-1],s)),n.getTime()-l>31536e6&&(a="{0}/{1}/{2}".format(o[4],o[3],o[2]))),a}return null},utf8_decode:function(e){var t=[],i=0,n=0,a=0,s=0,r=0;for(e+="";i<e.length;)(a=e.charCodeAt(i))<128?(t[n++]=String.fromCharCode(a),i++):a>191&&a<224?(s=e.charCodeAt(i+1),t[n++]=String.fromCharCode((31&a)<<6|63&s),i+=2):(s=e.charCodeAt(i+1),r=e.charCodeAt(i+2),t[n++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&r),i+=3);return t.join("")},sha1:function(e){function t(e,t){return e<<t|e>>>32-t}function i(e){var t,i="";for(t=7;t>=0;t--)i+=(e>>>4*t&15).toString(16);return i}var n,a,s,r,o,u,c,l,d,p=new Array(80),m=1732584193,f=4023233417,v=2562383102,h=271733878,g=3285377520,x=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e)).length,y=[];for(a=0;a<x-3;a+=4)s=e.charCodeAt(a)<<24|e.charCodeAt(a+1)<<16|e.charCodeAt(a+2)<<8|e.charCodeAt(a+3),y.push(s);switch(x%4){case 0:a=2147483648;break;case 1:a=e.charCodeAt(x-1)<<24|8388608;break;case 2:a=e.charCodeAt(x-2)<<24|e.charCodeAt(x-1)<<16|32768;break;case 3:a=e.charCodeAt(x-3)<<24|e.charCodeAt(x-2)<<16|e.charCodeAt(x-1)<<8|128}for(y.push(a);y.length%16!=14;)y.push(0);for(y.push(x>>>29),y.push(x<<3&4294967295),n=0;n<y.length;n+=16){for(a=0;a<16;a++)p[a]=y[n+a];for(a=16;a<=79;a++)p[a]=t(p[a-3]^p[a-8]^p[a-14]^p[a-16],1);for(r=m,o=f,u=v,c=h,l=g,a=0;a<=19;a++)d=t(r,5)+(o&u|~o&c)+l+p[a]+1518500249&4294967295,l=c,c=u,u=t(o,30),o=r,r=d;for(a=20;a<=39;a++)d=t(r,5)+(o^u^c)+l+p[a]+1859775393&4294967295,l=c,c=u,u=t(o,30),o=r,r=d;for(a=40;a<=59;a++)d=t(r,5)+(o&u|o&c|u&c)+l+p[a]+2400959708&4294967295,l=c,c=u,u=t(o,30),o=r,r=d;for(a=60;a<=79;a++)d=t(r,5)+(o^u^c)+l+p[a]+3395469782&4294967295,l=c,c=u,u=t(o,30),o=r,r=d;m=m+r&4294967295,f=f+o&4294967295,v=v+u&4294967295,h=h+c&4294967295,g=g+l&4294967295}return(d=i(m)+i(f)+i(v)+i(h)+i(g)).toLowerCase()}}},Object.keys||(Object.keys=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}),String.prototype.format=function(){var e=arguments;return this.replace(/\{\d+\}/g,function(t){return e[t.match(/\d+/)]})},MaxClient.prototype.configure=function(e){this.url=e.server,this.mode=e.mode,this.token=e.token,this.actor={objectType:"person",username:e.username}},MaxClient.prototype.POST=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return arguments.length>3&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",contentType:"application/json",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.PUT=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return arguments.length>3&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","PUT")},contentType:"application/json",type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.DELETE=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return arguments.length>2&&(s=arguments[2]),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","DELETE")},type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.GET=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};arguments.length>3&&(s=arguments[3]),Object.keys(t).length>0&&(a+="?"+jQuery.param(t,!0));var r={url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},processData:!0,type:"GET",async:!0,dataType:"json"};return arguments.length>3&&_.extend(r,arguments[3]),jQuery.ajax(r).done(function(e,t,n){s.done&&jQuery(window).trigger(s.done),i.apply(n,[e])}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail)}),!0},MaxClient.prototype.getUserData=function(e,t){var i=this.ROUTES.user.format(e),n={};this.GET(i,n,t)},MaxClient.prototype.getUsersList=function(e,t){var i=this.ROUTES.users,n={username:e};this.GET(i,n,t)},MaxClient.prototype.getContext=function(e,t){var i=this.ROUTES.context.format(e),n={};this.GET(i,n,t)},MaxClient.prototype.getUserTimeline=function(e,t){var i=this.ROUTES.timeline.format(e),n={};arguments.length>2&&(n=arguments[2]),this.GET(i,n,t)},MaxClient.prototype.getActivities=function(e,t){var i=this.ROUTES.activities.format(e.context),n={};arguments.length>2&&(n=arguments[2]),e.tags&&e.tags.length>0&&(n.context_tags=e.tags),this.GET(i,n,t)},MaxClient.prototype.getCommentsForActivity=function(e,t){var i=this.ROUTES.comments.format(e),n={};this.GET(i,n,t)},MaxClient.prototype.addComment=function(e,t,i){var n={actor:{},object:{objectType:"comment",content:""}};n.actor=this.actor,n.object.content=e;var a=this.ROUTES.comments.format(t);this.POST(a,n,i)},MaxClient.prototype.addActivity=function(e,t,i){var n={object:{objectType:"note",content:""}};if(t.length>0){n.contexts=[];for(var a=0;a<t.length;a++)n.contexts.push({objectType:"context",url:t[a]})}n.object.content=e,arguments.length>3&&(n.generator=arguments[3]);var s=this.ROUTES.user_activities.format(this.actor.username),r={done:"maxui-posted-activity",fail:"maxui-failed-activity"};this.POST(s,n,i,r)},MaxClient.prototype.removeActivity=function(e,t){var i=this.ROUTES.activity.format(e);this.DELETE(i,{},t)},MaxClient.prototype.removeActivityComment=function(e,t,i){var n=this.ROUTES.comment.format(e,t);this.DELETE(n,{},i)},MaxClient.prototype.getConversationSubscription=function(e,t,i){var n=this.ROUTES.user_conversation.format(t,e),a={};this.GET(n,a,i)},MaxClient.prototype.getConversation=function(e,t){var i=this.ROUTES.conversation.format(e),n={};this.GET(i,n,t)},MaxClient.prototype.modifyConversation=function(e,t,i){var n={displayName:t},a=this.ROUTES.conversation.format(e);this.PUT(a,n,i)},MaxClient.prototype.addUserToConversation=function(e,t,i){var n={},a=this.ROUTES.user_conversation.format(t,e);this.POST(a,n,i)},MaxClient.prototype.kickUserFromConversation=function(e,t,i){var n={},a=this.ROUTES.user_conversation.format(t,e);this.DELETE(a,n,i)},MaxClient.prototype.deleteConversation=function(e,t){var i={},n=this.ROUTES.conversation.format(e);this.DELETE(n,i,t)},MaxClient.prototype.leaveConversation=function(e,t,i){var n={},a=this.ROUTES.user_conversation.format(t,e);this.DELETE(a,n,i)},MaxClient.prototype.transferConversationOwnership=function(e,t,i){var n={actor:{username:t}},a=this.ROUTES.conversation_owner.format(e);this.PUT(a,n,i)},MaxClient.prototype.getConversationsForUser=function(e,t){var i=this.ROUTES.conversations,n={};this.GET(i,n,t)},MaxClient.prototype.getMessageImage=function(e,t){var i={},n={processData:!1,dataType:void 0,contentType:"application/base64"};this.GET(e,i,t,n)},MaxClient.prototype.getMessagesForConversation=function(e,t,i){var n=this.ROUTES.messages.format(e),a=t;this.GET(n,a,i)},MaxClient.prototype.addMessageAndConversation=function(e,t){var i={object:{objectType:"note",content:e.message},contexts:[{objectType:"conversation",participants:e.participants}]};e.displayName&&(i.contexts[0].displayName=e.displayName);var n=this.ROUTES.conversations;this.POST(n,i,t)},MaxClient.prototype.addMessage=function(e,t,i){var n={object:{objectType:"note",content:""}};n.object.content=e;var a=this.ROUTES.messages.format(t);this.POST(a,n,i)},MaxClient.prototype.follow=function(e,t){var i={object:{objectType:"person",username:""}};i.object.username=e;var n=this.ROUTES.follow.format(this.actor.username,e);this.POST(n,i,t)},MaxClient.prototype.favoriteActivity=function(e,t){var i={},n=this.ROUTES.favorites.format(e);this.POST(n,i,t)},MaxClient.prototype.unfavoriteActivity=function(e,t){var i={},n=this.ROUTES.favorite.format(e,this.actor.username);this.DELETE(n,i,t)},MaxClient.prototype.likeActivity=function(e,t){var i={},n=this.ROUTES.likes.format(e);this.POST(n,i,t)},MaxClient.prototype.unlikeActivity=function(e,t){var i={},n=this.ROUTES.like.format(e,this.actor.username);this.DELETE(n,i,t)},MaxClient.prototype.flagActivity=function(e,t){var i={},n=this.ROUTES.flag.format(e);this.POST(n,i,t)},MaxClient.prototype.unflagActivity=function(e,t){var i={},n=this.ROUTES.flag.format(e);this.DELETE(n,i,t)},function(e){e.fn.maxUI=function(t){var i=this;i.version="4.1.18",i.templates=max.templates(),i.utils=max.utils();var n={maxRequestsAPI:"jquery",maxServerURL:"https://max.upc.edu",readContext:void 0,writeContexts:[],activitySource:"timeline",enableAlerts:!1,UISection:"timeline",disableTimeline:!1,disableConversations:!1,conversationsSection:"conversations",currentConversationSection:"conversations",activitySortOrder:"activities",activitySortView:"recent",maximumConversations:20,contextTagsFilter:[],scrollbarWidth:10,widgetWidth:"0",sectionHorizontalPadding:20,widgetBorder:2,loglevel:"info",hidePostboxOnTimeline:!1,maxTalkURL:"",generator:"",domain:"",showSubscriptionList:!1};i.settings=e.extend(n,t),i.logger=new max.MaxLogging(i),i.logger.setLevel(i.settings.loglevel),i.utils.isCORSCapable()||i.settings.maxServerURLAlias&&(i.settings.maxServerURL=i.settings.maxServerURLAlias),i.settings.maxTalkURL=i.utils.normalizeWhiteSpace(i.settings.maxTalkURL),(_.isUndefined(i.settings.maxTalkURL)||""===i.settings.maxTalkURL)&&(i.settings.maxTalkURL=i.settings.maxServerURL+"/stomp"),i.settings.domain=i.utils.normalizeWhiteSpace(i.settings.domain),"none"===i.settings.domain.toLowerCase()&&(i.settings.domain=""),"timeline"===i.settings.UISection&&"timeline"===i.settings.activitySource&&i.settings.readContext&&(i.settings.readContext=void 0,i.settings.writeContexts=[]),i.settings.showSubscriptionList&&"activities"===i.settings.activitySource&&(i.settings.showSubscriptionList=!1),i.language=t.language||"en";var a=t.literals||{};if(i.settings.literals=e.extend(max.literals(i.language),a),i.settings.readContext){i.settings.readContextHash=i.utils.sha1(i.settings.readContext),i.settings.writeContexts.push(i.settings.readContext),i.settings.writeContextsHashes=[];for(var s=0;s<i.settings.writeContexts.length;s++)i.settings.writeContextsHashes.push(i.utils.sha1(i.settings.writeContexts[s]))}i.settings.avatarURLpattern||(i.settings.avatarURLpattern=i.settings.maxServerURL+"/people/{0}/avatar"),i.settings.contextAvatarURLpattern||(i.settings.contextAvatarURLpattern=i.settings.maxServerURL+"/contexts/{0}/avatar"),i.settings.conversationAvatarURLpattern||(i.settings.conversationAvatarURLpattern=i.settings.maxServerURL+"/conversations/{0}/avatar"),i.settings.enableAlerts&&e(window).bind("maxclienterror",function(e,t){var i=JSON.parse(t.responseText);alert('The server responded with a "{0}" error, with the following message: "{1}". \n\nPlease try again later or contact administrator at admin@max.upc.edu.'.format(i.error,i.error_description))}),i.maxClient=new MaxClient;var r={server:i.settings.maxServerURL,mode:i.settings.maxRequestsAPI,username:i.settings.username,token:i.settings.oAuthToken};return i.maxClient.configure(r),i.messaging=new max.MaxMessaging(i),i.conversations=new max.views.MaxConversations(i,{}),i.settings.disableConversations||(i.messaging.bind({action:"add",object:"message"},function(e){i.conversations.ReceiveMessage(e)}),i.messaging.bind({action:"add",object:"conversation"},function(e){i.conversations.ReceiveConversation(e)}),i.messaging.bind({action:"refresh",object:"conversation"},function(e){i.conversations.messagesview.load(e.destination)}),i.messaging.bind({action:"ack",object:"message"},function(e){i.conversations.messagesview.ack(e)})),i.utils.setSettings(i.settings),this.maxClient.getUserData(i.settings.username,function(t){i.settings.displayName=t.displayName||i.settings.username;var n={},a=[];if(t.subscribedTo&&t.subscribedTo&&t.subscribedTo.length>0)for(var s=0;s<t.subscribedTo.length;s++){var r=t.subscribedTo[s];n[r.hash]={},n[r.hash].permissions={};for(var o=0;o<r.permissions.length;o++){var u=r.permissions[o];n[r.hash].permissions[u]=!0,"write"===u&&a.push({hash:r.url,displayname:r.displayName})}}i.settings.subscriptionsWrite=a,i.settings.subscriptions=n,i.settings.disableConversations||(i.messaging.start(),e(window).on("beforeunload",function(e){return i.messaging.disconnect()}));var c="conversations"===i.settings.UISection,l="timeline"===i.settings.UISection,d=!1===i.settings.disableTimeline&&!l,p=!1===i.settings.disableConversations&&!c,m=i.width()-i.settings.scrollbarWidth,f="recent"===i.settings.activitySortView,v="likes"===i.settings.activitySortView,h="flagged"===i.settings.activitySortView,g={username:i.settings.username,literals:i.settings.literals,showConversations:c?"display:block;":"display:none;",showConversationsToggle:p?"display:block;":"display:none;",showTimeline:l?"display:block;":"display:none;",showTimelineToggle:d?"display:block;":"display:none;",orderViewRecent:f?"active":"",orderViewLikes:v?"active":"",orderViewFlagged:h?"active":"",messagesStyle:"width:{0}px;left:{0}px;".format(m),hidePostbox:i.settings.hidePostboxOnTimeline},x=i.templates.mainUI.render(g);if(i.html(x),i.overlay=new max.views.MaxOverlay(i),i.settings.widgetWidth=i.width(),i.settings.sectionsWidth=i.settings.widgetWidth-i.settings.scrollbarWidth-i.settings.widgetBorder,i.settings.disableConversations||(i.conversations.render(),i.conversations.listview.load(t.talkingIn)),"conversations"===i.settings.UISection)i.bindEvents(),i.toggleSection("conversations");else if("timeline"===i.settings.UISection){var y={recent:i.settings.activitySortOrder,likes:"likes",flagged:"flagged"};i.printActivities({sortBy:y[i.settings.activitySortView]},function(e){i.bindEvents()})}}),i},e.fn.bindEvents=function(){var t=this;e("#maxui-more-activities .maxui-button").click(function(i){if(i.preventDefault(),e("#maxui-search").hasClass("folded"))t.loadMoreActivities();else{var n=e(".maxui-activity:last").attr("id");t.reloadFilters(n)}}),e("#maxui-news-activities .maxui-button").click(function(e){t.loadNewsActivities()}),e("#maxui-search-toggle").click(function(i){i.preventDefault(),e(this).hasClass("maxui-disabled")||(e("#maxui-search").toggleClass("folded"),e("#maxui-search").hasClass("folded")?t.printActivities({}):t.reloadFilters())}),e("#maxui-activities").on("click",".maxui-commentaction",function(t){t.preventDefault(),window.status="",e(this).closest(".maxui-activity").find(".maxui-comments").toggle(200)}),e("#maxui-activities").on("click",".maxui-actor",function(i){i.preventDefault();var n=e(this).find(".maxui-username").text();t.addFilter({type:"actor",value:n}),e("#maxui-search").toggleClass("folded",!1)}),e("#maxui-search").on("click","#maxui-favorites-filter",function(i){i.preventDefault();var n=e(i.currentTarget),a=!n.hasClass("active"),s="",r="";a?(t.addFilter({type:"favorites",value:!0,visible:!1}),s=t.settings.literals.valued_favorited_activity,r=t.settings.literals.recent_favorited_activity):(t.delFilter({type:"favorites",value:!0}),s=t.settings.literals.valued_activity,r=t.settings.literals.recent_activity),n.toggleClass("active",a),e("#maxui-activity-sort .maxui-most-recent").text(r),e("#maxui-activity-sort .maxui-most-valued").text(s)}),e("#maxui-activities").on("click",".maxui-hashtag",function(i){i.preventDefault(),t.addFilter({type:"hashtag",value:e(this).attr("value")}),e("#maxui-search").toggleClass("folded",!1)}),e("#maxui-subscriptions").on("change",function(){var i=e("#maxui-subscriptions :selected").val();if("timeline"!==i){t.settings.writeContexts=[],t.settings.writeContextsHashes=[],t.settings.writeContexts.push(i);for(var n=0;n<t.settings.writeContexts.length;n++)t.settings.writeContextsHashes.push(t.utils.sha1(t.settings.writeContexts[n]))}else t.settings.writeContexts=[],t.settings.writeContextsHashes=void 0}),e("#maxui-search-filters").on("click",".maxui-close",function(i){i.preventDefault();var n=e(this.parentNode.parentNode);t.delFilter({type:n.attr("type"),value:n.attr("value")})}),e("#maxui-new-participants").on("click",".maxui-close",function(i){i.preventDefault();var n=e(this.parentNode.parentNode);t.delPerson({username:n.attr("username")})}),e("#maxui-new-displayName").on("keyup","input",function(e){e.preventDefault(),t.reloadPersons()}),e("#maxui-newactivity").on("click",".maxui-prediction",function(t){t.preventDefault();var i=e(this),n=e("#maxui-newactivity-box textarea"),a=e("#maxui-newactivity #maxui-predictive"),s=n.val(),r=new RegExp("^\\s*@([\\w\\.]+)"),o=s.replace(r,"@"+i.text()+" ");a.hide(),n.val(o),n.focus()}),e(document).on("click",function(t){e(".maxui-predictive").hide()}),e("#maxui-conversation-predictive").on("click",".maxui-prediction",function(i){i.preventDefault();var n=e(this),a=e("#maxui-add-people-box .maxui-text-input"),s=e("#maxui-conversation-predictive"),r=n.attr("data-username"),o=n.attr("data-displayname");t.addPerson({username:r,displayName:o}),s.hide(),a.val("").focus()}),e("#maxui-show-conversations").on("click",function(e){e.preventDefault(),window.status="",t.toggleSection("conversations")}),e("#maxui-show-timeline").on("click",function(e){e.preventDefault(),window.status="",t.printActivities({},function(e){t.toggleSection("timeline")})}),e("#maxui-activities").on("click",".maxui-action.maxui-favorites",function(i){i.preventDefault();var n=e(this),a=e(this).closest(".maxui-activity").attr("id");n.hasClass("maxui-favorited")?t.maxClient.unfavoriteActivity(a,function(e){n.toggleClass("maxui-favorited",!1)}):t.maxClient.favoriteActivity(a,function(e){n.toggleClass("maxui-favorited",!0)})}),e("#maxui-activities").on("click",".maxui-action.maxui-likes",function(i){i.preventDefault();var n=e(this),a=e(this).closest(".maxui-activity").attr("id");n.hasClass("maxui-liked")?t.maxClient.unlikeActivity(a,function(e){n.toggleClass("maxui-liked",!1)}):t.maxClient.likeActivity(a,function(e){n.toggleClass("maxui-liked",!0)})}),e("#maxui-activities").on("click",".maxui-action.maxui-flag",function(i){i.preventDefault();var n=e(this),a=e(this).closest(".maxui-activity"),s=a.attr("id");n.hasClass("maxui-flagged")?t.maxClient.unflagActivity(s,function(e){n.toggleClass("maxui-flagged",!1),a.toggleClass("maxui-flagged",!1),t.printActivities({})}):t.maxClient.flagActivity(s,function(e){n.toggleClass("maxui-flagged",!0),a.toggleClass("maxui-flagged",!1),t.printActivities({})})}),e("#maxui-activities").on("click",".maxui-action.maxui-delete",function(t){t.preventDefault();var i=e(this).closest(".maxui-activity").find(".maxui-actions > .maxui-popover");i.is(":visible")?(i.animate({opacity:0},300),e(".maxui-popover").css({opacity:0}).hide()):(e(".maxui-popover").css({opacity:0}).hide(),i.show(),i.animate({opacity:1},300))}),e("#maxui-activities").on("click",".maxui-actions .maxui-button-cancel",function(t){t.preventDefault(),e(".maxui-popover:visible").css({opacity:0}).hide()}),e("#maxui-activities").on("click",".maxui-actions .maxui-button-delete",function(i){i.preventDefault();var n=e(this).closest(".maxui-activity"),a=n.attr("id");t.maxClient.removeActivity(a,function(t){var i=e(".maxui-popover:visible").animate({opacity:0},300);n.css({height:n.height(),"min-height":"auto"}),n.animate({height:0,opacity:0},100,function(e){n.remove(),i.hide()})})}),e("#maxui-activities").on("click",".maxui-delete-comment",function(t){t.preventDefault();var i=e(this).closest(".maxui-comment").find(".maxui-popover");i.is(":visible")?(i.animate({opacity:0},300),e(".maxui-popover").css({opacity:0}).hide()):(e(".maxui-popover").css({opacity:0}).hide(),i.show(),i.animate({opacity:1},300))}),e("#maxui-activities").on("click",".maxui-comment .maxui-button-cancel",function(t){t.preventDefault(),e(".maxui-popover").css({opacity:0}).hide()}),e("#maxui-activities").on("click",".maxui-comment .maxui-button-delete",function(i){i.preventDefault();var n=e(this).closest(".maxui-comment"),a=n.closest(".maxui-activity"),s=a.attr("id"),r=n.attr("id");t.maxClient.removeActivityComment(s,r,function(){var t=e(".maxui-popover").animate({opacity:0},300);n.css({height:a.height(),"min-height":"auto"}),n.animate({height:0,opacity:0},100,function(e){n.remove(),t.hide()})})}),e("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-recent",function(i){i.preventDefault();var n=e(this);n.hasClass("active")||(e("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),t.printActivities({}))}),e("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-valued",function(i){i.preventDefault();var n=e(this);n.hasClass("active")||(e("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),t.printActivities({sortBy:"likes"}))}),e("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-flagged",function(i){i.preventDefault();var n=e(this);n.hasClass("active")||(e("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),t.printActivities({sortBy:"flagged"}))});var i=".maxui-text-input";e("#maxui-add-people-box").on("focusin",i,function(i){i.preventDefault();var n=e(this).val(),a=e(this).attr("data-literal");t.utils.normalizeWhiteSpace(n,!1)===a&&e(this).val("")}).on("keydown",i,function(i){e("#maxui-conversation-predictive:visible").length>0&&(40===i.which||38===i.which||13===i.which||9===i.which)&&t.utils.freezeEvent(i)}).on("keyup",i,function(i){i.preventDefault(),i.stopPropagation();var n=e(this).val();""===t.utils.normalizeWhiteSpace(n,!1)?(e(this).attr("class","maxui-empty maxui-text-input"),e(this).removeAttr("title")):t.settings.canwrite&&e(this).attr("class","maxui-text-input");var a=i.which,s=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*"),r=n.match(s),o=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*$"),u=n.match(o),c=e("#maxui-conversation-predictive .maxui-prediction.selected"),l=e(this),d=e("#maxui-conversation-predictive"),p=d.find(".maxui-prediction").length,m=e("#maxui-conversation-predictive:visible").length>0;if(40===a&&m&&p>1){var f=c.next();c.removeClass("selected"),f.length>0?f.addClass("selected"):c.siblings(":first").addClass("selected")}else if(38===a&&m&&p>1){var v=c.prev();c.removeClass("selected"),v.length>0?v.addClass("selected"):c.siblings(":last").addClass("selected")}else if(27===a)d.hide();else if(13!==a&&9!==a||!m)"conversations"===t.settings.conversationsSection&&(r?(l.attr("class","maxui-text-input"),u&&(d.show(),d.html("<ul></ul>"),t.printPredictions(r[1],"#maxui-conversation-predictive"))):(d.hide(),l.attr("class","maxui-empty maxui-text-input"),n.match(new RegExp("^\\s*@"))||(l.attr("class","maxui-text-input error"),l.attr("title",t.settings.literals.post_permission_not_here))));else{var h=c.attr("data-username"),g=c.attr("data-displayname");t.addPerson({username:h,displayName:g}),d.hide(),l.val("").focus()}}).on("focusout",i,function(i){i.preventDefault();var n=e(this).val(),a=e(this).attr("data-literal");""===t.utils.normalizeWhiteSpace(n,!1)&&e(this).val(a)}),t.bindActionBehaviour("#maxui-newactivity","#maxui-newactivity-box",{},function(i){if("timeline"===t.settings.UISection)t.sendActivity(i),e("#maxui-search").toggleClass("folded",!0);else if("conversations"===t.settings.UISection)if("conversations"===t.settings.conversationsSection){for(var n=e("#maxui-new-participants")[0],a=[],s=0;s<n.people.length;s++)a.push(n.people[s].username);var r={participants:a,message:e("#maxui-newactivity textarea").val()};if(a.length>1){var o=e("#maxui-add-people-box #maxui-new-displayName input").val();r.displayName=o}t.conversations.create(r)}else t.conversations.send(i)},function(i,n,a,s){var r=s.which,o=new RegExp("^\\s*@([\\w\\.]+)\\s*"),u=i.match(o),c=new RegExp("^\\s*@([\\w\\.]+)\\s*$"),l=i.match(c),d=e("#maxui-newactivity .maxui-prediction.selected"),p=e(n),m=e("#maxui-newactivity #maxui-predictive"),f=m.find(".maxui-prediction").length,v=e("#maxui-newactivity #maxui-predictive:visible").length>0;if(40===r&&v&&f>1){var h=d.next();d.removeClass("selected"),h.length>0?h.addClass("selected"):d.siblings(":first").addClass("selected")}else if(38===r&&v&&f>1){var g=d.prev();d.removeClass("selected"),g.length>0?g.addClass("selected"):d.siblings(":last").addClass("selected")}else if(27===r)m.hide();else if(13!==r&&9!==r||!v)""===i?"timeline"===t.settings.UISection&&e(a).val(t.settings.literals.new_activity_post):"timeline"===t.settings.UISection?u?(e(a).val(t.settings.literals.new_message_post),l&&(m.show(),m.html("<ul></ul>"),t.printPredictions(u[1],"#maxui-newactivity #maxui-predictive")),e(a).removeAttr("disabled"),e(a).attr("class","maxui-button"),p.attr("class","maxui-text-input")):(e(a).val(t.settings.literals.new_activity_post),m.hide(),i.match(new RegExp("^\\s*@"))||t.settings.canwrite||(p.attr("class","maxui-text-input error"),p.attr("title",t.settings.literals.post_permission_unauthorized))):"conversations"===t.settings.UISection&&("conversations"===t.settings.conversationsSection?t.reloadPersons():"messages"===t.settings.conversationsSection&&(m.hide(),e(a).removeAttr("disabled"),e(a).attr("class","maxui-button"),p.attr("class","maxui-text-input")));else{var x=new RegExp("^\\s*@([\\w\\.]+)"),y=i.replace(x,"@"+d.text()+" ");m.hide(),p.val(y).focus()}}),t.bindActionBehaviour("#maxui-activities",".maxui-newcommentbox",{},function(i){var n=e(this).closest(".maxui-activity").attr("id");t.maxClient.addComment(i,n,function(){e("#activityContainer textarea").val("");var i=this.object.inReplyTo[0].id;t.printCommentsForActivity(i),e("#"+i+" .maxui-newcommentbox textarea").val(""),e("#"+i+" .maxui-newcommentbox .maxui-button").attr("disabled","disabled")})}),t.bindActionBehaviour("#maxui-search","#maxui-search-box",{},function(i){t.textSearch(i),e("#maxui-search").toggleClass("folded",!1),e("#maxui-search-text").val("")})},e.fn.bindActionBehaviour=function(t,i,n,a){var s=this,r=i+" .maxui-text-input",o=null;arguments.length>4&&(o=arguments[4]),e(t).on("focusin",r,function(t){t.preventDefault();var i=e(this).val(),n=e(this).attr("data-literal");s.utils.normalizeWhiteSpace(i,!1)===n&&e(this).val("")}).on("keydown",r,function(i){if(e(t+" #maxui-predictive:visible").length>0&&(40===i.which||38===i.which||13===i.which||9===i.which))s.utils.freezeEvent(i);else if(13===i.which&&!1===i.shiftKey&&!n.ignore_button){i.preventDefault();var r=e(this).parent().find(".maxui-text-input"),o=r.attr("data-literal"),u=r.val(),c=s.utils.normalizeWhiteSpace(u,!1);c!==o&""!==c&&a.apply(this,[u])}}).on("keyup",r,function(t){t.preventDefault(),t.stopPropagation();var i=e(this).val(),a=e(this).parent().parent().find(".maxui-button");""!==s.utils.normalizeWhiteSpace(i,!1)||n.ignore_button?s.settings.canwrite&&!n.ignore_button&&(e(a).removeAttr("disabled"),e(a).attr("class","maxui-button"),e(this).attr("class","maxui-text-input")):(e(a).attr("disabled","disabled"),e(a).attr("class","maxui-button maxui-disabled"),e(this).attr("class","maxui-empty maxui-text-input"),e(this).removeAttr("title"),e(".maxui-error-box").width(e(this).width()-4),e(".maxui-error-box").animate({bottom:0},200)),null!==o&&o(i,this,a,t)}).on("paste",r,function(t){var i=e(this).parent().parent().find(".maxui-button");s.settings.canwrite&&!n.ignore_button&&(e(i).removeAttr("disabled"),e(i).attr("class","maxui-button"),e(this).attr("class","maxui-text-input"));var a=e(this).val();null!==o&&o(a,this,i,t)}).on("focusout",r,function(t){t.preventDefault();var i=e(this).val(),n=e(this).attr("data-literal");""===s.utils.normalizeWhiteSpace(i,!1)&&e(this).val(n)}).on("click",i+" .maxui-button",function(t){t.preventDefault();var i=e(this).parent().find(".maxui-text-input"),r=i.attr("data-literal"),o=i.val(),u=s.utils.normalizeWhiteSpace(o,!1);(u!==r&""!==u||n.empty_click)&&a.apply(this,[o])})},e.fn.textSearch=function(e){for(var t=this.utils.normalizeWhiteSpace(e).split(" "),i=0;i<t.length;i++){var n="keyword",a=t[i];switch(a[0]){case"#":n="hashtag",a=a.substr(1);break;case"@":n="actor",a=a.substr(1);break;default:n="keyword"}a.length>=3&&this.addFilter({type:n,value:a},!1)}this.reloadFilters()},e.fn.getFilters=function(){var e={filters:this.filters};void 0===e.filters&&(e.filters=[]);for(var t={},i=!1,n=0;n<e.filters.length;n++){var a=e.filters[n];a.visible&&(i=!0),t[a.type]||(t[a.type]=[]),t[a.type].push(a.value)}return arguments.length>0&&(t.before=arguments[0]),{filters:t,visible:i}},e.fn.reloadFilters=function(){var t,i=this,n={filters:i.filters},a=i.templates.filters.render(n);e("#maxui-search-filters").html(a),t=arguments.length>0?i.getFilters(arguments[0]):i.getFilters(),i.printActivities({}),e("#maxui-search").toggleClass("folded",!t.visible)},e.fn.delFilter=function(e){for(var t=this,i=!1,n=0;n<t.filters.length;n++)t.filters[n].value===e.value&t.filters[n].type===e.type&&(i=!0,t.filters.splice(n,1));i&&this.reloadFilters()},e.fn.addFilter=function(e){var t=this,i=!0;switch(arguments.length>1&&(i=arguments[1]),t.filters||(t.filters=[]),e.hasOwnProperty("visible")||(e.visible=!0),e.type){case"hashtag":e.prepend="#";break;case"actor":e.prepend="@";break;default:e.prepend=""}for(var n=!1,a=0;a<t.filters.length;a++)t.filters[a].value===e.value&t.filters[a].type===e.type&&(n=!0);n||(t.filters.push(e),!0===i&&this.reloadFilters())},e.fn.reloadPersons=function(){var t=this,i=e("#maxui-new-participants"),n=i[0];n.people||(n.people=[]);var a=e("#maxui-newactivity input.maxui-button"),s=e("#maxui-newactivity"),r=s.find("textarea").val(),o=s.find("textarea").attr("data-literal");r=t.utils.normalizeWhiteSpace(r);var u=e("#maxui-add-people-box #maxui-new-displayName"),c=u.find("input").val();c=t.utils.normalizeWhiteSpace(c);var l={persons:n.people},d=t.templates.participants.render(l);if(e("#maxui-new-participants").html(d),e("#maxui-add-people-box .maxui-label .maxui-count").text("({0}/{1})".format(n.people.length+1,t.settings.maximumConversations)),n.people.length>0){var p=""!==c;n.people.length>1&&!p?(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),""===c&&(s.find("textarea").attr("class","maxui-text-input error"),s.find(".maxui-error-box").text(t.settings.literals.post_permission_missing_displayName),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:-25},200))):(a.removeAttr("disabled"),a.attr("class","maxui-button"),s.find("textarea").attr("class","maxui-text-input"),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:0},200)),i.show(),s.show(),n.people.length>1?u.show():(u.hide(),u.find(".maxui-text-input").val(""))}else""!==r&&r!==o&&(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),i.hide(),s.find("textarea").attr("class","maxui-text-input error"),s.find(".maxui-error-box").text(t.settings.literals.post_permission_not_enough_participants),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:-25},200),u.hide(),u.find(".maxui-text-input").val(""))},e.fn.delPerson=function(t){for(var i=!1,n=e("#maxui-new-participants")[0],a=0;a<n.people.length;a++)n.people[a].username===t.username&&(i=!0,n.people.splice(a,1));i&&this.reloadPersons()},e.fn.addPerson=function(t){var i=this,n=e("#maxui-new-participants")[0],a=!0;arguments.length>1&&(a=arguments[1]);var s=!1;if(n.people||(n.people=[]),t.username!==i.settings.username&&n.people.length<i.settings.maximumConversations-1){for(var r=0;r<n.people.length;r++)n.people[r].username===t.username&&(s=!0);s||(n.people.push(t),!0===a&&this.reloadPersons())}},e.fn.toggleSection=function(t){var i,n=this,a=e("#maxui-search"),s=e("#maxui-activity-sort"),r=e("#maxui-timeline"),o=e("#maxui-timeline .maxui-wrapper"),u=e("#maxui-conversations"),c=e("#maxui-common-header"),l=u.find("input#add-user-input"),d=e("#maxui-conversations #maxui-conversations-list"),p=e("#maxui-conversations .maxui-wrapper"),m=e("#maxui-newactivity-box .maxui-button"),f=e("#maxui-newactivity-box #maxui-subscriptions"),v=e("#maxui-newactivity"),h=e("#maxui-newactivity-box textarea"),g=e("#maxui-show-conversations"),x=e("#maxui-show-timeline"),y=e("#maxui-add-people-box"),w=n.width()-n.conversations.scrollbar.width-20-2;if("conversations"===t&&"conversations"===n.settings.currentConversationSection&&(f.attr("style","display:none;"),u.show(),c.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),y.show(),l.focus(),u.animate({height:320},400,function(e){p.height(320)}),d.width(w),r.animate({height:0},400),a.hide(400),s.hide(400),n.settings.UISection="conversations",m.val(n.settings.literals.new_message_post),i=n.settings.literals.new_conversation_text,h.val(i).attr("data-literal",i),g.hide(),n.settings.disableTimeline||x.show(),n.conversations.scrollbar.setHeight(275),n.conversations.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),v.show()),"timeline"===t){!0===n.settings.showSubscriptionList&&f.attr("style","display:inline;"),n.conversations.listview.toggle(),r.show();var b=o.height();r.animate({height:b},400,function(e){r.css("height","")}),u.animate({height:0},400,function(e){u.hide(),y.hide()}),a.show(400),s.show(400),n.settings.UISection="timeline",m.val(n.settings.literals.new_activity_post),i=n.settings.literals.new_activity_text,h.val(i).attr("data-literal",i),n.settings.disableConversations||g.show(),x.hide(),n.settings.hidePostboxOnTimeline&&v.hide()}},e.fn.Settings=function(){return this.settings},e.fn.sendActivity=function(){var t=this,i=e("#maxui-newactivity textarea").val(),n=[];e("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),e("#maxui-activity-sort .maxui-sort-action.maxui-most-recent").toggleClass("active",!0),n.push(i),n.push(t.settings.writeContexts),n.push(function(){e("#maxui-newactivity textarea").val(""),e("#maxui-newactivity .maxui-button").attr("disabled","disabled");var i=e(".maxui-activity:first");if(i.length>0){var n={after:i.attr("id")};t.printActivities(n)}else t.printActivities({})}),t.settings.generatorName&&n.push(t.settings.generatorName),t.maxClient.addActivity.apply(t.maxClient,n)},e.fn.loadMoreActivities=function(){var t=this,i={before:e(".maxui-activity:last").attr("id")};t.printActivities(i)},e.fn.loadNewsActivities=function(){this.printActivities()},e.fn.printPredictions=function(e,t){var i=this,n=[];n.push(e),n.push(function(e){i.formatPredictions(e,t)}),this.maxClient.getUsersList.apply(this.maxClient,n)},e.fn.formatPredictions=function(t,i){for(var n=this,a="",s=0;s<t.length;s++){var r=t[s];if(r.username!==n.username){var o=n.settings.avatarURLpattern.format(r.username),u={username:r.username,displayName:r.displayName,avatarURL:o,cssclass:"maxui-prediction"+(0===s&&" selected"||"")};a+=n.templates.predictive.render(u)}}""===a&&(a="<li>"+n.settings.literals.no_match_found+"</li>"),e(i+" ul").html(a),arguments.length>2&&(0,arguments[2])()},e.fn.formatActivities=function(t,i){for(var n=this,a="",s=[],r=0;r<t.length;r++){var o=t[r],u=null;o.hasOwnProperty("contexts")&&o.contexts.length>0&&(u=o.contexts[0]);var c=null;o.hasOwnProperty("generator")&&o.generator!==n.settings.generatorName&&(c=o.generator);var l="";"person"===o.actor.objectType?l=n.settings.avatarURLpattern.format(o.actor.username):"context"===o.actor.objectType&&(l=n.settings.contextAvatarURLpattern.format(o.actor.hash));var d=[],p="";if(o.replies&&o.replies.length>0){for(var m=0;m<o.replies.length;m++){var f=o.replies[m],v={id:f.id,actor:f.actor,date:n.utils.formatDate(f.published,n.language),text:n.utils.formatText(f.content),avatarURL:n.settings.avatarURLpattern.format(f.actor.username),canDeleteComment:f.deletable,literals:n.settings.literals};d.push(v)}p="Comentat "+d[d.length-1].date}_.defaults(o.object,{filename:o.id});var h={id:o.id,actor:o.actor,auth:{token:n.settings.oAuthToken,username:n.settings.username},literals:n.settings.literals,date:n.utils.formatDate(o.published,n.language),dateLastComment:p,text:n.utils.formatText(o.object.content),replies:d,favorited:o.favorited,likes:o.likesCount?o.likesCount:0,showLikesCount:"likes"===n.currentSortOrder,liked:o.liked,flagged:o.flagged,avatarURL:l,publishedIn:u,canDeleteActivity:o.deletable,canFlagActivity:n.settings.canflag,via:c,fileDownload:"file"===o.object.objectType,filename:o.object.filename},g={comment:n.templates.comment};a+=n.templates.activity.render(h,g),"image"===o.object.objectType&&s.push(o)}if("beggining"===i){e("#maxui-preload .maxui-wrapper").prepend(a);var x=e("#maxui-preload .maxui-wrapper .maxui-activity"),y=0;for(r=0;r<x.length;r++)y+=e(x[r]).height()+18;var w=e("#maxui-preload").height();e("#maxui-preload").height(y-w),e("#maxui-preload").css({"margin-top":-1*(y-w)}),e("#maxui-preload").animate({"margin-top":0},200,function(){e("#maxui-preload .maxui-wrapper").html(""),e("#maxui-activities").prepend(a),e("#maxui-preload").height(0)})}else"end"===i?e("#maxui-activities").append(a):e("#maxui-activities").html(a);arguments.length>2&&arguments[2].call(),_.each(s,function(t,i,a){n.maxClient.getMessageImage("/activities/{0}/image/thumb".format(t.id),function(i){var n='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(i);e(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(t.id)).after(n)})})},e.fn.formatComment=function(t,i){for(var n=this,a="",s=0;s<t.length;s++){var r=t[s],o={literals:n.settings.literals,id:r.id,actor:r.actor,date:n.utils.formatDate(r.published,n.language),text:n.utils.formatText(r.content),avatarURL:n.settings.avatarURLpattern.format(r.actor.username),canDeleteComment:r.deletable};a+=n.templates.comment.render(o)}e(".maxui-activity#"+i+" .maxui-commentsbox").html(a);var u=e(".maxui-activity#"+i+" .maxui-commentaction strong");e(u).text(parseInt(e(u).text(),10)+1)},e.fn.renderPostbox=function(){var t=this,i="conversations"===t.settings.UISection,n=!1===t.settings.disableConversations&&!i,a={avatar:t.settings.avatarURLpattern.format(t.settings.username),allowPosting:t.settings.canwrite,buttonLiteral:t.settings.literals.new_activity_post,textLiteral:t.settings.literals.new_activity_text,literals:t.settings.literals,showConversationsToggle:n?"display:block;":"display:none;",showSubscriptionList:t.settings.showSubscriptionList&&t.settings.subscriptionsWrite.length>0,subscriptionList:t.settings.subscriptionsWrite},s=t.templates.postBox.render(a);e("#maxui-newactivity").html(s)},e.fn.printActivities=function(t){var i=this,n=[],a="replace",s=i.getFilters().filters;e.extend(s,t),s.before&&(a="end"),s.after&&(a="beggining"),s.sortBy||(e("#maxui-activity-sort .maxui-sort-action.maxui-most-valued").hasClass("active")?s.sortBy="likes":e("#maxui-activity-sort .maxui-sort-action.maxui-flagged").hasClass("active")?s.sortBy="flagged":s.sortBy=i.settings.activitySortOrder),i.currentSortOrder=s.sortBy;var r=null;if("timeline"===i.settings.activitySource)r=this.maxClient.getUserTimeline,n.push(i.settings.username);else if("activities"===i.settings.activitySource){r=this.maxClient.getActivities;var o={context:i.settings.readContextHash,tags:i.settings.contextTagsFilter};n.push(o)}if(arguments.length>1){var u=arguments[1];n.push(function(e){i.settings.canwrite=!0,"activities"===i.settings.activitySource?i.maxClient.getContext(i.settings.readContextHash,function(t){var n=i.settings.subscriptions;n[t.hash]||(n[t.hash]={},n[t.hash].permissions={},n[t.hash].permissions.read="public"===t.permissions.read,n[t.hash].permissions.write="public"===t.permissions.write);for(var s=0;s<i.settings.writeContexts.length;s++){var r=i.settings.writeContextsHashes[s];n[r].permissions?(!0!==n[r].permissions.write&&(i.settings.canwrite=!1),!0===n[r].permissions.flag?i.settings.canflag=!0:i.settings.canflag=!1):(i.settings.canwrite=!1,i.settings.canflag=!1)}i.renderPostbox(),i.formatActivities(e,a,u)}):(i.renderPostbox(e,a,u),i.formatActivities(e,a,u))})}else n.push(function(e){i.formatActivities(e,a)});n.push(s),r.apply(this.maxClient,n)},e.fn.printCommentsForActivity=function(e){var t=this,i=[];i.push(e),i.push(function(i){t.formatComment(i,e)}),this.maxClient.getCommentsForActivity.apply(this.maxClient,i)},e.maxui=function(){},e.maxui.settings=function(){return this.settings}}(jQuery),window.setTimeout(function(){window._MAXUI&&window._MAXUI.onReady&&!window._MAXUI.hasRun&&(window._MAXUI.hasRun=!0,_MAXUI.onReady())},0);
//# sourceMappingURL=maxui.min.js.map