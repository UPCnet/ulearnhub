/*! max.ui5.js - v5.1.6 - 2022-09-27 */
var Hogan={},uuid,max=(!function(e){e.Template=function(e,t,i,a){this.r=e||this.r,this.c=i,this.options=a,this.text=t||"",this.buf=""},e.Template.prototype={r:function(e,t,i){return""},v:function(e){return e=r(e),o.test(e)?e.replace(t,"&amp;").replace(i,"&lt;").replace(a,"&gt;").replace(n,"&#39;").replace(s,"&quot;"):e},t:r,render:function(e,t,i){return this.ri([e],t||{},i)},ri:function(e,t,i){return this.r(e,t,i)},rp:function(e,t,i,a){e=i[e];return e?(e=this.c&&"string"==typeof e?this.c.compile(e,this.options):e).ri(t,i,a):""},rs:function(e,t,i){var a=e[e.length-1];if(c(a))for(var n=0;n<a.length;n++)e.push(a[n]),i(e,t,this),e.pop();else i(e,t,this)},s:function(e,t,i,a,n,s,o){return(!c(e)||0!==e.length)&&(i=""===(e="function"==typeof e?this.ls(e,t,i,a,n,s,o):e)||!!e,!a&&i&&t&&t.push("object"==typeof e?e:t[t.length-1]),i)},d:function(e,t,i,a){var n=e.split("."),s=this.f(n[0],t,i,a),o=null;if("."===e&&c(t[t.length-2]))return t[t.length-1];for(var r=1;r<n.length;r++)s=s&&"object"==typeof s&&n[r]in s?(o=s)[n[r]]:"";return!(a&&!s)&&(a||"function"!=typeof s||(t.push(o),s=this.lv(s,t,i),t.pop()),s)},f:function(e,t,i,a){for(var n,s=!1,o=!1,r=t.length-1;0<=r;r--)if((n=t[r])&&"object"==typeof n&&e in n){s=n[e],o=!0;break}return o?a||"function"!=typeof s?s:this.lv(s,t,i):!a&&""},ho:function(e,t,i,a,n){var s=this.c,o=this.options;return o.delimiters=n,a=null==(a=e.call(t,a))?String(a):a.toString(),this.b(s.compile(a,o).render(t,i)),!1},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ls:function(e,t,i,a,n,s,o){t=t[t.length-1];if(!a&&this.c&&0<e.length)return this.ho(e,t,i,this.text.substring(n,s),o);if("function"==typeof(e=e.call(t))){if(a)return!0;if(this.c)return this.ho(e,t,i,this.text.substring(n,s),o)}return e},lv:function(e,t,i){t=t[t.length-1],e=e.call(t);return"function"==typeof e&&(e=r(e.call(t)),this.c&&~e.indexOf("{{"))?this.c.compile(e,this.options).render(t,i):r(e)}};var t=/&/g,i=/</g,a=/>/g,n=/\'/g,s=/\"/g,o=/[&<>\"\']/;function r(e){return String(null==e?"":e)}var c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}("undefined"!=typeof exports?exports:Hogan),!function(a){var y=/\S/,t=/\"/g,i=/\n/g,n=/\r/g,s=/\\/g,w={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};function b(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function _(e,t,i){if(t.charAt(i)==e.charAt(0)){for(var a=1,n=e.length;a<n;a++)if(t.charAt(i+a)!=e.charAt(a))return;return 1}}function r(e,t,i,a){for(var n=[],s=null,o=null;0<e.length;)if("#"==(o=e.shift()).tag||"^"==o.tag||function(e,t){for(var i=0,a=t.length;i<a;i++)if(t[i].o==e.n)return e.tag="#"}(o,a))i.push(o),o.nodes=r(e,o.tag,i,a),n.push(o);else{if("/"==o.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+o.n);if(s=i.pop(),o.n==s.n||function(e,t,i){for(var a=0,n=i.length;a<n;a++)if(i[a].c==e&&i[a].o==t)return 1}(o.n,s.n,a))return s.end=o.i,n;throw new Error("Nesting error: "+s.n+" vs. "+o.n)}n.push(o)}if(0<i.length)throw new Error("missing closing tag: "+i.pop().n);return n}function m(e){return e.replace(s,"\\\\").replace(t,'\\"').replace(i,"\\n").replace(n,"\\r")}function d(e){return~e.indexOf(".")?"d":"f"}function p(e){for(var t,i,a,n,s,o,r="",c=0,l=e.length;c<l;c++){var u=e[c].tag;"#"==u?r+=(t=e[c].nodes,i=e[c].n,a=d(e[c].n),n=e[c].i,s=e[c].end,o=e[c].otag+" "+e[c].ctag,"if(_.s(_."+a+'("'+m(i)+'",c,p,1),c,p,0,'+n+","+s+',"'+o+'")){_.rs(c,p,function(c,p,_){'+p(t)+"});c.pop();}"):"^"==u?r+=(a=e[c].nodes,i=e[c].n,"if(!_.s(_."+d(e[c].n)+'("'+m(i)+'",c,p,1),c,p,1,0,0,"")){'+p(a)+"};"):"<"==u||">"==u?r+='_.b(_.rp("'+m((n=e[c]).n)+'",c,p,"'+(n.indent||"")+'"));':"{"==u||"&"==u?r+=(s=e[c].n,"_.b(_.t(_."+d(e[c].n)+'("'+m(s)+'",c,p,0)));'):"\n"==u?r+=v('"\\n"'+(e.length-1==c?"":" + i")):"_v"==u?r+=(o=e[c].n,"_.b(_.v(_."+d(e[c].n)+'("'+m(o)+'",c,p,0)));'):void 0===u&&(r+=v('"'+m(e[c])+'"'))}return r}function v(e){return"_.b("+e+");"}a.scan=function(e,t){var i,a,n,s,o,r=e.length,c=0,l=null,u="",m=[],d=!1,p=0,v=0,f="{{",h="}}";function g(){0<u.length&&(m.push(new String(u)),u="")}function x(e,t){if(g(),e&&function(){for(var e=!0,t=v;t<m.length;t++)if(!(e=m[t].tag&&w[m[t].tag]<w._v||!m[t].tag&&null===m[t].match(y)))return;return e}())for(var i,a=v;a<m.length;a++)m[a].tag||((i=m[a+1])&&">"==i.tag&&(i.indent=m[a].toString()),m.splice(a,1));else t||m.push({tag:"\n"});d=!1,v=m.length}for(t&&(t=t.split(" "),f=t[0],h=t[1]),p=0;p<r;p++)0==c?_(f,e,p)?(--p,g(),c=1):"\n"==e.charAt(p)?x(d):u+=e.charAt(p):1==c?(p+=f.length-1,c="="==(l=(i=w[e.charAt(p+1)])?e.charAt(p+1):"_v")?(n=p,o=s=void 0,s="="+h,o=(a=e).indexOf(s,n),a=b(a.substring(a.indexOf("=",n)+1,o)).split(" "),f=a[0],h=a[1],p=o+s.length-1,0):(i&&p++,2),d=p):_(h,e,p)?(m.push({tag:l,n:b(u),otag:f,ctag:h,i:"/"==l?d-h.length:p+f.length}),u="",p+=h.length-1,c=0,"{"==l&&("}}"==h?p++:"}"===(n=m[m.length-1]).n.substr(n.n.length-1)&&(n.n=n.n.substring(0,n.n.length-1)))):u+=e.charAt(p);return x(d,!0),m},a.generate=function(e,t,i){e='var _=this;_.b(i=i||"");'+p(e)+"return _.fl();";return i.asString?"function(c,p,i){"+e+";}":new a.Template(new Function("c","p","i",e),t,a,i)},a.parse=function(e,t,i){return r(e,0,[],(i=i||{}).sectionTags||[])},a.cache={},a.compile=function(e,t){var i=e+"||"+!!(t=t||{}).asString,a=this.cache[i];return a||(a=this.generate(this.parse(this.scan(e,t.delimiters),e,t),e,t),this.cache[i]=a)}}("undefined"!=typeof exports?exports:Hogan),!function(c){c.easydate={},c.easydate.locales={},c.easydate.locales.en={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago",in:"in"},c.easydate.locales.ca={future_format:"%s %t",past_format:"%s %t",second:"segon",seconds:"segons",minute:"minut",minutes:"minuts",hour:"hora",hours:"hores",day:"dia",days:"dies",week:"setmana",weeks:"setmanes",month:"mes",months:"mesos",year:"any",years:"anys",yesterday:"ahir",tomorrow:"demà",now:"fa un moment",ago:"fa",in:"en"},c.easydate.locales.es={future_format:"%s %t",past_format:"%s %t",second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"dia",days:"dias",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años",yesterday:"ayer",tomorrow:"mañana",now:"hace un instante",ago:"hace",in:"en"};var l={live:!0,set_title:!0,format_future:!0,format_past:!0,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:!0},{name:"tomorrow",limit:172800,future_only:!0},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:1/0,in_seconds:31556926}],uneasy_format:function(e){return e.toLocaleDateString()},locale:c.easydate.locales.en};function u(e,t,i){return isNaN(t)||1==t||(e+="s"),i.locale[e]||e}c.easydate.format_date=function(e,t){var i=c.extend({},l);i.locale=c.easydate.locales[t];var a=((new Date).getTime()-e.getTime())/1e3,n=Math.abs(a);if(!isNaN(a)&&!(!i.format_future&&a<0||!i.format_past&&0<a)){for(var s in i.units){s=i.units[s];if(!(s.past_only&&a<0||s.future_only&&0<a)&&n<s.limit){if(isNaN(s.in_seconds))return u(s.name,NaN,i);var o=n/s.in_seconds,o=Math.round(o),r=a<0?u("future_format",NaN,i).replace("%s",u("in",NaN,i)):u("past_format",NaN,i).replace("%s",u("ago",NaN,i));return r.replace("%t",o+" "+u(s.name,o,i))}}return i.uneasy_format(e)}}}(jQuery),!function(e){var t;e.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},t=e.ajaxSettings.xdr(),e.extend(e.support,{iecors:!!t}),e.support.iecors&&e.ajaxTransport(function(i){var a=i.xdr();return{send:function(e,t){a.onload=function(){var e={"Content-Type":a.contentType};t(200,"OK",{text:a.responseText},e)},i.xhrFields&&(xhr.onerror=i.xhrFields.error,xhr.ontimeout=i.xhrFields.timeout),a.open(i.type,i.url),a.send(i.hasContent&&i.data||null)},abort:function(){a.abort()}}})}(jQuery),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(r){var c,l,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],u=Array.prototype.slice;if(r.event.fixHooks)for(var i=e.length;i;)r.event.fixHooks[e[--i]]=r.event.mouseHooks;var a=r.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],n,!1);else this.onmousewheel=n;r.data(this,"mousewheel-line-height",a.getLineHeight(this)),r.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],n,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(r(e)["offsetParent"in r.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return r(e).height()},settings:{adjustOldDeltas:!0}};function n(e){var t,i=e||window.event,a=u.call(arguments,1),n=0,s=0,o=0;if((e=r.event.fix(i)).type="mousewheel","detail"in i&&(o=-1*i.detail),"wheelDelta"in i&&(o=i.wheelDelta),"wheelDeltaY"in i&&(o=i.wheelDeltaY),"wheelDeltaX"in i&&(s=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(s=-1*o,o=0),n=0===o?s:o,"deltaY"in i&&(n=o=-1*i.deltaY),"deltaX"in i&&(s=i.deltaX,0===o&&(n=-1*s)),0!==o||0!==s)return 1===i.deltaMode?(n*=t=r.data(this,"mousewheel-line-height"),o*=t,s*=t):2===i.deltaMode&&(n*=t=r.data(this,"mousewheel-page-height"),o*=t,s*=t),t=Math.max(Math.abs(o),Math.abs(s)),(!l||t<l)&&d(i,l=t)&&(l/=40),d(i,t)&&(n/=40,s/=40,o/=40),n=Math[1<=n?"floor":"ceil"](n/l),s=Math[1<=s?"floor":"ceil"](s/l),o=Math[1<=o?"floor":"ceil"](o/l),e.deltaX=s,e.deltaY=o,e.deltaFactor=l,e.deltaMode=0,a.unshift(e,n,s,o),c&&clearTimeout(c),c=setTimeout(m,200),(r.event.dispatch||r.event.handle).apply(this,a)}function m(){l=null}function d(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}r.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),"object"!=typeof JSON&&(JSON={}),!function(){"use strict";function f(e){return e<10?"0"+e:e}var cx,escapable,gap,indent,meta,rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,a,n,s,o,r=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),typeof(c="function"==typeof rep?rep.call(t,e,c):c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;i<s;i+=1)o[i]=str(i,c)||"null";n=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+r+"]":"["+o.join(",")+"]",gap=r}else{if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(n=str(a=rep[i],c))&&o.push(quote(a)+(gap?": ":":")+n);else for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(n=str(a,c))&&o.push(quote(a)+(gap?": ":":")+n);n=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+r+"}":"{"+o.join(",")+"}",gap=r}return n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,i){var a;if(indent=gap="","number"==typeof i)for(a=0;a<i;a+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(!(rep=t)||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(e,t){var i,a,n=e[t];if(n&&"object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(void 0!==(a=walk(n,i))?n[i]=a:delete n[i]);return reviver.call(e,t,n)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),!function(){var x,i,p,v,r,f,s={}.hasOwnProperty,o=[].slice;function y(e,t,i,a){this.command=e,this.headers=null!=t?t:{},this.body=null!=i?i:"",this.escapeHeaderValues=null!=a&&a}function e(t){this.ws_fn=function(){var e=t();return e.binaryType="arraybuffer",e},this.reconnect_delay=0,this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}x={LF:"\n",NULL:"\0"},y.prototype.toString=function(){var e,t,i,a=[this.command],n=!1===this.headers["content-length"];for(e in n&&delete this.headers["content-length"],t=this.headers)s.call(t,e)&&(i=t[e],this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?a.push(e+":"+y.frEscape(i)):a.push(e+":"+i));return this.body&&!n&&a.push("content-length:"+y.sizeOfUTF8(this.body)),a.push(x.LF+this.body),a.join(x.LF)},y.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},r=function(e,t){var i,a,n,s,o,r,c,l,u,m,d,p,v,f,h,g;for(null==t&&(t=!1),u=e.search(RegExp(""+x.LF+x.LF)),n=(h=e.substring(0,u).split(x.LF)).shift(),s={},g=function(e){return e.replace(/^\s+|\s+$/g,"")},c=0,m=(p=h.reverse()).length;c<m;c++)r=(d=p[c]).indexOf(":"),s[g(d.substring(0,r))]=t&&"CONNECT"!==n&&"CONNECTED"!==n?y.frUnEscape(g(d.substring(r+1))):g(d.substring(r+1));if(i="",h=u+2,s["content-length"])u=parseInt(s["content-length"]),i=(""+e).substring(h,h+u);else for(o=l=v=h,f=e.length;(v<=f?l<f:f<l)&&(a=e.charAt(o))!==x.NULL;o=v<=f?++l:--l)i+=a;return new y(n,s,i,t)},y.unmarshall=function(e,n){var s,o,t;return null==n&&(n=!1),o=e.split(RegExp(""+x.NULL+x.LF+"*")),(e={frames:[],partial:""}).frames=function(){for(var e=o.slice(0,-1),t=[],i=0,a=e.length;i<a;i++)s=e[i],t.push(r(s,n));return t}(),(t=o.slice(-1)[0])===x.LF||-1!==t.search(RegExp(""+x.NULL+x.LF+"*$"))?e.frames.push(r(t,n)):e.partial=t,e},y.marshall=function(e,t,i,a){return new y(e,t,i,a).toString()+x.NULL},y.frEscape=function(e){return(""+e).replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},y.frUnEscape=function(e){return(""+e).replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},p=y,e.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},f=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(e,t,i){var a=p.marshall(e,t,i,this.escapeHeaderValues);for("function"==typeof this.debug&&this.debug(">>> "+a);;){if(!(a.length>this.maxWebSocketFrameSize))return this.ws.send(a);this.ws.send(a.substring(0,this.maxWebSocketFrameSize)),a=a.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+a.length)}},e.prototype._setupHeartbeat=function(n){var t,s,e,i,a,o;if((a=n.version)===v.VERSIONS.V1_1||a===v.VERSIONS.V1_2)return i=(a=function(){for(var e=n["heart-beat"].split(","),t=[],i=0,a=e.length;i<a;i++)s=e[i],t.push(parseInt(s));return t}())[0],a=a[1],0!==this.heartbeat.outgoing&&0!==a&&(t=Math.max(this.heartbeat.outgoing,a),"function"==typeof this.debug&&this.debug("send PING every "+t+"ms"),this.pinger=v.setInterval(t,(e=this,function(){return e.ws.send(x.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==i?(t=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+t+"ms"),this.ponger=v.setInterval(t,(o=this,function(){var e=f()-o.serverActivity;if(2*t<e)return"function"==typeof o.debug&&o.debug("did not receive server activity for the last "+e+"ms"),o.ws.close()}))):void 0},e.prototype._parseConnect=function(){var e,t,i,a=1<=arguments.length?o.call(arguments,0):[],n={};if(a.length<2)throw"Connect requires at least 2 arguments";return"function"==typeof a[1]?(n=a[0],t=a[1],i=a[2],e=a[3]):6===a.length?(n.login=a[0],n.passcode=a[1],t=a[2],i=a[3],e=a[4],n.host=a[5]):(n.login=a[0],n.passcode=a[1],t=a[2],i=a[3],e=a[4]),[n,t,i,e]},e.prototype.connect=function(){var e=1<=arguments.length?o.call(arguments,0):[];return this.escapeHeaderValues=!1,e=this._parseConnect.apply(this,e),this.headers=e[0],this.connectCallback=e[1],this.errorCallback=e[2],this.closeEventCallback=e[3],this._active=!0,this._connect()},e.prototype._connect=function(){var u,m,i,e,t=this.headers,d=this.errorCallback,a=this.closeEventCallback;{if(this._active)return"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws=this.ws_fn(),u=function(e){for(var t,i,a,n="",s=e.length,o=0;o<s;)switch((t=e[o++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(t);break;case 12:case 13:i=e[o++],n+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=e[o++],a=e[o++],n+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&a)<<0)}return n},this.ws.onmessage=(m=this,function(e){var t,i,a,n,s,o,r,c,l="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(l=new Uint8Array(e.data),"function"==typeof m.debug&&m.debug("--- got data length: "+l.length),u(l)):e.data;if(m.serverActivity=f(),l===x.LF)"function"==typeof m.debug&&m.debug("<<< PONG");else for("function"==typeof m.debug&&m.debug("<<< "+l),e=p.unmarshall(m.partialData+l,m.escapeHeaderValues),m.partialData=e.partial,a=0,n=(r=e.frames).length;a<n;a++)switch((i=r[a]).command){case"CONNECTED":if("function"==typeof m.debug&&m.debug("connected to server "+i.headers.server),m.connected=!0,m.version=i.headers.version,m.version===v.VERSIONS.V1_2&&(m.escapeHeaderValues=!0),!m._active)return void m.disconnect();m._setupHeartbeat(i.headers),"function"==typeof m.connectCallback&&m.connectCallback(i);break;case"MESSAGE":c=i.headers.subscription,(o=m.subscriptions[c]||m.onreceive)?(s=(t=m).version===v.VERSIONS.V1_2?i.headers.ack:i.headers["message-id"],i.ack=function(e){return t.ack(s,c,e=null==e?{}:e)},i.nack=function(e){return t.nack(s,c,e=null==e?{}:e)},o(i)):"function"==typeof m.debug&&m.debug("Unhandled received MESSAGE: "+i);break;case"RECEIPT":i.headers["receipt-id"]===m.closeReceipt?(m.ws.onclose=null,m.ws.close(),m._cleanUp(),"function"==typeof m._disconnectCallback&&m._disconnectCallback()):"function"==typeof m.onreceipt&&m.onreceipt(i);break;case"ERROR":"function"==typeof d&&d(i);break;default:"function"==typeof m.debug&&m.debug("Unhandled frame: "+i)}}),this.ws.onclose=(i=this,function(e){var t="Whoops! Lost connection to "+i.ws.url;return"function"==typeof i.debug&&i.debug(t),"function"==typeof a&&a(e),i._cleanUp(),"function"==typeof d&&d(t),i._schedule_reconnect()}),this.ws.onopen=(e=this,function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),t["accept-version"]=v.VERSIONS.supportedVersions(),t["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",t)});this.debug("Client has been marked inactive, will not attempt to connect")}},e.prototype._schedule_reconnect=function(){if(0<this.reconnect_delay)return"function"==typeof this.debug&&this.debug("STOMP: scheduling reconnection in "+this.reconnect_delay+"ms"),this._reconnector=setTimeout(function(){return e.connected?"function"==typeof e.debug?e.debug("STOMP: already connected"):void 0:("function"==typeof e.debug&&e.debug("STOMP: attempting to reconnect"),e._connect())},(e=this).reconnect_delay);var e},e.prototype.disconnect=function(e,t){if(null==t&&(t={}),this._disconnectCallback=e,this._active=!1,this.connected){t.receipt||(t.receipt="close-"+this.counter++),this.closeReceipt=t.receipt;try{return this._transmit("DISCONNECT",t)}catch(e){return"function"==typeof this.debug?this.debug("Ignoring error during disconnect",e):void 0}}},e.prototype._cleanUp=function(){if(this._reconnector&&clearTimeout(this._reconnector),this.connected=!1,this.subscriptions={},this.partial="",this.pinger&&v.clearInterval(this.pinger),this.ponger)return v.clearInterval(this.ponger)},e.prototype.send=function(e,t,i){return null==i&&(i=""),(t=null==t?{}:t).destination=e,this._transmit("SEND",t,i)},e.prototype.subscribe=function(e,t,i){var a;return(i=null==i?{}:i).id||(i.id="sub-"+this.counter++),i.destination=e,this.subscriptions[i.id]=t,this._transmit("SUBSCRIBE",i),a=this,{id:i.id,unsubscribe:function(e){return a.unsubscribe(i.id,e)}}},e.prototype.unsubscribe=function(e,t){return null==t&&(t={}),delete this.subscriptions[e],t.id=e,this._transmit("UNSUBSCRIBE",t)},e.prototype.begin=function(e){var t,i=e||"tx-"+this.counter++;return this._transmit("BEGIN",{transaction:i}),t=this,{id:i,commit:function(){return t.commit(i)},abort:function(){return t.abort(i)}}},e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},e.prototype.ack=function(e,t,i){return null==i&&(i={}),this.version===v.VERSIONS.V1_2?i.id=e:i["message-id"]=e,i.subscription=t,this._transmit("ACK",i)},e.prototype.nack=function(e,t,i){return null==i&&(i={}),this.version===v.VERSIONS.V1_2?i.id=e:i["message-id"]=e,i.subscription=t,this._transmit("NACK",i)},i=e,v={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"}},client:function(e,t){return null==t&&(t=["v10.stomp","v11.stomp","v12.stomp"]),new i(function(){return new(v.WebSocketClass||WebSocket)(e,t)})},over:function(e){return new i("function"==typeof e?e:function(){return e})},Frame:p,setInterval:function(e,t){return setInterval(t,e)},clearInterval:function(e){return clearInterval(e)}},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=v),"undefined"!=typeof window&&null!==window?window.Stomp=v:exports||(self.Stomp=v)}.call(this),!function(){function c(e){return null==e?A.identity:A.isFunction(e)?e:A.property(e)}function e(o){return function(i,a,n){var s={};return a=c(a),U(i,function(e,t){t=a.call(n,e,t,i);o(s,t,e)}),s}}function a(e,t,i){return t&&A.every(e,A.isArray)?p.apply(i,e):(U(e,function(e){A.isArray(e)||A.isArguments(e)?t?u.apply(i,e):a(e,t,i):i.push(e)}),i)}function o(){}function m(e,t,i,a){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof A&&(e=e._wrapped),t instanceof A&&(t=t._wrapped);var n=v.call(e);if(n!=v.call(t))return!1;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=i.length;s--;)if(i[s]==e)return a[s]==t;var o=e.constructor,r=t.constructor;if(o!==r&&!(A.isFunction(o)&&o instanceof o&&A.isFunction(r)&&r instanceof r)&&"constructor"in e&&"constructor"in t)return!1;i.push(e),a.push(t);var c=0,l=!0;if("[object Array]"==n){if(l=(c=e.length)==t.length)for(;c--&&(l=m(e[c],t[c],i,a)););}else{for(var u in e)if(A.has(e,u)&&(c++,!(l=A.has(t,u)&&m(e[u],t[u],i,a))))break;if(l){for(u in t)if(A.has(t,u)&&!c--)break;l=!c}}return i.pop(),a.pop(),l}var t=this,i=t._,r={},n=Array.prototype,s=Object.prototype,l=Function.prototype,u=n.push,d=n.slice,p=n.concat,v=s.toString,f=s.hasOwnProperty,h=n.forEach,g=n.map,x=n.reduce,y=n.reduceRight,w=n.filter,b=n.every,_=n.some,C=n.indexOf,k=n.lastIndexOf,s=Array.isArray,S=Object.keys,T=l.bind,A=function(e){return e instanceof A?e:this instanceof A?void(this._wrapped=e):new A(e)},U=("undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=A:exports)._=A:t._=A,A.VERSION="1.6.0",A.each=A.forEach=function(e,t,i){if(null!=e)if(h&&e.forEach===h)e.forEach(t,i);else if(e.length===+e.length){for(var a=0,n=e.length;a<n;a++)if(t.call(i,e[a],a,e)===r)return}else for(var s=A.keys(e),a=0,n=s.length;a<n;a++)if(t.call(i,e[s[a]],s[a],e)===r)return;return e}),O=(A.map=A.collect=function(e,a,n){var s=[];if(null!=e){if(g&&e.map===g)return e.map(a,n);U(e,function(e,t,i){s.push(a.call(n,e,t,i))})}return s},"Reduce of empty array with no initial value"),R=(A.reduce=A.foldl=A.inject=function(e,a,n,s){var o=2<arguments.length;if(null==e&&(e=[]),x&&e.reduce===x)return s&&(a=A.bind(a,s)),o?e.reduce(a,n):e.reduce(a);if(U(e,function(e,t,i){o?n=a.call(s,n,e,t,i):(n=e,o=!0)}),o)return n;throw new TypeError(O)},A.reduceRight=A.foldr=function(a,n,s,o){var r=2<arguments.length;if(null==a&&(a=[]),y&&a.reduceRight===y)return o&&(n=A.bind(n,o)),r?a.reduceRight(n,s):a.reduceRight(n);var c,l=a.length;if(l!==+l&&(c=A.keys(a),l=c.length),U(a,function(e,t,i){t=c?c[--l]:--l,r?s=n.call(o,s,a[t],t,i):(s=a[t],r=!0)}),r)return s;throw new TypeError(O)},A.find=A.detect=function(e,a,n){var s;return R(e,function(e,t,i){if(a.call(n,e,t,i))return s=e,!0}),s},A.filter=A.select=function(e,a,n){var s=[];if(null!=e){if(w&&e.filter===w)return e.filter(a,n);U(e,function(e,t,i){a.call(n,e,t,i)&&s.push(e)})}return s},A.reject=function(e,a,n){return A.filter(e,function(e,t,i){return!a.call(n,e,t,i)},n)},A.every=A.all=function(e,a,n){a=a||A.identity;var s=!0;return null==e?s:b&&e.every===b?e.every(a,n):(U(e,function(e,t,i){if(!(s=s&&a.call(n,e,t,i)))return r}),!!s)},A.some=A.any=function(e,a,n){a=a||A.identity;var s=!1;return null==e?s:_&&e.some===_?e.some(a,n):(U(e,function(e,t,i){if(s=s||a.call(n,e,t,i))return r}),!!s)}),j=(A.contains=A.include=function(e,t){return null!=e&&(C&&e.indexOf===C?-1!=e.indexOf(t):R(e,function(e){return e===t}))},A.invoke=function(e,t){var i=d.call(arguments,2),a=A.isFunction(t);return A.map(e,function(e){return(a?t:e[t]).apply(e,i)})},A.pluck=function(e,t){return A.map(e,A.property(t))},A.where=function(e,t){return A.filter(e,A.matches(t))},A.findWhere=function(e,t){return A.find(e,A.matches(t))},A.max=function(e,a,n){if(!a&&A.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var s=-1/0,o=-1/0;return U(e,function(e,t,i){t=a?a.call(n,e,t,i):e;o<t&&(s=e,o=t)}),s},A.min=function(e,a,n){if(!a&&A.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var s=1/0,o=1/0;return U(e,function(e,t,i){t=a?a.call(n,e,t,i):e;t<o&&(s=e,o=t)}),s},A.shuffle=function(e){var t,i=0,a=[];return U(e,function(e){t=A.random(i++),a[i-1]=a[t],a[t]=e}),a},A.sample=function(e,t,i){return null==t||i?(e=e.length!==+e.length?A.values(e):e)[A.random(e.length-1)]:A.shuffle(e).slice(0,Math.max(0,t))},A.sortBy=function(e,a,n){return a=c(a),A.pluck(A.map(e,function(e,t,i){return{value:e,index:t,criteria:a.call(n,e,t,i)}}).sort(function(e,t){var i=e.criteria,a=t.criteria;if(i!==a){if(a<i||void 0===i)return 1;if(i<a||void 0===a)return-1}return e.index-t.index}),"value")},A.groupBy=e(function(e,t,i){A.has(e,t)?e[t].push(i):e[t]=[i]}),A.indexBy=e(function(e,t,i){e[t]=i}),A.countBy=e(function(e,t){A.has(e,t)?e[t]++:e[t]=1}),A.sortedIndex=function(e,t,i,a){for(var n=(i=c(i)).call(a,t),s=0,o=e.length;s<o;){var r=s+o>>>1;i.call(a,e[r])<n?s=1+r:o=r}return s},A.toArray=function(e){return e?A.isArray(e)?d.call(e):e.length===+e.length?A.map(e,A.identity):A.values(e):[]},A.size=function(e){return null==e?0:(e.length===+e.length?e:A.keys(e)).length},A.first=A.head=A.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:t<0?[]:d.call(e,0,t)},A.initial=function(e,t,i){return d.call(e,0,e.length-(null==t||i?1:t))},A.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:d.call(e,Math.max(e.length-t,0))},A.rest=A.tail=A.drop=function(e,t,i){return d.call(e,null==t||i?1:t)},A.compact=function(e){return A.filter(e,A.identity)},A.flatten=function(e,t){return a(e,t,[])},A.without=function(e){return A.difference(e,d.call(arguments,1))},A.partition=function(e,t,i){t=c(t);var a=[],n=[];return U(e,function(e){(t.call(i,e)?a:n).push(e)}),[a,n]},A.uniq=A.unique=function(i,a,e,t){A.isFunction(a)&&(t=e,e=a,a=!1);var e=e?A.map(i,e,t):i,n=[],s=[];return U(e,function(e,t){(a?t&&s[s.length-1]===e:A.contains(s,e))||(s.push(e),n.push(i[t]))}),n},A.union=function(){return A.uniq(A.flatten(arguments,!0))},A.intersection=function(e){var i=d.call(arguments,1);return A.filter(A.uniq(e),function(t){return A.every(i,function(e){return A.contains(e,t)})})},A.difference=function(e){var t=p.apply(n,d.call(arguments,1));return A.filter(e,function(e){return!A.contains(t,e)})},A.zip=function(){for(var e=A.max(A.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=A.pluck(arguments,""+i);return t},A.object=function(e,t){if(null==e)return{};for(var i={},a=0,n=e.length;a<n;a++)t?i[e[a]]=t[a]:i[e[a][0]]=e[a][1];return i},A.indexOf=function(e,t,i){if(null!=e){var a=0,n=e.length;if(i){if("number"!=typeof i)return e[a=A.sortedIndex(e,t)]===t?a:-1;a=i<0?Math.max(0,n+i):i}if(C&&e.indexOf===C)return e.indexOf(t,i);for(;a<n;a++)if(e[a]===t)return a}return-1},A.lastIndexOf=function(e,t,i){if(null!=e){var a=null!=i;if(k&&e.lastIndexOf===k)return a?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var n=a?i:e.length;n--;)if(e[n]===t)return n}return-1},A.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var a=Math.max(Math.ceil((t-e)/i),0),n=0,s=new Array(a);n<a;)s[n++]=e,e+=i;return s},A.bind=function(i,a){var n,s;if(T&&i.bind===T)return T.apply(i,d.call(arguments,1));if(A.isFunction(i))return n=d.call(arguments,2),s=function(){if(!(this instanceof s))return i.apply(a,n.concat(d.call(arguments)));o.prototype=i.prototype;var e=new o,t=(o.prototype=null,i.apply(e,n.concat(d.call(arguments))));return Object(t)===t?t:e};throw new TypeError},A.partial=function(n){var s=d.call(arguments,1);return function(){for(var e=0,t=s.slice(),i=0,a=t.length;i<a;i++)t[i]===A&&(t[i]=arguments[e++]);for(;e<arguments.length;)t.push(arguments[e++]);return n.apply(this,t)}},A.bindAll=function(t){var e=d.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return U(e,function(e){t[e]=A.bind(t[e],t)}),t},A.memoize=function(t,i){var a={};return i=i||A.identity,function(){var e=i.apply(this,arguments);return A.has(a,e)?a[e]:a[e]=t.apply(this,arguments)}},A.delay=function(e,t){var i=d.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},A.defer=function(e){return A.delay.apply(A,[e,1].concat(d.call(arguments,1)))},A.throttle=function(i,a,n){function s(){u=!1===n.leading?0:A.now(),l=null,c=i.apply(o,r),o=r=null}var o,r,c,l=null,u=0;n=n||{};return function(){var e=A.now(),t=(u||!1!==n.leading||(u=e),a-(e-u));return o=this,r=arguments,t<=0?(clearTimeout(l),l=null,u=e,c=i.apply(o,r),o=r=null):l||!1===n.trailing||(l=setTimeout(s,t)),c}},A.debounce=function(t,i,a){function n(){var e=A.now()-c;e<i?s=setTimeout(n,i-e):(s=null,a||(l=t.apply(r,o),r=o=null))}var s,o,r,c,l;return function(){r=this,o=arguments,c=A.now();var e=a&&!s;return s=s||setTimeout(n,i),e&&(l=t.apply(r,o),r=o=null),l}},A.once=function(e){var t,i=!1;return function(){return i||(i=!0,t=e.apply(this,arguments),e=null),t}},A.wrap=function(e,t){return A.partial(t,e)},A.compose=function(){var i=arguments;return function(){for(var e=arguments,t=i.length-1;0<=t;t--)e=[i[t].apply(this,e)];return e[0]}},A.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},A.keys=function(e){if(!A.isObject(e))return[];if(S)return S(e);var t,i=[];for(t in e)A.has(e,t)&&i.push(t);return i},A.values=function(e){for(var t=A.keys(e),i=t.length,a=new Array(i),n=0;n<i;n++)a[n]=e[t[n]];return a},A.pairs=function(e){for(var t=A.keys(e),i=t.length,a=new Array(i),n=0;n<i;n++)a[n]=[t[n],e[t[n]]];return a},A.invert=function(e){for(var t={},i=A.keys(e),a=0,n=i.length;a<n;a++)t[e[i[a]]]=i[a];return t},A.functions=A.methods=function(e){var t,i=[];for(t in e)A.isFunction(e[t])&&i.push(t);return i.sort()},A.extend=function(i){return U(d.call(arguments,1),function(e){if(e)for(var t in e)i[t]=e[t]}),i},A.pick=function(t){var i={},e=p.apply(n,d.call(arguments,1));return U(e,function(e){e in t&&(i[e]=t[e])}),i},A.omit=function(e){var t,i={},a=p.apply(n,d.call(arguments,1));for(t in e)A.contains(a,t)||(i[t]=e[t]);return i},A.defaults=function(i){return U(d.call(arguments,1),function(e){if(e)for(var t in e)void 0===i[t]&&(i[t]=e[t])}),i},A.clone=function(e){return A.isObject(e)?A.isArray(e)?e.slice():A.extend({},e):e},A.tap=function(e,t){return t(e),e},A.isEqual=function(e,t){return m(e,t,[],[])},A.isEmpty=function(e){if(null!=e){if(A.isArray(e)||A.isString(e))return 0===e.length;for(var t in e)if(A.has(e,t))return!1}return!0},A.isElement=function(e){return!(!e||1!==e.nodeType)},A.isArray=s||function(e){return"[object Array]"==v.call(e)},A.isObject=function(e){return e===Object(e)},U(["Arguments","Function","String","Number","Date","RegExp"],function(t){A["is"+t]=function(e){return v.call(e)=="[object "+t+"]"}}),A.isArguments(arguments)||(A.isArguments=function(e){return!(!e||!A.has(e,"callee"))}),"function"!=typeof/./&&(A.isFunction=function(e){return"function"==typeof e}),A.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},A.isNaN=function(e){return A.isNumber(e)&&e!=+e},A.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==v.call(e)},A.isNull=function(e){return null===e},A.isUndefined=function(e){return void 0===e},A.has=function(e,t){return f.call(e,t)},A.noConflict=function(){return t._=i,this},A.identity=function(e){return e},A.constant=function(e){return function(){return e}},A.property=function(t){return function(e){return e[t]}},A.matches=function(i){return function(e){if(e!==i)for(var t in i)if(i[t]!==e[t])return!1;return!0}},A.times=function(e,t,i){for(var a=Array(Math.max(0,e)),n=0;n<e;n++)a[n]=t.call(i,n);return a},A.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},A.now=Date.now||function(){return(new Date).getTime()},{escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}}),E=(j.unescape=A.invert(j.escape),{escape:new RegExp("["+A.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+A.keys(j.unescape).join("|")+")","g")}),M=(A.each(["escape","unescape"],function(t){A[t]=function(e){return null==e?"":(""+e).replace(E[t],function(e){return j[t][e]})}}),A.result=function(e,t){if(null!=e)return t=e[t],A.isFunction(t)?t.call(e):t},A.mixin=function(i){U(A.functions(i),function(e){var t=A[e]=i[e];A.prototype[e]=function(){var e=[this._wrapped];return u.apply(e,arguments),L.call(this,t.apply(A,e))}})},0),N=(A.uniqueId=function(e){var t=++M+"";return e?e+t:t},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},/(.)^/),D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\t|\u2028|\u2029/g,L=(A.template=function(s,e,t){t=A.defaults({},t,A.templateSettings);var i,a=new RegExp([(t.escape||N).source,(t.interpolate||N).source,(t.evaluate||N).source].join("|")+"|$","g"),o=0,r="__p+='";s.replace(a,function(e,t,i,a,n){return r+=s.slice(o,n).replace(I,function(e){return"\\"+D[e]}),t&&(r+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),a&&(r+="';\n"+a+"\n__p+='"),o=n+e.length,e}),r+="';\n",r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(r=t.variable?r:"with(obj||{}){\n"+r+"}\n")+"return __p;\n";try{i=new Function(t.variable||"obj","_",r)}catch(e){throw e.source=r,e}if(e)return i(e,A);function n(e){return i.call(this,e,A)}return n.source="function("+(t.variable||"obj")+"){\n"+r+"}",n},A.chain=function(e){return A(e).chain()},function(e){return this._chain?A(e).chain():e});A.mixin(A),U(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=n[t];A.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],L.call(this,e)}}),U(["concat","join","slice"],function(e){var t=n[e];A.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return A})}.call(this),!function(){var e,i,t=this;if("function"==typeof t.require)try{var a=t.require("crypto").randomBytes,o=a&&function(){return a(16)}}catch(e){}!o&&t.crypto&&crypto.getRandomValues&&(e=new Uint8Array(16),o=function(){return crypto.getRandomValues(e),e}),o||(i=new Array(16),o=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i});for(var r="function"==typeof t.Buffer?t.Buffer:Array,n=[],s={},c=0;c<256;c++)n[c]=(c+256).toString(16).substr(1),s[n[c]]=c;function u(e,t){t=t||0;return n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[+t]]}var l,m=o(),d=[1|m[0],m[1],m[2],m[3],m[4],m[5]],p=16383&(m[6]<<8|m[7]),v=0,f=0;function h(e,t,i){var a=t&&i||0,n=("string"==typeof e&&(t="binary"==e?new r(16):null,e=null),(e=e||{}).random||(e.rng||o)());if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t)for(var s=0;s<16;s++)t[a+s]=n[s];return t||u(n)}(uuid=h).v1=function(e,t,i){var a=t&&i||0,n=t||[],i=null!=(e=e||{}).clockseq?e.clockseq:p,s=null!=e.msecs?e.msecs:(new Date).getTime(),o=null!=e.nsecs?e.nsecs:f+1;if((r=s-v+(o-f)/1e4)<0&&null==e.clockseq&&(i=i+1&16383),1e4<=(o=(r<0||v<s)&&null==e.nsecs?0:o))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=s,p=i;for(var r=(1e4*(268435455&(s+=122192928e5))+(f=o))%4294967296,o=(n[a++]=r>>>24&255,n[a++]=r>>>16&255,n[a++]=r>>>8&255,n[a++]=255&r,s/4294967296*1e4&268435455),c=(n[a++]=o>>>8&255,n[a++]=255&o,n[a++]=o>>>24&15|16,n[a++]=o>>>16&255,n[a++]=i>>>8|128,n[a++]=255&i,e.node||d),l=0;l<6;l++)n[a+l]=c[l];return t||u(n)},uuid.v4=h,uuid.parse=function(e,t,i){var a=t&&i||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[a+n++]=s[e])});n<16;)t[a+n++]=0;return t},uuid.unparse=u,uuid.BufferClass=r,"function"==typeof define&&define.amd?define("uuid",[],function(){return uuid}):"undefined"!=typeof module&&module.exports?module.exports=uuid:(l=t.uuid,uuid.noConflict=function(){return t.uuid=l,uuid},t.uuid=uuid)}.call(this),!function(n,m){"use strict";function s(e,t){if(!(this instanceof s))return new s(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),a=t?y.extend(_,t):_;this.getBrowser=function(){return w.rgx.apply(this,a.browser)},this.getCPU=function(){return w.rgx.apply(this,a.cpu)},this.getDevice=function(){return w.rgx.apply(this,a.device)},this.getEngine=function(){return w.rgx.apply(this,a.engine)},this.getOS=function(){return w.rgx.apply(this,a.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this.setUA(i)}var a,o,d="function",p="undefined",v="object",e="major",t="model",i="name",r="type",c="vendor",l="version",u="architecture",f="console",h="mobile",g="tablet",x="smarttv",y={extend:function(e,t){for(var i in t)-1!=="browser cpu device engine os".indexOf(i)&&t[i].length%2==0&&(e[i]=t[i].concat(e[i]));return e},has:function(e,t){if("string"==typeof e)return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},w={rgx:function(){for(var e,t,i,a,n,s,o,r=0,c=arguments;r<c.length;r+=2){var l=c[r],u=c[r+1];if(typeof e==p)for(a in e={},u)typeof(n=u[a])==v?e[n[0]]=m:e[n]=m;for(t=i=0;t<l.length;t++)if(s=l[t].exec(this.getUA())){for(a=0;a<u.length;a++)o=s[++i],typeof(n=u[a])==v&&0<n.length?2==n.length?typeof n[1]==d?e[n[0]]=n[1].call(this,o):e[n[0]]=n[1]:3==n.length?typeof n[1]!=d||n[1].exec&&n[1].test?e[n[0]]=o?o.replace(n[1],n[2]):m:e[n[0]]=o?n[1].call(this,o,n[2]):m:4==n.length&&(e[n[0]]=o?n[3].call(this,o.replace(n[1],n[2])):m):e[n]=o||m;break}if(s)break}return e},str:function(e,t){for(var i in t)if(typeof t[i]==v&&0<t[i].length){for(var a=0;a<t[i].length;a++)if(y.has(t[i][a],e))return"?"===i?m:i}else if(y.has(t[i],e))return"?"===i?m:i;return e}},b={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},_={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[i,l,e],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[i,"Opera"],l,e],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[i,l,e],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[i,"IE"],l,e],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[i,"Yandex"],l,e],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[i,/_/g," "],l,e],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[i,l,e],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[i,"Dolphin"],l,e],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[i,"Chrome"],l,e],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[l,e,[i,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[l,e,i],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[i,[e,w.str,b.browser.oldsafari.major],[l,w.str,b.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[i,l,e],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[i,"Netscape"],l,e],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[i,l,e]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[u,"amd64"]],[/(ia32(?=;))/i],[[u,y.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[u,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[u,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[u,/ower/,"",y.lowerize]],[/(sun4\w)[;\)]/i],[[u,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[u,y.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[t,c,[r,g]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[c,"Apple"],[r,g]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[c,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[c,t,[r,g]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[t,[c,"Amazon"],[r,g]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[t,w.str,b.device.amazon.model],[c,"Amazon"],[r,h]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,c,[r,h]],[/\((ip[honed|\s\w*]+);/i],[t,[c,"Apple"],[r,h]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[c,t,[r,h]],[/\((bb10);\s(\w+)/i],[[c,"BlackBerry"],t,[r,h]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[c,"Asus"],t,[r,g]],[/(sony)\s(tablet\s[ps])/i],[c,t,[r,g]],[/(nintendo)\s([wids3u]+)/i],[c,t,[r,f]],[/((playstation)\s[3portablevi]+)/i],[[c,"Sony"],t,[r,f]],[/(sprint\s(\w+))/i],[[c,w.str,b.device.sprint.vendor],[t,w.str,b.device.sprint.model],[r,h]],[/(Lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[[c,"Lenovo"],t,[r,g]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[c,[t,/_/g," "],[r,h]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[c,"Motorola"],t,[r,h]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[c,"Motorola"],t,[r,g]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[c,"Samsung"],t,[r,g]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[c,"Samsung"],t,[r,h]],[/(sie)-(\w+)*/i],[[c,"Siemens"],t,[r,h]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[c,"Nokia"],t,[r,h]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[c,"Acer"],t,[r,g]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[c,"LG"],t,[r,g]],[/(lg) netcast\.tv/i],[c,[r,x]],[/((nexus\s[45]))/i,/(lg)[e;\s\/-]+(\w+)*/i],[[c,"LG"],t,[r,h]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[c,"Lenovo"],t,[r,g]],[/linux;.+((jolla));/i],[c,t,[r,h]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[r,y.lowerize],c,t]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,l],[/rv\:([\w\.]+).*(gecko)/i],[l,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,l],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[l,w.str,b.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[l,w.str,b.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],l],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,l],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],l],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],l],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,l],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],l],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],l],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,l],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[i,"iOS"],[l,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[i,[l,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[i,l]]};s.VERSION="0.7.1",s.BROWSER={NAME:i,MAJOR:e,VERSION:l},s.CPU={ARCHITECTURE:u},s.DEVICE={MODEL:t,VENDOR:c,TYPE:r,CONSOLE:f,MOBILE:h,SMARTTV:x,TABLET:g},s.ENGINE={NAME:i,VERSION:l},s.OS={NAME:i,VERSION:l},typeof exports!=p?(exports=typeof module!=p&&module.exports?module.exports=s:exports).UAParser=s:(n.UAParser=s,typeof define==d&&define.amd&&define("UAParser",[],function(){return s}),typeof(a=n.jQuery||n.Zepto)!=p&&(o=new s,a.ua=o.getResult(),a.ua.get=function(){return o.getUA()},a.ua.set=function(e){o.setUA(e);var t,i=o.getResult();for(t in i)a.ua[t]=i[t]}))}(this),max||{}),max=(!function(n){function e(e){var i=this;i.minchars=e.minchars,i.maxui=e.maxui,i.source=e.source,i.action=e.action,i.filter=e.filter,i.requests={},i.$el=n(e.list),i.$list=i.$el.find("ul"),i.$el.on("click",".maxui-prediction",function(e){var t=n(e.currentTarget);i.select(t),i.choose(e)})}function t(e){var t=this;t.input=e.input,t.$input=n(t.input),t.placeholder=e.placeholder,t.$delegate=n(e.delegate),t.setBindings(),t.bindings=e.bindings,t.$input.val(t.placeholder)}max.views=max.views||{},n.extend(max.views,(e.prototype.select=function(e){this.$list.find(".maxui-prediction.selected").removeClass("selected"),e.addClass("selected")},e.prototype.choose=function(e){var t=this.$list.find(".maxui-prediction.selected");this.action.apply(this,[t]),this.hide()},e.prototype.moveup=function(e){var t=this.$list.find(".maxui-prediction.selected"),i=t.prev();0<i.length?this.select(i):this.select(t.siblings(":last"))},e.prototype.movedown=function(e){var t=this.$list.find(".maxui-prediction.selected"),i=t.next();t.removeClass("selected"),0<i.length?this.select(i):this.select(t.siblings(":first"))},e.prototype.matchingRequest=function(e){var i,a=e.substr(0,e.length-1);if(n.each(this.requests,function(e,t){a===e&&(i=t)}),i&&!i.remaining)return i.text},e.prototype.normalizeWhiteSpace=function(e,t){return e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),e=!0===(1<arguments.length?t:!0)?e.replace(/[ ]{2,}/gi," "):e},e.prototype.show=function(e){var t=this,i=n(e.target),a=t.normalizeWhiteSpace(i.val(),!1);a.length>=this.minchars?(i=t.matchingRequest(a),t.requests.hasOwnProperty(a)?t.render(a,a):i?t.render(a,i):this.source.apply(this,[e,a,function(e){t.requests[a]={text:a,data:e,remaining:this.getResponseHeader("X-Has-Remaining-Items")},t.render(a,a)}])):t.hide()},e.prototype.render=function(e,t){for(var i=this,a="",n=i.requests[t].data,s=i.filter(),o=!1,r=0;r<n.length;r++){var c=n[r],l=0<=c.username.search(new RegExp(e,"i")),l=0<=c.displayName.search(new RegExp(e,"i"))||l;-1===s.indexOf(c.username)&&l&&(l=i.maxui.settings.avatarURLpattern.format(c.username),c={username:c.username,displayName:c.displayName,avatarURL:l,cssclass:"maxui-prediction"+(o?"":" selected")},a+=i.maxui.templates.predictive.render(c),o=!0)}""===a&&(a="<li>"+i.maxui.settings.literals.no_match_found+"</li>"),i.$list.html(a),i.$el.show()},e.prototype.hide=function(e){this.$el.hide()},t.prototype.normalizeWhiteSpace=function(e,t){return e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),e=!0===(1<arguments.length?t:!0)?e.replace(/[ ]{2,}/gi," "):e},t.prototype.bind=function(e,t){this.$delegate.on(e,this.input,t)},t.prototype.execExtraBinding=function(e,t){this.bindings.hasOwnProperty(t.type)&&this.bindings[t.type].apply(e,[t])},t.prototype.getInputValue=function(){var e=this.$input.val();return this.normalizeWhiteSpace(e,!1)},t.prototype.setBindings=function(){var t=this;t.bind("focusin",function(e){e.preventDefault(),e.stopPropagation(),t.getInputValue()===t.placeholder&&n(this).val(""),t.execExtraBinding(this,e)}),t.bind("focusout",function(e){e.preventDefault(),e.stopPropagation(),""===t.getInputValue()&&(n(this).val(t.placeholder),t.$input.toggleClass("maxui-empty",!0)),t.execExtraBinding(this,e)});t.bind("maxui-input-submit maxui-input-cancel maxui-input-up maxui-input-down maxui-input-keypress",function(e){e.preventDefault(),e.stopPropagation(),t.execExtraBinding(this,e)}),t.bind("maxui-input-clear",function(e){t.$input.val(t.placeholder)}),t.bind("keydown",function(e){38===e.which?t.$input.trigger("maxui-input-up",[e]):40===e.which&&t.$input.trigger("maxui-input-down",[e]),t.$input.toggleClass("maxui-empty",!1)}),t.bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),13!==e.which||e.shiftKey?27===e.which?t.$input.trigger("maxui-input-cancel",[e]):38!==e.which&&40!==e.which&&t.$input.trigger("maxui-input-keypress",[e]):t.$input.trigger("maxui-input-submit",[e]),t.execExtraBinding(this,e)})},{MaxInput:t,MaxPredictive:e}))}(jQuery),max||{}),max=(!function(i){function e(e){var t=this;t.maxui=e,t.title="Overlay Title",t.content="",t.el="#maxui-overlay-panel",t.overlay_show_class=0<i("#box_chat").length?"#box_chat .maxui-overlay":".maxui-overlay",i(t.el+" .maxui-close").click(function(e){e.preventDefault(),e.stopPropagation(),t.maxui.overlay.hide()})}max.views=max.views||{},i.extend(max.views,(e.prototype.$el=function(){return i(this.el)},e.prototype.setTitle=function(e){this.$el().find("#maxui-overlay-title").text(e)},e.prototype.setContent=function(e){this.$el().find("#maxui-overlay-content").html(e)},e.prototype.configure=function(e){this.setTitle(e.title),this.setContent(e.content),e.bind(this)},e.prototype.show=function(e){var t=this;e.load(function(e){t.configure(e)}),i(t.overlay_show_class).show(),t.$el().animate({opacity:1},200)},e.prototype.hide=function(){var t=this;t.$el().trigger("maxui-overlay-close",[]),t.$el().animate({opacity:0},200,function(e){i(t.overlay_show_class).hide()})},{MaxOverlay:e}))}(jQuery),max||{}),max=(!function(r){function e(i){var a=this;a.maxui=i,a.title=i.settings.literals.conversations_info_title,a.content="<div>Hello world</div>",a.panelID="conversation-settings-panel",a.displayNameSlot={show:function(){var e=r(a.getOwnerSelector("")),t=r(a.getOwnerSelector("> #maxui-conversation-displayname-edit")),i=r(a.getOwnerSelector("> .maxui-displayname"));r(a.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname")).width(e.width()-82),i.hide(),t.show().val(i.text()).focus()},hide:function(){var e=r(a.getOwnerSelector("> #maxui-conversation-displayname-edit"));r(a.getOwnerSelector("> .maxui-displayname")).show(),e.hide().val("")},save:function(){var t=r(a.getOwnerSelector("> .maxui-displayname")),e=r(a.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"));i.maxClient.modifyConversation(a.data.id,e.val(),function(e){a.displayNameSlot.hide(),t.text(this.displayName),i.conversations.messagesview.setTitle(this.displayName)})}}}max.views=max.views||{},r.extend(max.views,(e.prototype.getOwnerSelector=function(e){return"#maxui-"+this.panelID+".maxui-owner "+e},e.prototype.getSelector=function(e){return"#maxui-"+this.panelID+" "+e},e.prototype.bind=function(s){var o=this;s.$el().unbind(),s.$el().on("maxui-overlay-close",function(e){var t=_.where(o.maxui.conversations.listview.conversations,{id:o.maxui.conversations.active});_.isEmpty(t)||o.maxui.conversations.listview.loadConversation(o.maxui.conversations.active)}),s.$el().on("click",o.getOwnerSelector("> .maxui-displayname"),function(e){o.displayNameSlot.show()}),s.$el().on("keyup",o.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"),function(e){27===e.which?o.displayNameSlot.hide():13===e.which&&o.displayNameSlot.save()}),s.$el().on("click",o.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-ok-circled"),function(e){o.displayNameSlot.save()}),s.$el().on("click",o.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-cancel-circled"),function(e){o.displayNameSlot.hide()}),s.$el().on("click",o.getOwnerSelector(".maxui-conversation-user-action"),function(e){var e=r(e.currentTarget),t=e.closest(".maxui-participant");t.find(".maxui-conversation-confirmation:visible").hide(),t.find(".maxui-conversation-user-action.active").removeClass("active"),e.addClass("active"),e.hasClass("maxui-icon-crown-plus")?t.find(".maxui-conversation-transfer-to").show():e.hasClass("maxui-icon-trash")&&t.find(".maxui-conversation-kick-user").show()}),s.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-transfer-to .maxui-icon-ok-circled"),function(e){var t=r(e.currentTarget).closest(".maxui-participant"),e=t.attr("data-username"),i=r(o.getSelector(".maxui-participant.maxui-owner")),a=i.find(".maxui-icon-crown"),n=t.find(".maxui-icon-crown-plus");o.maxui.maxClient.transferConversationOwnership(o.data.id,e,function(e){t.find(".maxui-conversation-transfer-to").hide(),a.removeClass("maxui-icon-crown").addClass("maxui-icon-crown-plus"),n.removeClass("maxui-icon-crown-plus").addClass("maxui-icon-crown"),i.removeClass("maxui-owner"),t.addClass("maxui-owner"),s.$el().find(o.getSelector("")).toggleClass("maxui-owner",!1),s.$el().find(o.getSelector("#maxui-new-participant")).remove(),n.removeClass("active")})}),s.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-kick-user .maxui-icon-ok-circled"),function(e){var t=r(e.currentTarget).closest(".maxui-participant"),e=t.attr("data-username");o.maxui.maxClient.kickUserFromConversation(o.data.id,e,function(e){t.remove()})}),s.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-confirmation .maxui-icon-cancel-circled"),function(e){e=r(e.currentTarget).closest(".maxui-participant");e.find(".maxui-conversation-confirmation:visible").hide(),e.find(".maxui-conversation-user-action.active").removeClass("active")}),o.predictive=new max.views.MaxPredictive({maxui:o.maxui,minchars:3,filter:function(e){return r.map(o.data.participants,function(e,t){return e.username})},source:function(e,t,i){o.maxui.maxClient.getUsersList(t,i)},action:function(e){var t=e.attr("data-username"),e={style:"opacity:0; height:0px;",username:t,displayName:e.attr("data-username"),literals:o.maxui.settings.literals,avatarURL:o.maxui.settings.avatarURLpattern.format(t)},t=o.maxui.templates.participant.render(e),i=(r(o.getSelector(".maxui-participants > ul")).append(t),r(o.getSelector(".maxui-participant:last")));i.animate({height:36},100,function(e){i.animate({opacity:1},200)}),i.find(".maxui-conversation-add-user").show().focus(),r(o.getSelector("#maxui-new-participant .maxui-text-input")).trigger("maxui-input-clear")},list:"#maxui-new-participant #maxui-conversation-predictive"}),o.newparticipant=new max.views.MaxInput({input:"#maxui-new-participant .maxui-text-input",delegate:s.el,placeholder:o.maxui.settings.literals.conversations_info_add,bindings:{"maxui-input-keypress":function(e){o.predictive.show(e)},"maxui-input-submit":function(e){o.predictive.choose(e)},"maxui-input-cancel":function(e){o.predictive.hide(e)},"maxui-input-up":function(e){o.predictive.moveup(e)},"maxui-input-down":function(e){o.predictive.movedown(e)}}}),s.$el().on("click",o.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-ok-circled"),function(e){var t=r(e.target).closest(".maxui-participant"),e=t.attr("data-username");o.maxui.maxClient.addUserToConversation(o.data.id,e,function(e){t.animate({opacity:0},200,function(e){t.find(".maxui-conversation-add-user").remove(),t.animate({opacity:1},200),t.find(".maxui-conversation-user-action").show()})})}),s.$el().on("click",o.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-cancel-circled"),function(e){var t=r(e.currentTarget).closest(".maxui-participant");t.animate({opacity:0},200,function(e){t.animate({height:0},200,function(e){t.remove()})})}),s.$el().on("click",o.getSelector("#maxui-conversation-leave .maxui-button"),function(e){var t=o.maxui.settings.username;o.maxui.maxClient.kickUserFromConversation(o.data.id,t,function(e){o.maxui.conversations.listview.remove(o.data.id),s.hide(),r("#maxui-back-conversations a").trigger("click")})}),s.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-button"),function(e){r(o.getSelector("#maxui-conversation-delete .maxui-help")).show()}),s.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-ok"),function(e){o.maxui.maxClient.deleteConversation(o.data.id,function(e){o.maxui.conversations.listview.remove(o.data.id),s.hide(),r("#maxui-back-conversations a").trigger("click")})}),s.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-cancel"),function(e){r(o.getSelector("#maxui-conversation-delete .maxui-help")).hide()})},e.prototype.load=function(c){var l=this;l.maxui.maxClient.getConversation(l.maxui.conversations.active,function(r){l.maxui.maxClient.getConversationSubscription(l.maxui.conversations.active,l.maxui.settings.username,function(e){l.data=r;for(var t=[],i=0;i<l.data.participants.length;i++){var a=l.data.participants[i];a.avatarURL=l.maxui.settings.avatarURLpattern.format(a.username),a.owner=a.username===l.data.owner,t.push(a)}var n=l.maxui.settings.conversationAvatarURLpattern.format(l.data.id),s=l.data.displayName,o=(l.data.participants.length<=2&&(o=l.data.participants[0],1===l.data.participants.length?s="[Archive] "+o.displayName:l.data.participants[0].username===l.maxui.settings.username&&1<l.data.participants.length&&(o=l.data.participants[1]),n=l.maxui.settings.avatarURLpattern.format(o.username)),{displayName:s,conversationAvatarURL:n,participants:t,literals:l.maxui.settings.literals,panelID:l.panelID,published:l.maxui.utils.formatDate(l.data.published,l.maxui.language),canManage:l.maxui.settings.username===l.data.owner,canAdd:_.contains(e.permissions,"invite")});l.content=l.maxui.templates.conversationSettings.render(o),c(l)})})},{MaxChatInfo:e}))}(jQuery),max||{}),max=(!function(i){function e(e){var t=this;t.maxui=e.maxui,t.width=e.width,t.handle=e.handle,t.dragging=!1,t.scrollbar_selector=e.scrollbar,t.$bar=i(t.scrollbar_selector),t.$dragger=t.$bar.find(".maxui-dragger"),t.target_selector=e.target,t.$target=i(t.target_selector),t.bind()}max.views=max.views||{},i.extend(max.views,(e.prototype.bind=function(){var n=this;n.$target.on("mousewheel",function(e,t,i,a){e.preventDefault(),e.stopPropagation(),n.enabled()&&(e=n.$target.height()-n.maxtop-n.handle.height,a=parseInt(n.$target.css("margin-top"),10)+10*+a,n.$target.css({"margin-top":a=(a=0<a?0:a)<-1*e?-1*e:a}),a=100*(a*=-1)/e,n.setDraggerPosition(a))}),i(document).on("mousemove",function(e){n.dragging&&(e.stopPropagation(),e.preventDefault(),n.enabled()&&(e=100*(e=(e=(e=e.clientY+i(window).scrollTop()-n.$bar.offset().top)<0?0:e)>=n.maxtop?n.maxtop:e)/n.maxtop,n.setContentPosition(e)))}),i(document.body).on("mousedown",".maxui-dragger",function(e){e.stopPropagation(),e.preventDefault(),n.dragging=!0}),i(document).on("mouseup",function(e){n.dragging=!1})},e.prototype.setHeight=function(e){var t=i("#maxui-conversations .maxui-wrapper").offset().top-this.maxui.offset().top-1;this.$bar.css({height:e,top:t}),this.maxtop=e-this.handle.height-2},e.prototype.setTarget=function(e){this.$target=i(e)},e.prototype.setDraggerPosition=function(e){e=this.maxtop*e/100;this.$dragger.css({"margin-top":e})},e.prototype.setContentPosition=function(e){var t,i=this;i.enabled()?(t=i.$target.height()-i.maxtop-i.handle.height,i.$target.css({"margin-top":-1*(t*e/100)}),i.setDraggerPosition(e)):(i.$target.css({"margin-top":""}),i.setDraggerPosition(0))},e.prototype.enabled=function(){return this.$target.height()>this.maxtop},{MaxScrollbar:e}))}(jQuery),max||{}),max=(!function(u){function a(e,t){this.conversations=[],this.mainview=e,this.maxui=this.mainview.maxui}function n(e,t){var i=this;i.messages={},i.mainview=e,i.maxui=i.mainview.maxui,i.remaining=!0}function e(e,t){var i=this;i.logtag="CONVERSATIONS",i.el="#maxui-conversations",i.$el=u(i.el),i.maxui=e,i.height=320,i.listview=new a(i),i.messagesview=new n(i),i.conversationSettings=new max.views.MaxChatInfo(i.maxui),i.active=""}max.views=max.views||{},u.extend(max.views,(a.prototype.load=function(t){var i=this;_.isArray(t)?(i.conversations=t,i.render(!1)):_.isFunction(t)&&i.maxui.maxClient.getConversationsForUser.apply(i.maxui.maxClient,[i.maxui.settings.username,function(e){i.maxui.logger.info("Loaded {0} conversations from max".format(i.maxui.settings.username),i.mainview.logtag),i.conversations=e,i.render(),t()}])},a.prototype.loadConversation=function(e){var i,a=this;1<arguments.length&&(i=arguments[1]),a.maxui.maxClient.getConversationSubscription(e,a.maxui.settings.username,function(t){_.findWhere(a.conversations,{id:t.id})?a.conversations=_.map(a.conversations,function(e){return e.id===t.id?t:e}):(t.unread_messages=1,a.conversations.push(t)),a.sort(),a.render(),_.isUndefined(i)||i.call(a.mainview)})},a.prototype.updateLastMessage=function(t,i){var a=this;a.conversations=_.map(a.conversations,function(e){return e.id===t&&(e.lastMessage=i,_.defaults(e,{unread_messages:0}),a.maxui.settings.username!==i.user&&(e.unread_messages+=1)),e},a),a.sort()},a.prototype.resetUnread=function(t){this.conversations=_.map(this.conversations,function(e){return e.id===t&&(e.unread_messages=0),e},this),this.mainview.updateUnreadConversations()},a.prototype.sort=function(){this.conversations=_.sortBy(this.conversations,function(e){return e.lastMessage.published}),this.conversations.reverse()},a.prototype.remove=function(t){this.conversations=_.filter(this.conversations,function(e){return e.id!==t}),this.sort(),this.render()},a.prototype.insert=function(e){this.conversations.push(e),this.sort(),this.render()},a.prototype.show=function(){var e=this;e.mainview.loadWrappers(),e.mainview.$newparticipants.show(),u("#maxui-newactivity-box > .upload-file").hide(),u("#maxui-newactivity-box > .upload-img").hide(),u("#maxui-newactivity-box > #preview").hide(),0===e.conversations.length?e.load():e.render(),e.toggle()},a.prototype.toggle=function(){var e,t=this;t.mainview.loadWrappers();t.mainview.visible()||(t.mainview.$addpeople.css({"border-color":"#ccc"}),t.mainview.$common_header.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),t.mainview.scrollbar.setHeight(t.mainview.height-75),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),t.mainview.scrollbar.setContentPosition(0),t.mainview.$addpeople.animate({height:19,"padding-top":6,"padding-bottom":6},400,function(e){t.mainview.$addpeople.removeAttr("style")}),e=t.mainview.$conversations_list.width()+11,t.mainview.$conversations_list.animate({"margin-left":0},400),t.mainview.$messages.animate({left:e+20},400),t.maxui.settings.conversationsSection="conversations",e=t.maxui.settings.literals.new_conversation_text,t.mainview.$postbox.val(e).attr("data-literal",e))},a.prototype.render=function(){var e=!0,t=(0<arguments.length&&(e=arguments[0]),this),i='<span id="maxui-info">'+t.maxui.settings.literals.no_chats+"<span>",a="conversations"===t.maxui.settings.UISection,a=!1===t.maxui.settings.disableConversations&&!a,a={avatar:t.maxui.settings.avatarURLpattern.format(t.maxui.settings.username),allowPosting:!0,imgLiteral:t.maxui.settings.literals.new_img_post,fileLiteral:t.maxui.settings.literals.new_file_post,buttonLiteral:t.maxui.settings.literals.new_message_post,textLiteral:t.maxui.settings.literals.new_conversation_text,literals:t.maxui.settings.literals,showConversationsToggle:a?"display:block;":"display:none;",showSubscriptionList:!1},a=t.maxui.templates.postBox.render(a),n=u("#maxui-newactivity");e&&n.html(a),0<t.conversations.length&&(i="");for(var s=0;s<t.conversations.length;s++){var o=t.conversations[s],r=o.participants[0],c=t.maxui.settings.conversationAvatarURLpattern.format(o.id),l="",r=(o.participants.length<=2&&(1===o.participants.length?(r=o.participants[0],l+="[Archive] "):o.participants[0].username===t.maxui.settings.username&&(r=o.participants[1]),c=t.maxui.settings.avatarURLpattern.format(r.username)),l+=o.displayName,{id:o.id,displayName:l,text:t.maxui.utils.formatText(o.lastMessage.content),messages:o.unread_messages,literals:t.maxui.settings.literals,date:t.maxui.utils.formatDate(o.lastMessage.published,t.maxui.language),avatarURL:c,hasUnread:0<o.unread_messages});i+=t.maxui.templates.conversation.render(r)}u("#maxui-conversations-list").html(i)},n.prototype.load=function(){var a=this,t=a.mainview.active;0<arguments.length&&(t=arguments[0]),a.messages[t]=[],a.maxui.maxClient.getMessagesForConversation(t,{limit:10},function(e){a.maxui.logger.info("Loaded conversation {0} messages from max".format(t),a.mainview.logtag),a.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,a.append(e)});e=_.last(a.messages[t]);a.mainview.listview.updateLastMessage(t,{content:e.data.text,published:e.published,user:e.user.username}),a.mainview.listview.resetUnread(t),a.mainview.listview.render(!1),a.mainview.updateUnreadConversations(),a.render()})},n.prototype.ack=function(t){var e=this,i=(e.maxui.logger.info("Acknowledged Message {0} --\x3e {1}".format(t.uuid,t.data.id),e.mainview.logtag),u("#"+t.uuid)),a=i.hasClass("maxui-user-me"),n=i.find(".maxui-icon-check");n&&a&&(n.addClass("maxui-ack"),e.messages[e.mainview.active]=_.map(e.messages[e.mainview.active],function(e){return t.uuid===e.uuid&&(e.ack=!0),e}),i.attr("id",t.data.id))},n.prototype.exists=function(e){e=_.findWhere(this.messages[e.destination],{uuid:e.uuid});return _.isUndefined(e)},n.prototype.setTitle=function(e){this.mainview.$common_header.find("#maxui-back-conversations .maxui-title").text(e)},n.prototype.loadNew=function(){var a=this,e=_.last(a.messages[a.mainview.active]);a.maxui.maxClient.getMessagesForConversation(a.mainview.active,{limit:10,after:e.uuid},function(e){a.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,a.prepend(e,t)}),a.render()})},n.prototype.loadOlder=function(){var a=this,e=_.first(a.messages[a.mainview.active]);a.maxui.maxClient.getMessagesForConversation(a.mainview.active,{limit:10,before:e.uuid},function(e){a.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,a.prepend(e,t)}),a.render()})},n.prototype.append=function(e){var t,i=this;_.has(e,"data")?i.mainview.listview.updateLastMessage((t=e).destination,{content:t.data.text,published:t.published,user:t.user.username}):(t={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(t.data.fullURL=e.object.fullURL,t.data.thumbURL=e.object.thumbURL,t.data.filename=e.object.filename),i.mainview.listview.updateLastMessage(t.destination,{content:t.data.text,published:t.published,user:t.user.username})),i.messages[t.destination]=i.messages[t.destination]||[],i.messages[t.destination].push(t)},n.prototype.prepend=function(e,t){var i,a=this;_.has(e,"data")||(i={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(i.data.fullURL=e.object.fullURL,i.data.thumbURL=e.object.thumbURL,i.data.filename=e.object.filename)),a.messages[a.mainview.active]=a.messages[a.mainview.active]||[],a.messages[a.mainview.active].splice(t,0,i)},n.prototype.render=function(){var a=this,e="",t=[];if(a.messages[a.mainview.active]){a.setTitle(a.mainview.getActive().displayName);for(var i=0;i<a.messages[a.mainview.active].length;i++){var n=a.messages[a.mainview.active][i],s=a.maxui.settings.avatarURLpattern.format(n.user.username),o="maxui-user-notme",r=!0,c=(n.user.username===a.maxui.settings.username&&(r=!(o="maxui-user-me")),_.defaults(n.data,{filename:n.uuid}),_.contains(_.findWhere(a.mainview.listview.conversations,{id:a.mainview.active}).tags,"group")),s={id:n.uuid,text:a.maxui.utils.formatText(n.data.text),date:a.maxui.utils.formatDate(n.published,a.maxui.language),othersMessage:r,literals:a.maxui.settings.literals,avatarURL:s,maxServerURL:a.maxui.settings.maxServerURL,displayName:n.user.displayname,showDisplayName:r&&c,ack:!!n.ack&&"maxui-user-me"===o,fileDownload:"file"===n.data.objectType,filename:n.data.filename,auth:{token:a.maxui.settings.oAuthToken,username:a.maxui.settings.username}};e+=a.maxui.templates.message.render(s),"image"===n.data.objectType&&t.push(n)}u("#maxui-messages #maxui-message-list").html(e),_.each(t,function(t,e,i){a.maxui.maxClient.getMessageImage("/messages/{0}/image/thumb".format(t.uuid),function(e){e='<img class="maxui-embedded fullImage" alt="" src="data:image/png;base64,{0}" />'.format(e);u(".maxui-message#{0} .maxui-body".format(t.uuid)).after(e),u(".maxui-message#{0} img.fullImage".format(t.uuid)).on("click",function(){a.maxui.maxClient.getMessageImage(t.object.fullURL,function(e){var t=new Image;t.src="data:image/png;base64,"+e,window.open("").document.write(t.outerHTML)})}),a.mainview.scrollbar.setContentPosition(100)})});var l=u("#maxui-messages #maxui-more-messages");"1"===a.remaining?l.show():l.hide()}},n.prototype.show=function(e){var t=this,i=(t.mainview.loadWrappers(),u("#maxui-newactivity").find("input.maxui-button"));u("#preview").empty(),u("#maxui-img").val(""),u("#maxui-file").val(""),u("#maxui-newactivity-box > .upload-img").removeClass("label-disabled"),u("#maxui-img").prop("disabled",!1),u("#maxui-newactivity-box > .upload-file").removeClass("label-disabled"),u("#maxui-file").prop("disabled",!1),u("#maxui-newactivity-box > .upload-file").show(),u("#maxui-newactivity-box > .upload-img").show(),u("#maxui-newactivity-box > #preview").show(),t.maxui.loadPreviewRender(),i.attr("class","maxui-button"),t.mainview.$newmessagebox.find("textarea").attr("class","maxui-text-input"),t.mainview.$newmessagebox.find(".maxui-error-box").animate({"margin-top":-26},200),t.mainview.$newparticipants.hide(),t.mainview.active=e,t.mainview.listview.resetUnread(e),_.has(t.messages,e)?t.render():t.load(),t.toggle()},n.prototype.toggle=function(){var e,t=this;t.mainview.loadWrappers();"messages"!==t.maxui.settings.conversationsSection&&(t.mainview.$addpeople.animate({height:0,"padding-top":0,"padding-bottom":0},400,function(e){t.mainview.$addpeople.css({"border-color":"transparent"})}),t.setTitle(t.mainview.getActive().displayName),t.mainview.$common_header.removeClass("maxui-showing-conversations").addClass("maxui-showing-messages"),t.mainview.$conversations_list.animate({"margin-left":-1*t.maxui.settings.sectionsWidth},400),t.mainview.$messages.animate({left:0,"margin-left":0},400,function(e){t.mainview.scrollbar.setHeight(t.mainview.height-75),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-messages"),t.mainview.scrollbar.setContentPosition(100)}),t.mainview.$messages.width(t.maxui.settings.sectionsWidth),t.maxui.settings.conversationsSection="messages",e=t.maxui.settings.literals.new_activity_text,t.mainview.$postbox.val(e).attr("data-literal",e))},e.prototype.visible=function(){return this.$conversations.is(":visible")&&0<this.$conversations.height},e.prototype.loadScrollbar=function(){var e=this;e.scrollbar=new max.views.MaxScrollbar({maxui:e.maxui,width:e.maxui.settings.scrollbarWidth,handle:{height:20},scrollbar:e.el+" #maxui-scrollbar",target:e.el})},e.prototype.getActive=function(){return _.findWhere(this.listview.conversations,{id:this.active})},e.prototype.loadWrappers=function(){var e=this;e.$conversations=u("#maxui-conversations"),e.$conversations_list=u("#maxui-conversations-list"),e.$conversations_wrapper=e.$conversations.find(".maxui-wrapper"),e.$messages=u("#maxui-messages"),e.$message_list=u("#maxui-message-list"),e.$postbox=u("#maxui-newactivity-box textarea"),e.$common_header=e.$conversations.find("#maxui-common-header"),e.$addpeople=u("#maxui-add-people-box"),e.$newparticipants=u("#maxui-new-participants"),e.$newmessagebox=u("#maxui-newactivity")},e.prototype.render=function(){this.loadScrollbar(),this.bindEvents()},e.prototype.bindEvents=function(){var t=this;u("#maxui-conversation-info").click(function(e){e.preventDefault(),e.stopPropagation(),t.maxui.overlay.show(t.conversationSettings)}),u("#maxui-back-conversations").on("click",function(e){e.preventDefault(),e.stopPropagation(),window.status="",t.listview.show(),u("#maxui-newactivity-box > .upload-file").hide(),u("#maxui-newactivity-box > .upload-img").hide(),u("#maxui-newactivity-box > #preview").hide()}),u("#maxui-conversations").on("click",".maxui-conversation",function(e){e.preventDefault(),e.stopPropagation(),window.status="";e=u(e.target).closest(".maxui-conversation").attr("id");t.messagesview.show(e)}),u("#maxui-conversations").on("click","#maxui-more-messages .maxui-button",function(e){e.preventDefault(),e.stopPropagation(),window.status="",t.messagesview.loadOlder()})},e.prototype.send=function(t,i){t===u("#maxui-newactivity textarea").attr("data-literal")&&(t="");var a=this,n={};if(void 0===i){var n={object:{objectType:"message",content:""}},s=a.maxui.messaging.send({data:{text:t},action:"add",object:"message"},"{0}.messages".format(a.active));s.ack=!1,s.destination=a.active,a.messagesview.append(s),a.listview.updateLastMessage(a.active,{content:s.data.text,published:s.published,user:s.user.username}),u("#maxui-newactivity textarea").val(""),u("#maxui-newactivity .maxui-button").attr("disabled","disabled")}else{n="image"===i.type.split("/")[0]?{object:{objectType:"image",content:"",mimetype:i.type}}:{object:{objectType:"file",content:"",mimetype:i.type}};s=a.maxui.maxClient.ROUTES.messages.format(a.active);let e=new FormData;n.object.content=t,e.append("json_data",JSON.stringify(n)),e.append("file",new Blob([i],{type:i.type}),i.name);a.maxui.maxClient.POSTFILE(s,e,function(){u("#maxui-newactivity textarea").val(""),u("#maxui-newactivity .maxui-button").attr("disabled","disabled"),u("#preview").empty(),u("#maxui-img").val(""),u("#maxui-file").val(""),u("#maxui-newactivity-box > .upload-img").removeClass("label-disabled"),u("#maxui-img").prop("disabled",!1),u("#maxui-newactivity-box > .upload-file").removeClass("label-disabled"),u("#maxui-file").prop("disabled",!1)}),setTimeout(function(){a.messagesview.load()},500)}a.messagesview.show(a.active),a.scrollbar.setContentPosition(100)},e.prototype.create=function(n){var s=this;n.participants.push(s.maxui.settings.username),s.maxui.maxClient.addMessageAndConversation(n,function(e){var t=this,i=t.contexts[0].id,a={id:i,displayName:t.contexts[0].displayName,lastMessage:{content:t.object.content,published:t.published},participants:n.participants,tags:t.contexts[0].tags};s.active=i,s.listview.insert(a),s.messagesview.remaining=0,t.ack=!0,s.loadWrappers(),s.messagesview.append(t),s.messagesview.render(),s.messagesview.show(i),s.hideNameChat(),s.$newparticipants[0].people=[],s.maxui.reloadPersons()})},e.prototype.hideNameChat=function(){u("#maxui-add-people-box #maxui-new-displayName input").val(""),u("#maxui-add-people-box #maxui-new-displayName").hide()},e.prototype.updateUnreadConversations=function(e){var t=u("#maxui-show-conversations .maxui-unread-conversations"),i=_.filter(this.listview.conversations,function(e){if(0<e.unread_messages)return e}),a=jQuery("#menusup .fa-comment");0<i.length?(t.text(i.length),t.removeClass("maxui-hidden"),0<a.length&&a.addClass("flicker")):(t.addClass("maxui-hidden"),0<a.length&&a.removeClass("flicker"))},e.prototype.ReceiveMessage=function(e){var t=this,i=e.user.username!==t.maxui.settings.username,a=t.messagesview.exists(e);(i||a)&&(i?t.maxui.logger.log("New message from user {0} on {1}".format(e.user.username,e.destination),t.logtag):t.maxui.logger.log("Updating {1} messages sent from other {0} instances".format(e.user.username,e.destination),t.logtag),t.messagesview.append(e),t.updateUnreadConversations(),"conversations"===t.maxui.settings.UISection&&"messages"===t.maxui.settings.conversationsSection?(t.messagesview.render(!1),t.scrollbar.setContentPosition(100)):("conversations"===t.maxui.settings.UISection&&"conversations"===t.maxui.settings.conversationsSection||"timeline"===t.maxui.settings.UISection)&&t.listview.render(!1))},e.prototype.ReceiveConversation=function(t){var i=this,e=t.user.username!==i.maxui.settings.username,a=i.messagesview.exists(t);(e||a)&&("conversations"===i.maxui.settings.UISection&&"conversations"===i.maxui.settings.conversationsSection?(i.active=t.destination,i.listview.loadConversation(t.destination,function(e){this.messagesview.show(t.destination)})):"conversations"===i.maxui.settings.UISection&&"messages"===i.maxui.settings.conversationsSection?(i.active=t.destination,i.listview.loadConversation(t.destination,function(e){this.messagesview.load(),this.listview.resetUnread(t.destination)})):"timeline"===i.maxui.settings.UISection&&i.listview.loadConversation(t.destination,function(e){i.updateUnreadConversations(),i.listview.render()}))},{MaxConversations:e}))}(jQuery),max||{}),max=(max.templates=function(){return{activity:Hogan.compile('<div class="maxui-activity {{#flagged}}maxui-flagged{{/flagged}}" id="{{id}}" userid="{{actor.id}}" username="{{actor.username}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                    {{^showLikesCount}}<span class="maxui-publisheddate">{{date}}</span>{{/showLikesCount}}                    {{#showLikesCount}}<span class="maxui-likescount"><strong>{{likes}}</strong><i class="maxui-icon-thumbs-up"></i></span>{{/showLikesCount}}                </div>                <div class="maxui-actor">                    <a href="{{portalURL}}/profile/{{actor.username}}" title="{{literals.open_profile}}">                        <span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                    </a>                    <a class="maxui-filter-actor" href="#">                        <span class="maxui-displayname">{{actor.displayName}}</span>                    </a>                    <span class="maxui-username">{{actor.username}}&nbsp;</span>                </div>                <div class="maxui-activity-message">                    {{#fileDownload}}                    <form action="{{maxServerURL}}/activities/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="{{filename}}">                    </form>                    {{/fileDownload}}                    <p class="maxui-body">{{&text}}</p>                        </div>            </div>            <div class="maxui-footer">                {{#publishedIn}}                <div class="maxui-origin maxui-icon-">                       {{literals.context_published_in}}                       <a href="{{publishedIn.url}}">{{publishedIn.displayName}}</a>                       {{#via}}                           {{literals.generator_via}}                           <span class="maxui-via">                           {{via}}                           </span>                       {{/via}}                </div>                {{/publishedIn}}                <div class="maxui-actions">                    <a href="" class="maxui-action maxui-commentaction maxui-icon- {{#replies}}maxui-has-comments{{/replies}}"><strong>{{replies.length}}</strong> {{literals.toggle_comments}}</a>                    <a href="" class="maxui-action maxui-favorites {{#favorited}}maxui-favorited{{/favorited}} maxui-icon-">{{literals.favorite}}</a>                    <a {{#showLikes}}title="{{likesUsernames}}" {{/showLikes}}href="" class="maxui-action maxui-likes {{#liked}}maxui-liked{{/liked}} maxui-icon-"><strong>{{likes}}</strong> {{literals.like}}</a>                    {{#canFlagActivity}}                    <a href="" class="maxui-action maxui-flag {{#flagged}}maxui-flagged{{/flagged}} maxui-icon-">{{literals.flag_activity_icon}}</a>                    {{/canFlagActivity}}                    {{#canDeleteActivity}}                    <a href="" class="maxui-action maxui-delete maxui-icon-">{{literals.delete_activity_icon}}</a>                    <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                    </div>                    {{/canDeleteActivity}}                        </div>            </div>                    {{#canViewComments}}            <div class="maxui-comments" style="display: none">                <div class="maxui-commentsbox">                    {{#replies}}                        {{> comment}}                    {{/replies}}                </div>                {{#canWriteComment}}                <div class="maxui-newcommentbox">                        <textarea class="maxui-empty maxui-text-input" id="maxui-commentBox" data-literal="{{literals.new_comment_text}}">{{literals.new_comment_text}}</textarea>                        <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{literals.new_comment_post}}"/>                </div>                {{/canWriteComment}}            </div>            {{/canViewComments}}                    <div class="maxui-clear"></div>        </div>            '),comment:Hogan.compile('<div class="maxui-comment" id="{{id}}" userid="{{actor.id}}" displayname="{{actor.username}}">            <div class="maxui-activity-content">               <span class="maxui-publisheddate">{{date}}</span>               <div class="maxui-actor">                   <a href="{{portalURL}}/profile/{{actor.username}}" title="{{literals.open_profile}}">                       <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                    </a>                    <a class="maxui-filter-actor" href="#">                       <span class="maxui-displayname">{{actor.displayName}}</span>                    </a>                    <span class="maxui-username">{{actor.username}}</span>               </div>               <div>                   <p class="maxui-body">{{&text}}</p>                   {{#canDeleteComment}}                   <span class="maxui-delete-comment maxui-icon-"></span>                   <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                   </div>                   {{/canDeleteComment}}               </div>            </div>        </div>            '),conversation:Hogan.compile('<div class="maxui-conversation" id="{{id}}" data-displayname="{{displayName}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                            <div class="maxui-publisheddate">{{date}}</div>                    <div class="maxui-enterconversation">                        <a class="maxui-enterconversation maxui-icon-" href="#"></a>                        {{#hasUnread}}<span class="maxui-unread-messages">{{messages}}</span>{{/hasUnread}}                    </div>                </div>                <div class="maxui-actor">                    <a class="maxui-filter-actor" href="#">                        <span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                        <span class="maxui-displayname">{{displayName}}</span>                    </a>                </div>                <div>                    <p class="maxui-body">{{&text}}</p>                </div>            </div>                    <div class="maxui-clear"></div>        </div>            '),conversationSettings:Hogan.compile('<div id="maxui-{{panelID}}" {{#canManage}}class="maxui-owner"{{/canManage}}>          <span class="maxui-avatar maxui-big"><img src="{{conversationAvatarURL}}"></span>          <div id="maxui-conversation-displayname-edit">              <input type="text" class="maxui-displayname" value="{{displayName}}"/>              <i class="maxui-icon-cancel-circled"></i>              <i class="maxui-icon-ok-circled"></i>          </div>          <span class="maxui-displayname">{{displayName}}</span>          <span class="maxui-published">{{literals.conversations_info_created}} {{published}}</span>          <div class="maxui-participants">            <h4>{{literals.conversations_info_participants}}</h4>            <ul>              {{#participants}}              <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}">                  <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                  <span class="maxui-displayname">{{displayName}}                      <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="{{literals.conversations_info_kick_message_1}} {{displayName}} {{literals.conversations_info_kick_message_2}}"{{/owner}}></i>                      <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="{{literals.conversations_info_transfer_message_1}} {{displayName}} {{literals.conversations_info_transfer_message_2}}"{{/owner}}></i>                      <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                      <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                  </span>                  <span class="maxui-username">{{username}}</span>              </li>              {{/participants}}            </ul>            {{#canAdd}}            <div id="maxui-new-participant">                <i class="maxui-icon-user-add"/>                <input type="text" class="maxui-text-input maxui-empty"/>                <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            </div>            {{/canAdd}}            </div>            <div id="maxui-conversation-leave">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_leave}}">          </div>          <div id="maxui-conversation-delete">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_delete}}">              <div class="maxui-help">                  <p><b>{{literals.conversations_info_delete_warning}}</b> {{literals.conversations_info_delete_help}}</p>                  <button class="maxui-button maxui-button-red maxui-confirmation-cancel">{{literals.cancel}}</button>                  <button class="maxui-button maxui-button-green maxui-confirmation-ok">{{literals.delete}}</button>              </div>          </div>        </div>            '),filters:Hogan.compile('{{#filters}}            {{#visible}}            <div class="maxui-filter maxui-{{type}}" type="{{type}}" value="{{value}}"><span>{{prepend}}{{value}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>            {{/visible}}        {{/filters}}            '),mainUI:Hogan.compile('<div id="maxui-container" class="{{showMaxUIClass}}">        {{#username}}         <div id="maxui-mainpanel">           <div id="maxui-conversations" style="height:0px; {{showConversations}}">               <div id="maxui-common-header">                  <div id="maxui-conversations-header" class="maxui-togglebar">                      <h2 class="maxui-title">{{literals.conversations}}</h3></a>                  </div>                  <div id="maxui-back-conversations" class="maxui-togglebar">                      <a class="maxui-icon-" href="#"> {{literals.conversations_list}}                      <h3 class="maxui-title">displayName</h3></a>                      <i id="maxui-conversation-info" class="maxui-icon-cog"/>                  </div>               </div>               <div class="maxui-wrapper">                   <div id="maxui-conversations-list" class="maxui-activities">                       <span id="maxui-info">{{literals.no_chats}}<span>                   </div>                           <div id="maxui-messages" style="{{messagesStyle}}">                       <div id="maxui-more-messages">                           <input type="button" class="maxui-button maxui-button-grey" value="{{literals.chats_load_older}}">                       </div>                       <div id="maxui-message-list">                       </div>                   </div>                </div>                   <div id="maxui-scrollbar">                          <div class="maxui-dragger handle"/>                   </div>           </div>                    <div id="maxui-show-conversations" class="maxui-togglebar maxui-icon-" style="{{showConversationsToggle}}">                <span class="maxui-unread-conversations maxui-hidden"></span> <a href="#">{{literals.conversations_lower}}</a>            </div>                    <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            <div id="maxui-add-people-box" style="display:none;">                <div>                  <label class="maxui-label">{{literals.participants}}: <span class="maxui-count">(1/20)</span></label>                  <input tabindex="20" type="text" data-literal="{{literals.conversations_info_add}}" value="{{literals.conversations_info_add}}" class="maxui-text-input" id="add-user-input">                </div>                <div id="maxui-new-participants" style="display:none;"></div>                <div id="maxui-new-displayName" style="display:none;">                    <label class="maxui-label">{{literals.conversation_name}}: </label>                    <input tabindex="21" type="text" class="maxui-simple-text-input"/>                </div>            </div>                   <div id="maxui-newactivity" {{#hidePostbox}}style="display:none;"{{/hidePostbox}}>           </div>                   <div id="maxui-search" class="folded">               <a id="maxui-search-toggle" class="maxui-disabled maxui-icon-" href="#" alt="obre-tanca"></a>               <a href="#" id="maxui-favorites-filter" title="{{literals.favorites_filter_hint}}"><i class="maxui-icon-star"/></a>               <div id="maxui-search-box">                  <input id="maxui-search-text" type="search" data-literal="{{literals.search_text}}" class="maxui-empty maxui-text-input" value="{{literals.search_text}}" />               </div>               <div id="maxui-search-filters"></div>           </div>                   <div id="maxui-show-timeline" class="maxui-togglebar maxui-icon-" style="{{showTimelineToggle}}"><a href="#">{{literals.activity}}</a></div>                      <div id="maxui-activity-sort">                <a class="maxui-sort-action maxui-most-recent {{orderViewRecent}}" href="#">{{literals.recent_activity}}</a>                /                <a class="maxui-sort-action maxui-most-valued {{orderViewLikes}}" href="#">{{literals.valued_activity}}</a>                /                <a class="maxui-sort-action maxui-flagged {{orderViewFlagged}}" href="#">{{literals.flagged_activity}}</a>              </div>              <div id="maxui-news-activities" hidden>                  <input type="button" class="maxui-button" value="Carrega noves entrades">              </div>           <div id="maxui-timeline" style="{{showTimeline}}">              <div class="maxui-wrapper">                  <div id="maxui-preload" class="maxui-activities" style="height:0px;overflow:hidden">                      <div class="maxui-wrapper">                      </div>                  </div>                  <div id="maxui-activities" class="maxui-activities">                  </div>                  <div id="maxui-more-activities">                      <input type="button" class="maxui-button" value="{{literals.load_more}}">                  </div>              </div>           </div>           <div id="maxui-overlay-background" class="maxui-overlay">           </div>           <div id="maxui-overlay-wrapper" class="maxui-overlay">               <div id="maxui-overlay-panel">                   <div id="maxui-overlay-header">                        <h3 id="maxui-overlay-title">I\'m a overlay</h3>                        <i class="maxui-close maxui-icon-cancel"/>                   </div>                   <div id="maxui-overlay-content">                   </div>               </div>           </div>          </div>         </div>        {{/username}}        {{^username}}          No s\'ha definit cap usuari        {{/username}}        </div>            '),message:Hogan.compile('<div class="maxui-message maxui-user-{{#othersMessage}}not{{/othersMessage}}me" id="{{id}}">            <div class="maxui-activity-content">                <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                <div class="maxui-balloon">                    {{#fileDownload}}                    <form action="{{maxServerURL}}/messages/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="{{filename}}">                    </form>                    {{/fileDownload}}                    {{#showDisplayName}}<span class="maxui-displayname">{{displayName}}</span>{{/showDisplayName}}                    <p class="maxui-body">{{&text}}</p>                    <span class="maxui-publisheddate">{{date}}</span>                    <i class="maxui-icon-check{{#ack}} maxui-ack{{/ack}}"></i>                </div>            </div>            <div class="maxui-clear"></div>        </div>            '),participant:Hogan.compile('  <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}" style="{{style}}">              <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>              <span class="maxui-displayname">{{displayName}}                  <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="Click to kick {{displayName}} out of this conversation"{{/owner}} style="display:none;"></i>                  <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="Click to make {{displayName}} the owner of this conversation"{{/owner}} style="display:none;"></i>                  <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-add-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>              </span>              <span class="maxui-username">{{username}}</span>          </li>            '),participants:Hogan.compile('{{#persons}}        <div class="maxui-filter maxui-participant" type="participant" username="{{username}}"><span>{{prepend}}{{displayName}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>        {{/persons}}            '),postBox:Hogan.compile('      <span class="maxui-avatar maxui-big">                  <img src="{{avatar}}">              </span>              <div id="maxui-newactivity-box">                   <div class="maxui-wrapper">                       <textarea class="maxui-empty maxui-text-input" data-literal="{{textLiteral}}">{{textLiteral}}</textarea>                       <div class="maxui-error-box"></div>                   </div>                            {{#showSubscriptionList}}                    <select id="maxui-subscriptions">                      {{#subscriptionList}}                        <option value="{{hash}}">{{displayname}}</option>                      {{/subscriptionList}}                    </select>                    {{/showSubscriptionList}}                    <div id="preview"></div>                    <label for="maxui-file" class="upload-file">{{fileLiteral}}</label>                    <input type="file" id="maxui-file" class="maxui-file-image" accept="file/*" style="display:none">                    <label for="maxui-img" class="upload-img" style="">{{imgLiteral}}</label>                    <input type="file" id="maxui-img" class="maxui-file-image" accept="image/*" style="display:none">                   <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{buttonLiteral}}">              </div>            '),predictive:Hogan.compile('<li data-username="{{username}}" data-displayname="{{displayName}}" class="{{cssclass}}">        <img src="{{avatarURL}}"/><span>{{displayName}}</span>        </li>            ')}},max||{}),max=(!function(a){function e(e){var n=this;n.logtag="MESSAGING",n.maxui=e,n.active=!1,n.vhost="/",n.max_retries=3,n.retry_interval=3e3,n.debug=n.maxui.settings.enableAlerts,n.token=n.maxui.settings.oAuthToken,n.stompServer=n.maxui.settings.maxTalkURL,e.settings.domain?n.domain=e.settings.domain:n.domain=n.domainFromMaxServer(n.maxui.settings.maxServerURL),n.login="",n.domain&&(n.login+=n.domain+":"),n.login+=n.maxui.settings.username,n.ws=new WebSocket(n.stompServer),n.bindings=[],n.specification={uuid:{id:"g",type:"string"},user:{id:"u",type:"object",fields:{username:{id:"u"},displayname:{id:"d"}}},action:{id:"a",type:"char",values:{add:{id:"a"},delete:{id:"d"},modify:{id:"m"},refresh:{id:"r"},ack:{id:"k"}}},object:{id:"o",type:"char",values:{message:{id:"m"},conversation:{id:"c"},tweet:{id:"t"},activity:{id:"a"},context:{id:"x"},comment:{id:"t"}}},data:{id:"d",type:"object"},source:{id:"s",type:"char",values:{max:{id:"m"},widget:{id:"w"},ios:{id:"i"},android:{id:"a"},tweety:{id:"t"},maxbunny:{id:"b"}}},domain:{id:"i",type:"string"},version:{id:"v",type:"string"},published:{id:"p",type:"date"}},n._specification={},_.each(n.specification,function(e,t,i){var a=_.clone(e);_.has(a,"values")&&(a.values={},_.each(e.values,function(e,t,i){a.values[e.id]=_.clone(e),a.values[e.id].name=t,delete a.values[e.id].id})),_.has(a,"fields")&&"object"===a.type&&(a.fields={},_.each(e.fields,function(e,t,i){a.fields[e.id]=_.clone(e),a.fields[e.id].name=t,delete a.fields[e.id].id})),a.name=t,delete a.id,n._specification[e.id]=a})}e.prototype.domainFromMaxServer=function(e){var e=e.replace(/\/$/,""),t=document.createElement("a");return t.href=e,_.last(t.pathname.split("/"))},e.prototype.start=function(){var t=this,i=(t.maxui.logger.info("Connecting ...",t.logtag),t.connect(),1),a=setInterval(function(e){!t.active&&i<=t.max_retries?(t.maxui.logger.debug("Connection retry #{0}".format(i),t.logtag),t.disconnect(),t.ws=new WebSocket(t.maxui.settings.maxTalkURL),t.connect()):(t.active||t.maxui.logger.error("Connection failure after {0} reconnect attempts".format(t.max_retries),t.logtag),clearInterval(a)),i+=1},t.retry_interval)},e.prototype.bind=function(e,t){this.bindings.push({key:this.pack(e),callback:t})},e.prototype.on_message=function(s,o){var r=this,e=_.filter(r.bindings,function(e){var t=_.pick(s,_.keys(e.key));if(_.isEqual(e.key,t))return e});_.isEmpty(e)?r.maxui.logger.warning("Ignoring received message\n{0}\n No binding found for this message".format(s),r.logtag):_.each(e,function(e,t,i){r.maxui.logger.debug('Matched binding "{1}"'.format(s,e.key),r.logtag);var a=r.unpack(s),n=o.replace(/(\w+)\.(.*)/g,"$1");a.destination=n,e.callback(a)})},e.prototype.disconnect=function(){this.stomp.disconnect()},e.prototype.connect=function(){var i=this,e=(i.stomp=Stomp.over(i.ws),i.stomp.heartbeat.outgoing=6e4,i.stomp.heartbeat.incoming=6e4,i.stomp.reconnect_delay=100,[i.stomp.heartbeat.outgoing,i.stomp.heartbeat.incoming].join(",")),t=(i.stomp.debug=function(e){i.maxui.logger.debug(e,i.logtag)},"maxui"),e=(i.maxui.settings.generator&&(t+="[{0}]".format(i.maxui.settings.generator)),{login:i.login,passcode:i.token,host:i.vhost,"heart-beat":e,product:t,"product-version":i.maxui.version,platform:"{0} {1} / {2} {3}".format(a.ua.browser.name,a.ua.browser.version,a.ua.os.name,a.ua.os.version)});i.stomp.connect(e,function(e){i.stomp.subscribe("/exchange/{0}.subscribe".format(i.maxui.settings.username),function(e){var t=JSON.parse(e.body),e=/([^/])+$/.exec(e.headers.destination)[0];i.on_message(t,e)}),i.active=!0,i.maxui.logger.info("Succesfully connected to {0}".format(i.stompServer),i.logtag)},function(e){i.maxui.logger.error(e)})},e.prototype.pack=function(o){var r,c=this,l={};return _.each(o,function(e,t,i){var a,n,s=c.specification[t];_.isUndefined(s)||(_.has(s,"values")?_.has(s.values,e)&&(n=s.values[e].id):(n=e,_.has(s,"fields")&&"object"===s.type&&_.isObject(n)&&(a={},_.each(o[t],function(e,t,i){r=_.has(s.fields,t)?s.fields[t].id:t,a[r]=e}),n=a)),_.isUndefined(n)||(l[s.id]=n))}),l},e.prototype.unpack=function(o){var r,c=this,l={};return _.each(o,function(e,t,i){var a,n,s=c._specification[t];_.isUndefined(s)||(_.has(s,"values")?_.has(s.values,e)&&(n=s.values[e].name):(n=e,_.has(s,"fields")&&"object"===s.type&&_.isObject(n)&&(a={},_.each(o[t],function(e,t,i){r=_.has(s.fields,t)?s.fields[t].name:t,a[r]=e}),n=a)),_.isUndefined(n)||(l[s.name]=n))}),l},e.prototype.prepare=function(e){var t=this,i={source:"widget",version:t.maxui.version,user:{username:t.maxui.settings.username,displayname:t.maxui.settings.displayName},published:t.maxui.utils.rfc3339(t.maxui.utils.now()),uuid:uuid.v1()};return t.domain&&(i.domain=t.domain),_.extend(_.pick(e,_.keys(t.specification)),i)},e.prototype.send=function(e,t){e=this.prepare(e);return this.stomp.send("/exchange/{0}.publish/{1}".format(this.maxui.settings.username,t),{},JSON.stringify(this.pack(e))),e},max.MaxMessaging=e}(jQuery),max||{}),max=(!function(){var i={debug:0,info:1,warn:2,error:3};function e(e){this.level=0}e.prototype.setLevel=function(e){this.level=i[e]},e.prototype.log=function(e,t){try{window.console.log("{0}: {1}".format(t,e))}catch(e){}},e.prototype.debug=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.debug&&this.log(e,t)},e.prototype.info=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.info&&this.log(e,t)},e.prototype.warn=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.warn&&this.log(e,t)},e.prototype.error=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.error&&this.log(e,t)},max.MaxLogging=e}(jQuery),max||{}),max=(max.literals=function(e){var t={en:{cancel:"Cancel",delete:"Delete",months:["January","February","March","April","May","June","July","August","September","October","November","December"],new_activity_text:"Write something...",activity:"activity",conversations_lower:"chats",conversations:"Chats",conversations_list:"chats list",conversations_info_title:"Chat information",conversations_info_participants:"Participants",conversations_info_owner:"owner",conversations_info_add:"Add participant...",conversations_info_created:"Created",conversations_info_leave:"Leave chat",conversations_info_delete:"Delete chat",conversations_info_delete_warning:"Warning!",conversations_info_delete_help:"If you delete the chat, the participants will not be able to see the messages anymore. To avoid this, cancel and transfer the ownership to someone else.",conversations_info_kick_message_1:"Click to kick",conversations_info_kick_message_2:"out of this chat",conversations_info_transfer_message_1:"Click to make",conversations_info_transfer_message_2:"the owner of this chat",participants:"Talk to",chats_load_older:"Load older",conversation_name:"Chat name",message:"Message",no_chats:"No chats already",no_match_found:"No match found",new_conversation_text:"Add participants and send a message to start a chat",new_img_post:"Add image",new_file_post:"Add file",new_activity_post:"Post activity",toggle_comments:"comments",new_comment_text:"Comment something...",new_comment_post:"Post comment",load_more:"Load more",context_published_in:"Published in",generator_via:"via",search_text:"Search in posts...",and_more:"and more...",new_message_post:"Send message",post_permission_unauthorized:"You''re not authorized to post on this context",post_permission_not_here:"You're not mentioning @anyone",post_permission_not_enough_participants:"You have to add participants",post_permission_missing_displayName:"You have to name the chat",delete_activity_confirmation:"Are you sure?",delete_activity_delete:"Delete",delete_activity_cancel:"Cancel",delete_activity_icon:"delete",flag_activity_icon:"flagged",favorites_filter_hint:"Filter by favorited activity",favorites:"Favorites",favorite:"favorite",unfavorite:"unfavorite",like:"like",unlike:"unlike",recent_activity:"Latest activity",valued_activity:"Most valued activity",flagged_activity:"Flagged activity",recent_favorited_activity:"Latest favorites",valued_favorited_activity:"Most valued favorites",open_profile:"Show profile"},es:{cancel:"Cancelar",delete:"Eliminar",months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],new_activity_text:"Escribe algo...",activity:"actividad",conversations_lower:"chats",conversations:"Chats",conversations_list:"lista de chats",conversations_info_title:"Información del chat",conversations_info_participants:"Participantes",conversations_info_owner:"propietario",conversations_info_add:"Añade participante...",conversations_info_created:"Creada",conversations_info_leave:"Abandonar chat",conversations_info_delete:"Borra el chat",conversations_info_delete_warning:"Atención!",conversations_info_delete_help:"Si eliminas el chat, los participantes dejarán de ver los mensajes. Para evitar esto, cancela y luego traspasa el chat a otra persona.",conversations_info_kick_message_1:"Clica para echar a",conversations_info_kick_message_2:"de este chat",conversations_info_transfer_message_1:"Clica para dar a ",conversations_info_transfer_message_2:"la administración del chat",participants:"Chatear con",chats_load_older:"Cargar antiguos",conversation_name:"Nombre del chat",message:"Mensaje",no_chats:"No hay chats",no_match_found:"No hay coincidencias",new_conversation_text:"Añade participantes y envia el mensaje para iniciar un chat",new_img_post:"Añadir imagen",new_file_post:"Añadir archivo",new_activity_post:"Publica",toggle_comments:"comentarios",new_comment_text:"Comenta algo...",new_comment_post:"Comenta",load_more:"Cargar más",context_published_in:"Publicado en",generator_via:"via",search_text:"Busca en las entradas...",and_more:"i más...",new_message_post:"Envia el mensaje",post_permission_unauthorized:"No estas autorizado a publicar en este contexto",post_permission_not_here:"No estas citando a @nadie",post_permission_not_enough_participants:"Tienes que añadir participantes",post_permission_missing_displayName:"Tienes que dar un nombre al chat",delete_activity_confirmation:"Estás seguro?",delete_activity_delete:"Borrar",delete_activity_cancel:"Cancelar",delete_activity_icon:"borrar",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra por actividad favorita",favorites:"Favoritos",favorite:"favorito",unfavorite:"quitar favorito",like:"me gusta",unlike:"ya no me gusta",recent_activity:"Últimas actividades",valued_activity:"Actividades más valoradas",flagged_activity:"Actividades destacadas",recent_favorited_activity:"Últimas favoritas",valued_favorited_activity:"Favoritas más valoradas",open_profile:"Ver el perfil"},ca:{cancel:"Cancelar",delete:"Elimina",months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],new_activity_text:"Escriu alguna cosa...",activity:"activitat",conversations_lower:"xats",conversations:"Xats",conversations_list:"llista de xats",conversations_info_title:"Informació del xat",conversations_info_participants:"Participants",conversations_info_owner:"propietari",conversations_info_add:"Afegeix participant...",conversations_info_created:"Creada",conversations_info_leave:"Marxar del xat",conversations_info_delete:"Esborra el xat",conversations_info_delete_warning:"Alerta!",conversations_info_delete_help:"Si elimines el xat, la resta de participants deixaran de veure els missatges. Per evitar-ho, cancela i traspassa el xat a algú altre.",conversations_info_kick_message_1:"Clica per fer fora a ",conversations_info_kick_message_2:"d'aquest xat",conversations_info_transfer_message_1:"Clica per fer a",conversations_info_transfer_message_2:"l'administrador d'aquest xat",participants:"Xateja amb",chats_load_older:"Carregar antics",conversation_name:"Nom del xat",message:"Missatge",no_chats:"No hi ha xats",no_match_found:"No s'han trobat coincidències",new_conversation_text:"Afegeix participants i envia el missatge per iniciar un xat",new_img_post:"Afegir imatge",new_file_post:"Afegir arxiu",new_activity_post:"Publica",toggle_comments:"comentaris",new_comment_text:"Comenta alguna cosa...",new_comment_post:"Comenta",load_more:"Carrega'n més",context_published_in:"Publicat a",generator_via:"via",search_text:"Cerca a les entrades...",and_more:"i més...",new_message_post:"Envia el missatge",post_permission_unauthorized:"No estàs autoritzat a publicar en aquest contexte",post_permission_not_here:"No estas citant a @ningú",post_permission_not_enough_participants:"Has d'afegir participants",post_permission_missing_displayName:"Has de posar nom al xat",delete_activity_confirmation:"Estàs segur?",delete_activity_delete:"Esborra",delete_activity_cancel:"No ho toquis!",delete_activity_icon:"esborra",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra per activitat favorita",favorites:"Favorits",favorite:"favorit",unfavorite:"treure favorit",like:"m'agrada",unlike:"ja no m'agrada",recent_activity:"Darreres activitats",valued_activity:"Activitats més valorades",flagged_activity:"Activitats destacades",recent_favorited_activity:"Darreres favorites",valued_favorited_activity:"Favorites més valorades",open_profile:"Veure el perfil"}};return t[e]},max||{});function MaxClient(){this.ROUTES={users:"/people",user:"/people/{0}",avatar:"/people/{0}/avatar",user_activities:"/people/{0}/activities",timeline:"/people/{0}/timeline",user_comments:"/people/{0}/comments",user_shares:"/people/{0}/shares",user_likes:"/people/{0}/likes",follows:"/people/{0}/follows",follow:"/people/{0}/follows/{1}",subscriptions:"/people/{0}/subscriptions",activities:"/contexts/{0}/activities",activity:"/activities/{0}",comments:"/activities/{0}/comments",comment:"/activities/{0}/comments/{1}",likes:"/activities/{0}/likes",like:"/activities/{0}/likes/{1}",flag:"/activities/{0}/flag",favorites:"/activities/{0}/favorites",favorite:"/activities/{0}/favorites/{1}",shares:"/activities/{0}/shares",share:"/activities/{0}/shares/{1}",conversations:"/conversations",conversation:"/conversations/{0}",conversation_owner:"/conversations/{0}/owner",user_conversation:"/people/{0}/conversations/{1}",messages:"/conversations/{0}/messages",context:"/contexts/{0}"}}max.utils=function(){var l={};return{setSettings:function(e){l=e},freezeEvent:function(e){return e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},normalizeWhiteSpace:function(e,t){return e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),e=!0===(1<arguments.length?t:!0)?e.replace(/[ ]{2,}/gi," "):e},formatText:function(e){return e=e&&(e=(e=e.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(e){var t=e;return'<a href="'+(t=t.match("^https?://")?t:"http://"+t)+'">'+e+"</a>"})).replace(/(\s|^)#{1}(\w+)/gi,function(){var e=arguments[1],t=arguments[2];return'<a class="maxui-hashtag" href="#" value="'+t+'">'+e+"#"+t+"</a>"})).replace(/\r?\n/gi,"<br/>")},isCORSCapable:function(){return void 0!==(new XMLHttpRequest).withCredentials},removeValueFrom:function(e){for(var t,i,a=arguments,n=a.length;1<n&&e.length;)for(t=a[--n];-1!==(i=e.indexOf(t));)e.splice(i,1);return e},timestamp:function(){return+new Date},now:function(){return new Date},rfc3339:function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},formatDate:function(e,t){var i=new Date,a="",n="",s=new Date,o=e.match("^([-+]?)(\\d{4,})(?:-?(\\d{2})(?:-?(\\d{2})(?:[Tt ](\\d{2})(?::?(\\d{2})(?::?(\\d{2})(?:\\.(\\d{1,3})(?:\\d+)?)?)?)?(?:[Zz]|(?:([-+])(\\d{2})(?::?(\\d{2}))?)?)?)?)?)?$");if(o){for(var r=[2,3,4,5,6,7,8,10,11],c=r.length-1;0<=c;--c)o[r[c]]=void 0!==o[r[c]]&&0<o[r[c]].length?parseInt(o[r[c]],10):0;"-"===o[1]&&(o[2]*=-1);e=Date.UTC(o[2],o[3]-1,o[4],o[5],o[6],o[7],o[8]);void 0!==o[9]&&0<o[9].length&&(e+=("+"===o[9]?-1:1)*(3600*o[10]*1e3+60*o[11]*1e3)),0<=o[2]&&o[2]<=99&&(e-=59958144e6);return s.setTime(e),i.getTime()-e<2592e5?a=jQuery.easydate.format_date(s,t):("en"===t?a="{0} {1}".format(o[4],l.literals.months[o[3]-1]):"es"===t?a="{0} de {1}".format(o[4],l.literals.months[o[3]-1]):"ca"===t&&(n="de ",4!==o[3]&&8!==o[3]&&10!==o[3]||(n="d'"),a="{0} {2}{1}".format(o[4],l.literals.months[o[3]-1],n)),31536e6<i.getTime()-e&&(a="{0}/{1}/{2}".format(o[4],o[3],o[2]))),a}return null},utf8_decode:function(e){var t,i,a=[],n=0,s=0,o=0;for(e+="";n<e.length;)(t=e.charCodeAt(n))<128?(a[s++]=String.fromCharCode(t),n++):191<t&&t<224?(o=e.charCodeAt(n+1),a[s++]=String.fromCharCode((31&t)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),i=e.charCodeAt(n+2),a[s++]=String.fromCharCode((15&t)<<12|(63&o)<<6|63&i),n+=3);return a.join("")},sha1:function(e){function t(e,t){return e<<t|e>>>32-t}function i(e){for(var t="",i=7;0<=i;i--)t+=(e>>>4*i&15).toString(16);return t}for(var a,n,s,o,r,c,l,u,m=new Array(80),d=1732584193,p=4023233417,v=2562383102,f=271733878,h=3285377520,g=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var a=e.charCodeAt(i);a<128?t+=String.fromCharCode(a):t=127<a&&a<2048?(t+=String.fromCharCode(a>>6|192))+String.fromCharCode(63&a|128):(t=(t+=String.fromCharCode(a>>12|224))+String.fromCharCode(a>>6&63|128))+String.fromCharCode(63&a|128)}return t}(e)).length,x=[],y=0;y<g-3;y+=4)n=e.charCodeAt(y)<<24|e.charCodeAt(y+1)<<16|e.charCodeAt(y+2)<<8|e.charCodeAt(y+3),x.push(n);switch(g%4){case 0:y=2147483648;break;case 1:y=e.charCodeAt(g-1)<<24|8388608;break;case 2:y=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:y=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(x.push(y);x.length%16!=14;)x.push(0);for(x.push(g>>>29),x.push(g<<3&4294967295),a=0;a<x.length;a+=16){for(y=0;y<16;y++)m[y]=x[a+y];for(y=16;y<=79;y++)m[y]=t(m[y-3]^m[y-8]^m[y-14]^m[y-16],1);for(s=d,o=p,r=v,c=f,l=h,y=0;y<=19;y++)u=t(s,5)+(o&r|~o&c)+l+m[y]+1518500249&4294967295,l=c,c=r,r=t(o,30),o=s,s=u;for(y=20;y<=39;y++)u=t(s,5)+(o^r^c)+l+m[y]+1859775393&4294967295,l=c,c=r,r=t(o,30),o=s,s=u;for(y=40;y<=59;y++)u=t(s,5)+(o&r|o&c|r&c)+l+m[y]+2400959708&4294967295,l=c,c=r,r=t(o,30),o=s,s=u;for(y=60;y<=79;y++)u=t(s,5)+(o^r^c)+l+m[y]+3395469782&4294967295,l=c,c=r,r=t(o,30),o=s,s=u;d=d+s&4294967295,p=p+o&4294967295,v=v+r&4294967295,f=f+c&4294967295,h=h+l&4294967295}return(u=i(d)+i(p)+i(v)+i(f)+i(h)).toLowerCase()}}},Object.keys||(Object.keys=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}),String.prototype.format=function(){var t=arguments;return this.replace(/\{\d+\}/g,function(e){return t[e.match(/\d+/)]})},MaxClient.prototype.configure=function(e){this.url=e.server,this.mode=e.mode,this.token=e.token,this.actor={objectType:"person",username:e.username}},MaxClient.prototype.POST=function(e,t,i){var a=this,n="{0}{1}".format(this.url,e),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:n,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",a.token),e.setRequestHeader("X-Oauth-Username",a.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",contentType:"application/json",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.POSTFILE=function(e,t,i){var a=this,n="{0}{1}".format(this.url,e),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:n,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",a.token),e.setRequestHeader("X-Oauth-Username",a.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",processData:!1,contentType:!1,data:t,async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.PUT=function(e,t,i){var a=this,n="{0}{1}".format(this.url,e),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:n,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",a.token),e.setRequestHeader("X-Oauth-Username",a.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","PUT")},contentType:"application/json",type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.DELETE=function(e,t,i){var a=this,n="{0}{1}".format(this.url,e),s=2<arguments.length?i:{};return jQuery.ajax({url:n,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",a.token),e.setRequestHeader("X-Oauth-Username",a.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","DELETE")},type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.GET=function(e,t,a){var i=this,n="{0}{1}".format(this.url,e),s=3<arguments.length?arguments[3]:{},n=(0<Object.keys(t).length&&(n+="?"+jQuery.param(t,!0)),{url:n,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",i.token),e.setRequestHeader("X-Oauth-Username",i.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},processData:!0,type:"GET",async:!0,dataType:"json"});return 3<arguments.length&&_.extend(n,arguments[3]),jQuery.ajax(n).done(function(e,t,i){s.done&&jQuery(window).trigger(s.done),a.apply(i,[e])}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail)}),!0},MaxClient.prototype.getUserData=function(e,t){e=this.ROUTES.user.format(e);this.GET(e,{},t)},MaxClient.prototype.getUsersList=function(e,t){var i=this.ROUTES.users;this.GET(i,{username:e},t)},MaxClient.prototype.getContext=function(e,t){e=this.ROUTES.context.format(e);this.GET(e,{},t)},MaxClient.prototype.getUserTimeline=function(e,t){var i=this.ROUTES.timeline.format(e),a=2<arguments.length?arguments[2]:{};this.GET(i,a,t)},MaxClient.prototype.getActivities=function(e,t){var i=this.ROUTES.activities.format(e.context),a=2<arguments.length?arguments[2]:{};e.tags&&0<e.tags.length&&(a.context_tags=e.tags),this.GET(i,a,t)},MaxClient.prototype.getCommentsForActivity=function(e,t){e=this.ROUTES.comments.format(e);this.GET(e,{},t)},MaxClient.prototype.addComment=function(e,t,i){var a={actor:{},object:{objectType:"comment",content:""}},e=(a.actor=this.actor,a.object.content=e,this.ROUTES.comments.format(t));this.POST(e,a,i)},MaxClient.prototype.addActivity=function(e,t,i,a){var n={},n=void 0===a?{object:{objectType:"note",content:""}}:"image"===a.type.split("/")[0]?{object:{objectType:"image",content:"",mimetype:a.type}}:{object:{objectType:"file",content:"",mimetype:a.type}};if(0<t.length){n.contexts=[];for(var s=0;s<t.length;s++)n.contexts.push({objectType:"context",url:t[s]})}n.object.content=e,3<arguments.length&&(n.generator=a);var o=this.ROUTES.user_activities.format(this.actor.username),r={done:"maxui-posted-activity",fail:"maxui-failed-activity"};if(void 0===a)this.POST(o,n,i,r);else{let e=new FormData;e.append("json_data",JSON.stringify(n)),e.append("file",new Blob([a],{type:a.type}),a.name),this.POSTFILE(o,e,i,r)}},MaxClient.prototype.removeActivity=function(e,t){e=this.ROUTES.activity.format(e);this.DELETE(e,{},t)},MaxClient.prototype.removeActivityComment=function(e,t,i){e=this.ROUTES.comment.format(e,t);this.DELETE(e,{},i)},MaxClient.prototype.getConversationSubscription=function(e,t,i){t=this.ROUTES.user_conversation.format(t,e);this.GET(t,{},i)},MaxClient.prototype.getConversation=function(e,t){e=this.ROUTES.conversation.format(e);this.GET(e,{},t)},MaxClient.prototype.modifyConversation=function(e,t,i){t={displayName:t},e=this.ROUTES.conversation.format(e);this.PUT(e,t,i)},MaxClient.prototype.addUserToConversation=function(e,t,i){t=this.ROUTES.user_conversation.format(t,e);this.POST(t,{},i)},MaxClient.prototype.kickUserFromConversation=function(e,t,i){t=this.ROUTES.user_conversation.format(t,e);this.DELETE(t,{},i)},MaxClient.prototype.deleteConversation=function(e,t){e=this.ROUTES.conversation.format(e);this.DELETE(e,{},t)},MaxClient.prototype.leaveConversation=function(e,t,i){t=this.ROUTES.user_conversation.format(t,e);this.DELETE(t,{},i)},MaxClient.prototype.transferConversationOwnership=function(e,t,i){t={actor:{username:t}},e=this.ROUTES.conversation_owner.format(e);this.PUT(e,t,i)},MaxClient.prototype.getConversationsForUser=function(e,t){var i=this.ROUTES.conversations;this.GET(i,{},t)},MaxClient.prototype.getMessageImage=function(e,t){this.GET(e,{},t,{processData:!1,dataType:void 0,contentType:"application/base64"})},MaxClient.prototype.getMessagesForConversation=function(e,t,i){e=this.ROUTES.messages.format(e);this.GET(e,t,i)},MaxClient.prototype.addMessageAndConversation=function(e,t){var i={object:{objectType:"note",content:e.message},contexts:[{objectType:"conversation",participants:e.participants}]},e=(e.displayName&&(i.contexts[0].displayName=e.displayName),this.ROUTES.conversations);this.POST(e,i,t)},MaxClient.prototype.addMessage=function(e,t,i){var a={},e=((a={object:{objectType:"note",content:""}}).object.content=e,this.ROUTES.messages.format(t));this.POST(e,a,i)},MaxClient.prototype.follow=function(e,t){var i={object:{objectType:"person",username:""}},e=(i.object.username=e,this.ROUTES.follow.format(this.actor.username,e));this.POST(e,i,t)},MaxClient.prototype.favoriteActivity=function(e,t){e=this.ROUTES.favorites.format(e);this.POST(e,{},t)},MaxClient.prototype.unfavoriteActivity=function(e,t){e=this.ROUTES.favorite.format(e,this.actor.username);this.DELETE(e,{},t)},MaxClient.prototype.likeActivity=function(e,t){e=this.ROUTES.likes.format(e);this.POST(e,{},t)},MaxClient.prototype.unlikeActivity=function(e,t){e=this.ROUTES.like.format(e,this.actor.username);this.DELETE(e,{},t)},MaxClient.prototype.flagActivity=function(e,t){e=this.ROUTES.flag.format(e);this.POST(e,{},t)},MaxClient.prototype.unflagActivity=function(e,t){e=this.ROUTES.flag.format(e);this.DELETE(e,{},t)},!function(w){w.fn.maxUI=function(e){var f=this,t=(f.version="5.1.6",f.templates=max.templates(),f.utils=max.utils(),{maxRequestsAPI:"jquery",maxServerURL:"https://max.upc.edu",readContext:void 0,writeContexts:[],activitySource:"timeline",enableAlerts:!1,UISection:"timeline",disableTimeline:!1,disableConversations:!0,conversationsSection:"conversations",currentConversationSection:"conversations",activitySortOrder:"comments",activitySortView:"recent",maximumConversations:20,contextTagsFilter:[],scrollbarWidth:10,widgetWidth:"0",sectionHorizontalPadding:20,widgetBorder:2,loglevel:"info",hidePostboxOnTimeline:!1,maxTalkURL:"",generator:"",domain:"",showSubscriptionList:!1,showLikes:!0}),t=(f.settings=w.extend(t,e),f.logger=new max.MaxLogging(f),f.logger.setLevel(f.settings.loglevel),f.utils.isCORSCapable()||f.settings.maxServerURLAlias&&(f.settings.maxServerURL=f.settings.maxServerURLAlias),f.settings.maxTalkURL=f.utils.normalizeWhiteSpace(f.settings.maxTalkURL),!_.isUndefined(f.settings.maxTalkURL)&&""!==f.settings.maxTalkURL||(t=f.settings.maxServerURL,f.settings.maxTalkURL=t.replace("http","ws")+"/ws"),f.settings.domain=f.utils.normalizeWhiteSpace(f.settings.domain),"none"===f.settings.domain.toLowerCase()&&(f.settings.domain=""),"timeline"===f.settings.UISection&&"timeline"===f.settings.activitySource&&f.settings.readContext&&(f.settings.readContext=void 0,f.settings.writeContexts=[]),f.settings.showSubscriptionList&&"activities"===f.settings.activitySource&&(f.settings.showSubscriptionList=!1),f.language=e.language||"en",e.literals||{});if(f.settings.literals=w.extend(max.literals(f.language),t),f.settings.readContext){f.settings.readContextHash=f.utils.sha1(f.settings.readContext),f.settings.writeContexts.push(f.settings.readContext),f.settings.writeContextsHashes=[];for(var i=0;i<f.settings.writeContexts.length;i++)f.settings.writeContextsHashes.push(f.utils.sha1(f.settings.writeContexts[i]))}f.settings.avatarURLpattern||(f.settings.avatarURLpattern=f.settings.maxServerURL+"/people/{0}/avatar"),f.settings.contextAvatarURLpattern||(f.settings.contextAvatarURLpattern=f.settings.maxServerURL+"/contexts/{0}/avatar"),f.settings.conversationAvatarURLpattern||(f.settings.conversationAvatarURLpattern=f.settings.maxServerURL+"/conversations/{0}/avatar"),f.settings.enableAlerts&&w(window).bind("maxclienterror",function(e,t){t=JSON.parse(t.responseText);alert('The server responded with a "{0}" error, with the following message: "{1}". \n\nPlease try again later or contact administrator at admin@max.upc.edu.'.format(t.error,t.error_description))}),f.maxClient=new MaxClient;e={server:f.settings.maxServerURL,mode:f.settings.maxRequestsAPI,username:f.settings.username,token:f.settings.oAuthToken};return f.maxClient.configure(e),f.messaging=new max.MaxMessaging(f),f.conversations=new max.views.MaxConversations(f,{}),f.settings.disableConversations||(f.messaging.bind({action:"add",object:"message"},function(e){f.conversations.ReceiveMessage(e)}),f.messaging.bind({action:"add",object:"conversation"},function(e){f.conversations.ReceiveConversation(e)}),f.messaging.bind({action:"refresh",object:"conversation"},function(e){f.conversations.messagesview.load(e.destination)}),f.messaging.bind({action:"ack",object:"message"},function(e){f.conversations.messagesview.ack(e)})),f.utils.setSettings(f.settings),w.fn.hidePostbox=function(){var e,t=this;if("timeline"===t.settings.activitySource&&0<t.settings.subscriptionsWrite.length)return t.settings.hidePostboxOnTimeline;for(e in t.settings.subscriptionsWrite)if(t.settings.subscriptionsWrite[e].hash===t.settings.readContext)return t.settings.hidePostboxOnTimeline;return!0},this.maxClient.getUserData(f.settings.username,function(e){f.settings.displayName=e.displayName||f.settings.username;var t={},i=[];if(e.subscribedTo&&e.subscribedTo&&0<e.subscribedTo.length)for(var a=0;a<e.subscribedTo.length;a++){var n=e.subscribedTo[a];t[n.hash]={},t[n.hash].permissions={};for(var s=0;s<n.permissions.length;s++){var o=n.permissions[s];t[n.hash].permissions[o]=!0,"write"===o&&i.push({hash:n.url,displayname:n.displayName})}}f.settings.subscriptionsWrite=i,f.settings.subscriptions=t,"timeline"===f.settings.activitySource&&0<i.length&&f.settings.writeContexts.push(i[0].hash),f.settings.disableConversations||(f.messaging.start(),w(window).on("beforeunload",function(e){return f.messaging.disconnect()}));var r="conversations"===f.settings.UISection,c="timeline"===f.settings.UISection,l=!1===f.settings.disableTimeline&&!c,u=!1===f.settings.disableConversations&&!r,m=(1===w("#menusup").length?w("#menusup"):f).width()-f.settings.scrollbarWidth-30,d="recent"===f.settings.activitySortView,p="likes"===f.settings.activitySortView,v="flagged"===f.settings.activitySortView,r={username:f.settings.username,literals:f.settings.literals,showMaxUIClass:r?"maxui-container-chat":"maxui-container-activity",showConversations:r?"display:block;":"display:none;",showConversationsToggle:u?"display:block;":"display:none;",showTimeline:c?"display:block;":"display:none;",showTimelineToggle:l?"display:block;":"display:none;",orderViewRecent:d?"active":"",orderViewLikes:p?"active":"",orderViewFlagged:v?"active":"",messagesStyle:"width:{0}px;left:{0}px;".format(m),hidePostbox:f.hidePostbox()},u=f.templates.mainUI.render(r);f.html(u),f.overlay=new max.views.MaxOverlay(f),f.settings.widgetWidth=1===w("#menusup").length?w("#menusup").width()-30:f.width(),f.settings.sectionsWidth=f.settings.widgetWidth-f.settings.scrollbarWidth-f.settings.widgetBorder,f.settings.disableConversations||(f.conversations.render(),f.conversations.listview.load(e.talkingIn)),"conversations"===f.settings.UISection?(f.bindEvents(),f.toggleSection("conversations"),f.renderPostbox(),c=f.settings.literals.new_conversation_text,w("#maxui-newactivity-box textarea").val(c).attr("data-literal",c)):"timeline"===f.settings.UISection&&(l={recent:f.settings.activitySortOrder,likes:"likes",flagged:"flagged"},f.printActivities({sortBy:l[f.settings.activitySortView]},function(e){f.bindEvents()}))}),f},w.fn.bindEvents=function(){var m=this,e=(w("#maxui-more-activities .maxui-button").click(function(e){e.preventDefault(),m.loadMoreActivities()}),w("#maxui-news-activities .maxui-button").click(function(e){m.loadNewsActivities()}),w("#maxui-search-toggle").click(function(e){e.preventDefault(),w(this).hasClass("maxui-disabled")||(w("#maxui-search").toggleClass("folded"),w("#maxui-search").hasClass("folded")?m.printActivities({}):m.reloadFilters())}),w("#maxui-activities").on("click",".maxui-commentaction",function(e){e.preventDefault(),window.status="",w(this).closest(".maxui-activity").find(".maxui-comments").toggle(200)}),w("#maxui-activities").on("click",".maxui-filter-actor",function(e){e.preventDefault();e=w(this).parent().find(".maxui-username").text();m.addFilter({type:"actor",value:e}),w("#maxui-search").toggleClass("folded",!1)}),w("#maxui-search").on("click","#maxui-favorites-filter",function(e){e.preventDefault();var e=w(e.currentTarget),t=!e.hasClass("active"),i="",a="",a=t?(m.addFilter({type:"favorites",value:!0,visible:!1}),i=m.settings.literals.valued_favorited_activity,m.settings.literals.recent_favorited_activity):(m.delFilter({type:"favorites",value:!0}),i=m.settings.literals.valued_activity,m.settings.literals.recent_activity);e.toggleClass("active",t),w("#maxui-activity-sort .maxui-most-recent").text(a),w("#maxui-activity-sort .maxui-most-valued").text(i)}),w("#maxui-activities").on("click",".maxui-hashtag",function(e){e.preventDefault(),m.addFilter({type:"hashtag",value:w(this).attr("value")}),w("#maxui-search").toggleClass("folded",!1)}),w("#maxui-search-filters").on("click",".maxui-close",function(e){e.preventDefault();e=w(this.parentNode.parentNode);m.delFilter({type:e.attr("type"),value:e.attr("value")})}),w("#maxui-new-participants").on("click",".maxui-close",function(e){e.preventDefault();e=w(this.parentNode.parentNode);m.delPerson({username:e.attr("username")})}),w("#maxui-new-displayName").on("keyup","input",function(e){e.preventDefault(),m.reloadPersons()}),w("#maxui-newactivity").on("click",".maxui-prediction",function(e){e.preventDefault();var e=w(this),t=w("#maxui-newactivity-box textarea"),i=w("#maxui-newactivity #maxui-predictive"),a=t.val(),n=new RegExp("^\\s*@([\\w\\.]+)"),a=a.replace(n,"@"+e.text()+" ");i.hide(),t.val(a),t.focus()}),w(document).on("click",function(e){w(".maxui-predictive").hide()}),w("#maxui-conversation-predictive").on("click",".maxui-prediction",function(e){e.preventDefault();var e=w(this),t=w("#maxui-add-people-box .maxui-text-input"),i=w("#maxui-conversation-predictive"),a=e.attr("data-username"),e=e.attr("data-displayname");m.addPerson({username:a,displayName:e}),i.hide(),t.val("").focus()}),w("#maxui-show-conversations").on("click",function(e){e.preventDefault(),window.status="",m.toggleSection("conversations"),w("#maxui-newactivity-box > .upload-file").hide(),w("#maxui-newactivity-box > .upload-img").hide(),w("#maxui-newactivity-box > #preview").hide()}),w("#maxui-show-timeline").on("click",function(e){e.preventDefault(),window.status="",m.printActivities({},function(e){m.toggleSection("timeline")})}),w("#maxui-activities").on("click",".maxui-action.maxui-favorites",function(e){e.preventDefault();var t=w(this),e=w(this).closest(".maxui-activity").attr("id");t.hasClass("maxui-favorited")?m.maxClient.unfavoriteActivity(e,function(e){t.toggleClass("maxui-favorited",!1)}):m.maxClient.favoriteActivity(e,function(e){t.toggleClass("maxui-favorited",!0)})}),w("#maxui-activities").on("click",".maxui-action.maxui-likes",function(e){e.preventDefault();var t=w(this),e=w(this).closest(".maxui-activity").attr("id"),i=t.hasClass("maxui-liked"),a=t.children("strong"),n=[];t.attr("title")&&""!==t.attr("title")&&(n=t.attr("title").split("\n")),i?(m.maxClient.unlikeActivity(e,function(e){t.toggleClass("maxui-liked",!1)}),a.text(parseInt(a.text(),10)-1),n=w.grep(n,function(e){return e!==m.settings.username})):(m.maxClient.likeActivity(e,function(e){t.toggleClass("maxui-liked",!0)}),a.text(parseInt(a.text(),10)+1),n.push(m.settings.username)),m.settings.showLikes&&t.attr("title",n.join("\n"))}),w("#maxui-activities").on("click",".maxui-action.maxui-flag",function(e){e.preventDefault();var t=w(this),i=w(this).closest(".maxui-activity"),e=i.attr("id");t.hasClass("maxui-flagged")?m.maxClient.unflagActivity(e,function(e){t.toggleClass("maxui-flagged",!1),i.toggleClass("maxui-flagged",!1),m.printActivities({})}):m.maxClient.flagActivity(e,function(e){t.toggleClass("maxui-flagged",!0),i.toggleClass("maxui-flagged",!1),m.printActivities({})})}),w("#maxui-activities").on("click",".maxui-action.maxui-delete",function(e){e.preventDefault();e=w(this).closest(".maxui-activity").find(".maxui-actions > .maxui-popover");e.is(":visible")?(e.animate({opacity:0},300),w(".maxui-popover").css({opacity:0}).hide()):(w(".maxui-popover").css({opacity:0}).hide(),e.show(),e.animate({opacity:1},300))}),w("#maxui-activities").on("click",".maxui-actions .maxui-button-cancel",function(e){e.preventDefault(),w(".maxui-popover:visible").css({opacity:0}).hide()}),w("#maxui-activities").on("click",".maxui-actions .maxui-button-delete",function(e){e.preventDefault();var i=w(this).closest(".maxui-activity"),e=i.attr("id");m.maxClient.removeActivity(e,function(e){var t=w(".maxui-popover:visible").animate({opacity:0},300);i.css({height:i.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(e){i.remove(),t.hide()})})}),w("#maxui-activities").on("click",".maxui-delete-comment",function(e){e.preventDefault();e=w(this).closest(".maxui-comment").find(".maxui-popover");e.is(":visible")?(e.animate({opacity:0},300),w(".maxui-popover").css({opacity:0}).hide()):(w(".maxui-popover").css({opacity:0}).hide(),e.show(),e.animate({opacity:1},300))}),w("#maxui-activities").on("click",".maxui-comment .maxui-button-cancel",function(e){e.preventDefault(),w(".maxui-popover").css({opacity:0}).hide()}),w("#maxui-activities").on("click",".maxui-comment .maxui-button-delete",function(e){e.preventDefault();var i=w(this).closest(".maxui-comment"),a=i.closest(".maxui-activity"),e=a.attr("id"),t=i.attr("id");m.maxClient.removeActivityComment(e,t,function(){var t=w(".maxui-popover").animate({opacity:0},300);i.css({height:a.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(e){i.remove(),t.hide()})})}),w("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-recent",function(e){e.preventDefault();e=w(this);e.hasClass("active")||(w("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),e.toggleClass("active",!0),m.printActivities({}))}),w("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-valued",function(e){e.preventDefault();e=w(this);e.hasClass("active")||(w("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),e.toggleClass("active",!0),m.printActivities({sortBy:"likes"}))}),w("#maxui-activity-sort").on("click","a.maxui-sort-action.maxui-flagged",function(e){e.preventDefault();e=w(this);e.hasClass("active")||(w("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),e.toggleClass("active",!0),m.printActivities({sortBy:"flagged"}))}),".maxui-text-input");w("#maxui-add-people-box").on("focusin",e,function(e){e.preventDefault();var e=w(this).val(),t=w(this).attr("data-literal");m.utils.normalizeWhiteSpace(e,!1)===t&&w(this).val("")}).on("keydown",e,function(e){0<w("#maxui-conversation-predictive:visible").length&&(40===e.which||38===e.which||13===e.which||9===e.which)&&m.utils.freezeEvent(e)}).on("keyup",e,function(e){e.preventDefault(),e.stopPropagation();var t,i=w(this).val(),e=(""===m.utils.normalizeWhiteSpace(i,!1)?(w(this).attr("class","maxui-empty maxui-text-input"),w(this).removeAttr("title")):m.settings.canwrite&&w(this).attr("class","maxui-text-input"),e.which),a=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*"),a=i.match(a),n=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*$"),n=i.match(n),s=w("#maxui-conversation-predictive .maxui-prediction.selected"),o=w(this),r=w("#maxui-conversation-predictive"),c=r.find(".maxui-prediction").length,l=0<w("#maxui-conversation-predictive:visible").length;40===e&&l&&1<c?(t=s.next(),s.removeClass("selected"),(0<t.length?t:s.siblings(":first")).addClass("selected")):38===e&&l&&1<c?(t=s.prev(),s.removeClass("selected"),(0<t.length?t:s.siblings(":last")).addClass("selected")):27===e?r.hide():13!==e&&9!==e||!l?"conversations"===m.settings.conversationsSection&&(a?(o.attr("class","maxui-text-input"),n&&(r.show(),r.html("<ul></ul>"),m.printPredictions(a[1],"#maxui-conversation-predictive"))):(r.hide(),o.attr("class","maxui-empty maxui-text-input"),i.match(new RegExp("^\\s*@"))||(o.attr("class","maxui-text-input error"),o.attr("title",m.settings.literals.post_permission_not_here)))):(c=s.attr("data-username"),t=s.attr("data-displayname"),m.addPerson({username:c,displayName:t}),r.hide(),o.val("").focus())}).on("focusout",e,function(e){e.preventDefault();var e=w(this).val(),t=w(this).attr("data-literal");""===m.utils.normalizeWhiteSpace(e,!1)&&w(this).val(t)}),m.bindActionBehaviour("#maxui-newactivity","#maxui-newactivity-box",{},function(e,t){if("timeline"===m.settings.UISection)m.sendActivity(e,t),w("#maxui-search").toggleClass("folded",!0);else if("conversations"===m.settings.UISection)if("conversations"===m.settings.conversationsSection){for(var i=w("#maxui-new-participants")[0],a=[],n=0;n<i.people.length;n++)a.push(i.people[n].username);var s,o={participants:a,message:w("#maxui-newactivity textarea").val()};1<a.length&&(s=w("#maxui-add-people-box #maxui-new-displayName input").val(),o.displayName=s),m.conversations.create(o)}else m.conversations.send(e,t)},function(e,t,i,a){var n,a=a.which,s=new RegExp("^\\s*@([\\w\\.]+)\\s*"),s=e.match(s),o=new RegExp("^\\s*@([\\w\\.]+)\\s*$"),o=e.match(o),r=w("#maxui-newactivity .maxui-prediction.selected"),t=w(t),c=w("#maxui-newactivity #maxui-predictive"),l=c.find(".maxui-prediction").length,u=0<w("#maxui-newactivity #maxui-predictive:visible").length;40===a&&u&&1<l?(n=r.next(),r.removeClass("selected"),(0<n.length?n:r.siblings(":first")).addClass("selected")):38===a&&u&&1<l?(n=r.prev(),r.removeClass("selected"),(0<n.length?n:r.siblings(":last")).addClass("selected")):27===a?c.hide():13!==a&&9!==a||!u?""===e?"timeline"===m.settings.UISection&&w(i).val(m.settings.literals.new_activity_post):"timeline"===m.settings.UISection?s?(w(i).val(m.settings.literals.new_message_post),o&&(c.show(),c.html("<ul></ul>"),m.printPredictions(s[1],"#maxui-newactivity #maxui-predictive")),w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),t.attr("class","maxui-text-input")):(w(i).val(m.settings.literals.new_activity_post),c.hide(),e.match(new RegExp("^\\s*@"))||m.settings.canwrite||(t.attr("class","maxui-text-input error"),t.attr("title",m.settings.literals.post_permission_unauthorized))):"conversations"===m.settings.UISection&&("conversations"===m.settings.conversationsSection?m.reloadPersons():"messages"===m.settings.conversationsSection&&(c.hide(),w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),t.attr("class","maxui-text-input"))):(l=new RegExp("^\\s*@([\\w\\.]+)"),n=e.replace(l,"@"+r.text()+" "),c.hide(),t.val(n).focus())}),m.bindActionBehaviour("#maxui-activities",".maxui-newcommentbox",{},function(e){var t=w(this).closest(".maxui-activity").attr("id");m.maxClient.addComment(e,t,function(){w("#activityContainer textarea").val("");var e=this.object.inReplyTo[0].id;m.printCommentsForActivity(e),w("#"+e+" .maxui-newcommentbox textarea").val(""),w("#"+e+" .maxui-newcommentbox .maxui-button").attr("disabled","disabled")})}),m.bindActionBehaviour("#maxui-search","#maxui-search-box",{},function(e){m.textSearch(e),w("#maxui-search").toggleClass("folded",!1),w("#maxui-search-text").val("")})},w.fn.bindActionBehaviour=function(a,e,n,s){var o=this,t=e+" .maxui-text-input",r=4<arguments.length?arguments[4]:null;w(a).on("focusin",t,function(e){e.preventDefault();var e=w(this).val(),t=w(this).attr("data-literal");o.utils.normalizeWhiteSpace(e,!1)===t&&w(this).val("")}).on("keydown",t,function(e){var t,i;0<w(a+" #maxui-predictive:visible").length&&(40===e.which||38===e.which||13===e.which||9===e.which)?o.utils.freezeEvent(e):13!==e.which||!1!==e.shiftKey||n.ignore_button||w(this).is("textarea")||(e.preventDefault(),t=(e=w(this).parent().find(".maxui-text-input")).attr("data-literal"),e=e.val(),(i=o.utils.normalizeWhiteSpace(e,!1))!==t&""!==i&&s.apply(this,[e]))}).on("keyup",t,function(e){e.preventDefault(),e.stopPropagation();var t=w(this).val(),i=w(this).parent().parent().find(".maxui-button");""!==o.utils.normalizeWhiteSpace(t,!1)||n.ignore_button?o.settings.canwrite&&!n.ignore_button&&(w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),w(this).attr("class","maxui-text-input")):(w(i).attr("disabled","disabled"),w(i).attr("class","maxui-button maxui-disabled"),w(this).attr("class","maxui-empty maxui-text-input"),w(this).removeAttr("title")),null!==r&&r(t,this,i,e)}).on("paste",t,function(e){var t=w(this).parent().parent().find(".maxui-button"),i=(o.settings.canwrite&&!n.ignore_button&&(w(t).removeAttr("disabled"),w(t).attr("class","maxui-button"),w(this).attr("class","maxui-text-input")),w(this).val());null!==r&&r(i,this,t,e)}).on("focusout",t,function(e){e.preventDefault();var e=w(this).val(),t=w(this).attr("data-literal");""===o.utils.normalizeWhiteSpace(e,!1)&&w(this).val(t)}).on("click",e+" .maxui-button",function(e){e.preventDefault(),e=void 0;var t=document.getElementById("maxui-file").files[0],t=(void 0!==t?e=t:void 0!==(t=document.getElementById("maxui-img").files[0])&&(e=t),w(this).parent().find(".maxui-text-input")),i=t.attr("data-literal"),t=t.val(),a=o.utils.normalizeWhiteSpace(t,!1);(a!==i&""!==a||n.empty_click||e)&&(s.apply(this,[t,e]),w("#maxui-file").value="",w("#maxui-img").value="",w("#maxui-newactivity-box > .upload-img").removeClass("label-disabled"),w("#maxui-img").prop("disabled",!1),w("#maxui-newactivity-box > .upload-file").removeClass("label-disabled"),w("#maxui-file").prop("disabled",!1))})},w.fn.textSearch=function(e){for(var t=this.utils.normalizeWhiteSpace(e).split(" "),i=0;i<t.length;i++){var a="keyword",n=t[i];switch(n[0]){case"#":a="hashtag",n=n.substr(1);break;case"@":a="actor",n=n.substr(1);break;default:a="keyword"}3<=n.length&&this.addFilter({type:a,value:n},!1)}this.reloadFilters()},w.fn.getFilters=function(){for(var e={filters:this.filters},t=(void 0===e.filters&&(e.filters=[]),{}),i=!1,a=0;a<e.filters.length;a++){var n=e.filters[a];n.visible&&(i=!0),t[n.type]||(t[n.type]=[]),t[n.type].push(n.value)}return 0<arguments.length&&(t.before=arguments[0]),{filters:t,visible:i}},w.fn.reloadFilters=function(){var e=this,t={filters:e.filters},t=e.templates.filters.render(t);w("#maxui-search-filters").html(t),t=0<arguments.length?e.getFilters(arguments[0]):e.getFilters(),e.printActivities({}),w("#maxui-search").toggleClass("folded",!t.visible)},w.fn.delFilter=function(e){for(var t=!1,i=0;i<this.filters.length;i++)this.filters[i].value===e.value&this.filters[i].type===e.type&&(t=!0,this.filters.splice(i,1));t&&this.reloadFilters()},w.fn.addFilter=function(e){var t=this,i=1<arguments.length?arguments[1]:!0;switch(t.filters||(t.filters=[]),e.hasOwnProperty("visible")||(e.visible=!0),e.type){case"hashtag":e.prepend="#";break;case"actor":e.prepend="@";break;default:e.prepend=""}for(var a=!1,n=0;n<t.filters.length;n++)t.filters[n].value===e.value&t.filters[n].type===e.type&&(a=!0);a||(t.filters.push(e),!0===i&&this.reloadFilters())},w.fn.reloadPersons=function(){var e=this,t=w("#maxui-new-participants"),i=t[0],a=(i.people||(i.people=[]),w("#maxui-newactivity input.maxui-button")),n=w("#maxui-newactivity"),s=n.find("textarea").val(),o=n.find("textarea").attr("data-literal"),s=e.utils.normalizeWhiteSpace(s),r=w("#maxui-add-people-box #maxui-new-displayName"),c=r.find("input").val(),c=e.utils.normalizeWhiteSpace(c),l={persons:i.people},l=e.templates.participants.render(l);w("#maxui-new-participants").html(l),w("#maxui-add-people-box .maxui-label .maxui-count").text("({0}/{1})".format(i.people.length+1,e.settings.maximumConversations)),0<i.people.length?(1<i.people.length&&!(""!==c)?(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),""===c&&(n.find("textarea").attr("class","maxui-text-input error"),n.find(".maxui-error-box").text(e.settings.literals.post_permission_missing_displayName),n.find(".maxui-error-box").width(n.find("textarea").width()-4),n.find(".maxui-error-box").animate({bottom:-25},200))):(a.removeAttr("disabled"),a.attr("class","maxui-button"),n.find("textarea").attr("class","maxui-text-input"),n.find(".maxui-error-box").width(n.find("textarea").width()-4),n.find(".maxui-error-box").animate({bottom:0},200)),t.show(),n.show(),1<i.people.length?r.show():(r.hide(),r.find(".maxui-text-input").val(""))):""!==s&&s!==o&&(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),t.hide(),n.find("textarea").attr("class","maxui-text-input error"),n.find(".maxui-error-box").text(e.settings.literals.post_permission_not_enough_participants),n.find(".maxui-error-box").width(n.find("textarea").width()-4),n.find(".maxui-error-box").animate({bottom:-25},200),r.hide(),r.find(".maxui-text-input").val(""))},w.fn.delPerson=function(e){for(var t=!1,i=w("#maxui-new-participants")[0],a=0;a<i.people.length;a++)i.people[a].username===e.username&&(t=!0,i.people.splice(a,1));t&&this.reloadPersons()},w.fn.addPerson=function(e){var t=w("#maxui-new-participants")[0],i=!0,a=(1<arguments.length&&(i=arguments[1]),!1);if(t.people||(t.people=[]),e.username!==this.settings.username&&t.people.length<this.settings.maximumConversations-1){for(var n=0;n<t.people.length;n++)t.people[n].username===e.username&&(a=!0);a||(t.people.push(e),!0===i&&this.reloadPersons())}},w.fn.toggleSection=function(e){var t,i=this,a=w("#maxui-search"),n=w("#maxui-activity-sort"),s=w("#maxui-timeline"),o=w("#maxui-timeline .maxui-wrapper"),r=w("#maxui-conversations"),c=w("#maxui-common-header"),l=r.find("input#add-user-input"),u=w("#maxui-conversations #maxui-conversations-list"),m=w("#maxui-conversations .maxui-wrapper"),d=w("#maxui-newactivity-box .maxui-button"),p=w("#maxui-newactivity-box #maxui-subscriptions"),v=w("#maxui-newactivity"),f=w("#maxui-newactivity-box textarea"),h=w("#maxui-show-conversations"),g=w("#maxui-show-timeline"),x=w("#maxui-add-people-box"),y=(1===w("#menusup").length?w("#menusup").width()-30:i.width())-i.conversations.scrollbar.width-20-2;"conversations"===e&&"conversations"===i.settings.currentConversationSection&&(p.attr("style","display:none;"),r.show(),c.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),x.show(),l.focus(),r.animate({height:320},400,function(e){m.height(320)}),u.width(y),s.animate({height:0},400),a.hide(400),n.hide(400),i.settings.UISection="conversations",d.val(i.settings.literals.new_message_post),t=i.settings.literals.new_conversation_text,f.val(t).attr("data-literal",t),h.hide(),i.settings.disableTimeline||g.show(),i.conversations.scrollbar.setHeight(245),i.conversations.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),v.show()),"timeline"===e&&(!0===i.settings.showSubscriptionList&&p.attr("style","display:inline;"),i.conversations.listview.toggle(),s.show(),c=o.height(),s.animate({height:c},400,function(e){s.css("height","")}),r.animate({height:0},400,function(e){r.hide(),x.hide()}),a.show(400),n.show(400),i.settings.UISection="timeline",d.val(i.settings.literals.new_activity_post),t=i.settings.literals.new_activity_text,f.val(t).attr("data-literal",t),i.settings.disableConversations||h.show(),g.hide(),i.settings.hidePostboxOnTimeline&&v.hide(),i.hidePostbox()&&v.hide())},w.fn.Settings=function(){return this.settings},w.fn.sendActivity=function(e,t){var i=this,a=((e=w("#maxui-newactivity textarea").val())===w("#maxui-newactivity textarea").attr("data-literal")&&(e=""),[]);w("#maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),w("#maxui-activity-sort .maxui-sort-action.maxui-most-recent").toggleClass("active",!0),a.push(e),a.push(i.settings.writeContexts),a.push(function(){w("#maxui-newactivity textarea").val(""),w("#maxui-newactivity .maxui-button").attr("disabled","disabled");var e=w(".maxui-activity:first");0<e.length?(e={after:e.attr("id")},i.printActivities(e)):i.printActivities({})}),i.settings.generatorName&&a.push(i.settings.generatorName),t&&a.push(t),i.maxClient.addActivity.apply(i.maxClient,a),w("#preview").empty(),w("#maxui-img").val(""),w("#maxui-file").val(""),w("#maxui-subscriptions option:first-child").attr("selected","selected")},w.fn.loadMoreActivities=function(){var e=w(".maxui-activity:last").attr("id"),e={before:e=w("#maxui-activity-sort .maxui-sort-action.maxui-most-recent").hasClass("active")&&0<w("#"+e+" .maxui-comment").length?w("#"+e+" .maxui-comment:last").attr("id"):e};this.printActivities(e)},w.fn.loadNewsActivities=function(){this.printActivities()},w.fn.printPredictions=function(e,t){var i=this,a=[];a.push(e),a.push(function(e){i.formatPredictions(e,t)}),this.maxClient.getUsersList.apply(this.maxClient,a)},w.fn.formatPredictions=function(e,t){for(var i="",a=0;a<e.length;a++){var n,s=e[a];s.username!==this.username&&(n=this.settings.avatarURLpattern.format(s.username),s={username:s.username,displayName:s.displayName,avatarURL:n,cssclass:"maxui-prediction"+(0===a?" selected":"")},i+=this.templates.predictive.render(s))}""===i&&(i="<li>"+this.settings.literals.no_match_found+"</li>"),w(t+" ul").html(i),2<arguments.length&&(0,arguments[2])()},w.fn.canCommentActivity=function(e){for(var t in this.settings.subscriptionsWrite)if(this.settings.subscriptionsWrite[t].hash===e)return!0;return!1},w.fn.formatActivities=function(e,t){for(var a=this,i="",n=[],s=0;s<e.length;s++){var o=e[s],r=null,c=(o.hasOwnProperty("contexts")&&0<o.contexts.length&&(r=o.contexts[0]),null),l=(o.hasOwnProperty("generator")&&o.generator!==a.settings.generatorName&&(c=o.generator),""),u=("person"===o.actor.objectType?l=a.settings.avatarURLpattern.format(o.actor.username):"context"===o.actor.objectType&&(l=a.settings.contextAvatarURLpattern.format(o.actor.hash)),[]),m="";if(o.replies&&0<o.replies.length){for(var d=0;d<o.replies.length;d++){var p=o.replies[d],p={id:p.id,actor:p.actor,date:a.utils.formatDate(p.published,a.language),text:a.utils.formatText(p.content),avatarURL:a.settings.avatarURLpattern.format(p.actor.username),canDeleteComment:p.deletable,literals:a.settings.literals};u.push(p)}m="Comentat "+u[u.length-1].date}_.defaults(o.object,{filename:o.id});var v,f=a.settings.canwrite,h=(o.contexts&&(f=a.canCommentActivity(o.contexts[0].url)),[]);for(v in o.likes)h.push(o.likes[v].username);m={id:o.id,actor:o.actor,auth:{token:a.settings.oAuthToken,username:a.settings.username},literals:a.settings.literals,date:a.utils.formatDate(o.published,a.language),dateLastComment:m,text:a.utils.formatText(o.object.content),replies:u,favorited:o.favorited,likes:o.likesCount||0,showLikesCount:"likes"===a.currentSortOrder,showLikes:a.settings.showLikes,liked:o.liked,likesUsernames:h.join("\n"),flagged:o.flagged,avatarURL:l,maxServerURL:a.settings.maxServerURL,publishedIn:r,canDeleteActivity:o.deletable,canFlagActivity:a.settings.canflag,via:c,fileDownload:"file"===o.object.objectType,filename:o.object.filename,portalURL:window.PORTAL_URL,canViewComments:f||0<o.replies.length,canWriteComment:f},l={comment:a.templates.comment};i+=a.templates.activity.render(m,l),"image"===o.object.objectType&&n.push(o)}if("beggining"===t){w("#maxui-preload .maxui-wrapper").prepend(i);for(var g=w("#maxui-preload .maxui-wrapper .maxui-activity"),x=0,s=0;s<g.length;s++)x+=w(g[s]).height()+18;var y=w("#maxui-preload").height();w("#maxui-preload").height(x-y),w("#maxui-preload").css({"margin-top":-1*(x-y)}),w("#maxui-preload").animate({"margin-top":0},200,function(){w("#maxui-preload .maxui-wrapper").html(""),w("#maxui-activities").prepend(i),1===e.length&&"image"===o.object.objectType&&a.maxClient.getMessageImage("/activities/{0}/image/thumb".format(o.id),function(e){e='<img class="maxui-embedded fullImage" alt="" src="data:image/png;base64,{0}" />'.format(e);w(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(o.id)).after(e),w(".maxui-activity#{0} .maxui-activity-message img.fullImage".format(o.id)).on("click",function(){a.maxClient.getMessageImage(o.object.fullURL,function(e){var t=new Image;t.src="data:image/png;base64,"+e,window.open("").document.write(t.outerHTML)})})}),w("#maxui-preload").height(0)})}else"end"===t?w("#maxui-activities").append(i):w("#maxui-activities").html(i);2<arguments.length&&arguments[2].call(),_.each(n,function(t,e,i){a.maxClient.getMessageImage("/activities/{0}/image/thumb".format(t.id),function(e){e='<img class="maxui-embedded fullImage" alt="" src="data:image/png;base64,{0}" />'.format(e);w(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(t.id)).after(e),w(".maxui-activity#{0} .maxui-activity-message img.fullImage".format(t.id)).on("click",function(){a.maxClient.getMessageImage(t.object.fullURL,function(e){var t=new Image;t.src="data:image/png;base64,"+e,window.open("").document.write(t.outerHTML)})})})})},w.fn.formatComment=function(e,t){for(var i=this,a="",n=0;n<e.length;n++){var s=e[n],s={literals:i.settings.literals,id:s.id,actor:s.actor,date:i.utils.formatDate(s.published,i.language),text:i.utils.formatText(s.content),avatarURL:i.settings.avatarURLpattern.format(s.actor.username),portalURL:window.PORTAL_URL,canDeleteComment:s.deletable};a+=i.templates.comment.render(s)}w(".maxui-activity#"+t+" .maxui-commentsbox").html(a);t=w(".maxui-activity#"+t+" .maxui-commentaction strong");w(t).text(parseInt(w(t).text(),10)+1)},w.fn.renderPostbox=function(){var i=this,e="conversations"===i.settings.UISection,e=!1===i.settings.disableConversations&&!e,e={avatar:i.settings.avatarURLpattern.format(i.settings.username),allowPosting:i.settings.canwrite,buttonLiteral:i.settings.literals.new_activity_post,textLiteral:i.settings.literals.new_activity_text,imgLiteral:i.settings.literals.new_img_post,fileLiteral:i.settings.literals.new_file_post,literals:i.settings.literals,showConversationsToggle:e?"display:block;":"display:none;",showSubscriptionList:i.settings.showSubscriptionList&&0<i.settings.subscriptionsWrite.length,subscriptionList:i.settings.subscriptionsWrite},e=i.templates.postBox.render(e);w("#maxui-newactivity").html(e),i.loadPreviewRender(),w("#maxui-subscriptions").on("change",function(){var e=w("#maxui-subscriptions :selected").val();if("timeline"!==e){i.settings.writeContexts=[],i.settings.writeContextsHashes=[],i.settings.writeContexts.push(e);for(var t=0;t<i.settings.writeContexts.length;t++)i.settings.writeContextsHashes.push(i.utils.sha1(i.settings.writeContexts[t]))}else i.settings.writeContexts=[],i.settings.writeContextsHashes=void 0})},w.fn.loadPreviewRender=function(){var e=w("#maxui-newactivity-box .maxui-file-image");w(e).hasClass("changeLoaded")||(w(e).addClass("changeLoaded"),w(e).on("change",function(e){var t,i;e.preventDefault(),0<e.target.files.length&&(5e7<e.target.files[0].size?(alert("El archivo no debe superar los 50MB"),w("#maxui-img").val(""),w("#maxui-file").val("")):(t=e.target.files[0].name,i=(e.target.files[0].size/1e3).toFixed(1),e=("maxui-img"===e.target.id?'<div class="preview-box"><div class="preview-icon-img"><span class="preview-title">{0}</span><p>{1} KB</p><i class="fa fa-times"></i></div></div>':'<div class="preview-box"><div class="preview-icon-file"><span class="preview-title">{0}</span><p>{1} KB</p><i class="fa fa-times"></i></div></div>').format(t,i),w("#maxui-newactivity-box > .upload-file").addClass("label-disabled"),w("#maxui-file").prop("disabled",!0),w("#maxui-newactivity-box > .upload-img").addClass("label-disabled"),w("#maxui-img").prop("disabled",!0),w("#preview").prepend(e),w("#maxui-newactivity-box .maxui-button").removeClass("maxui-disabled"),w("#maxui-newactivity-box .maxui-button").removeAttr("disabled"),w("#maxui-newactivity-box .fa-times").on("click",function(e){w("#preview").empty(),w("#maxui-img").val(""),w("#maxui-file").val(""),w("#maxui-newactivity-box > .upload-img").removeClass("label-disabled"),w("#maxui-img").prop("disabled",!1),w("#maxui-newactivity-box > .upload-file").removeClass("label-disabled"),w("#maxui-file").prop("disabled",!1);var t=w("#maxui-newactivity .maxui-text-input");""!==t.val()&&t.val()!==t.data("literal")||w("#maxui-newactivity .maxui-button").attr("disabled","disabled")})))}))},w.fn.printActivities=function(e){var t,s,o=this,i=[],r="replace",a=o.getFilters().filters,n=(w.extend(a,e),a.before&&(r="end"),a.after&&(r="beggining"),a.sortBy||(w("#maxui-activity-sort .maxui-sort-action.maxui-most-valued").hasClass("active")?a.sortBy="likes":w("#maxui-activity-sort .maxui-sort-action.maxui-flagged").hasClass("active")?a.sortBy="flagged":a.sortBy=o.settings.activitySortOrder),o.currentSortOrder=a.sortBy,null);"timeline"===o.settings.activitySource?(n=this.maxClient.getUserTimeline,i.push(o.settings.username)):"activities"===o.settings.activitySource&&(n=this.maxClient.getActivities,t={context:o.settings.readContextHash,tags:o.settings.contextTagsFilter},i.push(t)),1<arguments.length?(s=arguments[1],i.push(function(n){void 0===window._MAXUI||null===window._MAXUI?o.settings.showLikes=!0:o.settings.showLikes=window._MAXUI.showLikes,o.settings.canwrite=!0,"activities"===o.settings.activitySource?o.maxClient.getContext(o.settings.readContextHash,function(e){var t=o.settings.subscriptions;t[e.hash]||(t[e.hash]={},t[e.hash].permissions={},t[e.hash].permissions.read="public"===e.permissions.read,t[e.hash].permissions.write="public"===e.permissions.write);for(var i=0;i<o.settings.writeContexts.length;i++){var a=o.settings.writeContextsHashes[i];t[a].permissions?(!0!==t[a].permissions.write&&(o.settings.canwrite=!1),!0===t[a].permissions.flag?o.settings.canflag=!0:o.settings.canflag=!1):(o.settings.canwrite=!1,o.settings.canflag=!1)}o.renderPostbox(),o.formatActivities(n,r,s)}):(o.renderPostbox(n,r,s),o.formatActivities(n,r,s))})):i.push(function(e){o.formatActivities(e,r)}),i.push(a),n.apply(this.maxClient,i)},w.fn.printCommentsForActivity=function(t){var i=this,e=[];e.push(t),e.push(function(e){i.formatComment(e,t)}),this.maxClient.getCommentsForActivity.apply(this.maxClient,e)},w.maxui=function(){},w.maxui.settings=function(){return this.settings}}(jQuery),window.setTimeout(function(){window._MAXUI&&window._MAXUI.onReady&&!window._MAXUI.hasRun&&(window._MAXUI.hasRun=!0,_MAXUI.onReady())},0);
//# sourceMappingURL=maxui.min.js.map